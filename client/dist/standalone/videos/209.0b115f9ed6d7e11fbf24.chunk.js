"use strict";(globalThis.webpackChunkpeertube_client=globalThis.webpackChunkpeertube_client||[]).push([[209],{4093:(e,t,s)=>{function n(){const e=v("volume");if(null!=e){const t=parseFloat(e);if(isNaN(t))return;return t}}function i(){const e=v("webtorrent_enabled");return null==e||"true"===e}function o(){const e=v("mute");if(null!=e)return"true"===e}function a(){const e=v("theater-enabled");return null!=e&&"true"===e}function l(e){return y("volume",e.toString())}function r(e){return y("mute",e.toString())}function d(e){return y("theater-enabled",e.toString())}function u(e){return y("average-bandwidth",e.toString())}function h(){const e=v("average-bandwidth");if(null!=e){const t=parseInt(e,10);if(isNaN(t))return;return t}}function c(e){return y("last-subtitle",e)}function p(){return v("last-subtitle")}function m(e,t){return y("video-watch-history",JSON.stringify(Object.assign(Object.assign({},function(e){let t;try{const e=v("video-watch-history");if(!e)return{};t=JSON.parse(e)}catch(e){console.error("Cannot parse video watch history from local storage: ",e)}return t=t||{},t}()),{[e]:{duration:t,date:`${(new Date).toISOString()}`}})))}s.d(t,{OV:()=>n,H2:()=>i,W7:()=>o,y_:()=>a,ao:()=>l,ZC:()=>r,AO:()=>d,M_:()=>u,zZ:()=>h,v_:()=>c,pW:()=>p,Pz:()=>m});const g="peertube-videojs-";function v(e){try{return localStorage.getItem(g+e)}catch(e){return}}function y(e,t){try{localStorage.setItem(g+e,t)}catch(e){}}},209:(e,t,s)=>{s.r(t),s.d(t,{PeertubePlayerManager:()=>ee,videojs:()=>o()});var n=s(3867),i=(s(5619),s(8106),s(549),s(5534),s(3654)),o=s.n(i);const a=o().getComponent("Component");o().registerComponent("EndCard",class extends a{constructor(e,t){super(e,t),this.dashOffsetTotal=586,this.dashOffsetStart=293,this.interval=50,this.upNextEvents=new(o().EventTarget),this.ticks=0,this.totalTicks=this.options_.timeout/this.interval,e.on("ended",(t=>{this.options_.condition()&&(e.addClass("vjs-upnext--showing"),this.showCard((t=>{e.removeClass("vjs-upnext--showing"),this.container.style.display="none",t||this.options_.next()})))})),e.on("playing",(()=>{this.upNextEvents.trigger("playing")}))}createEl(){const e=super.createEl("div",{className:"vjs-upnext-content",innerHTML:(t=this.options_,`\n    <div class="vjs-upnext-top">\n      <span class="vjs-upnext-headtext">${t.headText}</span>\n      <div class="vjs-upnext-title"></div>\n    </div>\n    <div class="vjs-upnext-autoplay-icon">\n      <svg height="100%" version="1.1" viewbox="0 0 98 98" width="100%">\n        <circle class="vjs-upnext-svg-autoplay-circle" cx="49" cy="49" fill="#000" fill-opacity="0.8" r="48"></circle>\n        <circle class="vjs-upnext-svg-autoplay-ring" cx="-49" cy="49" fill-opacity="0" r="46.5"\n                stroke="#FFFFFF" stroke-width="4" transform="rotate(-90)"\n        ></circle>\n        <polygon class="vjs-upnext-svg-autoplay-triangle" fill="#fff" points="32,27 72,49 32,71"></polygon></svg>\n    </div>\n    <span class="vjs-upnext-bottom">\n      <span class="vjs-upnext-cancel">\n        <button class="vjs-upnext-cancel-button" tabindex="0" aria-label="Cancel autoplay">${t.cancelText}</button>\n      </span>\n      <span class="vjs-upnext-suspended">${t.suspendedText}</span>\n    </span>\n  `)});var t;return this.container=e,e.style.display="none",this.autoplayRing=e.getElementsByClassName("vjs-upnext-svg-autoplay-ring")[0],this.title=e.getElementsByClassName("vjs-upnext-title")[0],this.cancelButton=e.getElementsByClassName("vjs-upnext-cancel-button")[0],this.suspendedMessage=e.getElementsByClassName("vjs-upnext-suspended")[0],this.nextButton=e.getElementsByClassName("vjs-upnext-autoplay-icon")[0],this.cancelButton.onclick=()=>{this.upNextEvents.trigger("cancel")},this.nextButton.onclick=()=>{this.upNextEvents.trigger("next")},e}showCard(e){let t;this.autoplayRing.setAttribute("stroke-dasharray",`${this.dashOffsetStart}`),this.autoplayRing.setAttribute("stroke-dashoffset",""+-this.dashOffsetStart),this.title.innerHTML=this.options_.getTitle(),this.upNextEvents.one("cancel",(()=>{clearTimeout(t),e(!0)})),this.upNextEvents.one("playing",(()=>{clearTimeout(t),e(!0)})),this.upNextEvents.one("next",(()=>{clearTimeout(t),e(!1)}));const s=e=>{const t=Math.max(-this.dashOffsetTotal,-this.dashOffsetStart-e*this.dashOffsetTotal/2/100);this.autoplayRing.setAttribute("stroke-dashoffset",""+t)},n=()=>{s(100*this.ticks++/this.totalTicks)},i=()=>{this.options_.suspended()?(this.suspendedMessage.innerText=this.options_.suspendedText,s(0),this.ticks=0,t=setTimeout(i.bind(this),300)):this.ticks>=this.totalTicks?(clearTimeout(t),e(!1)):(this.suspendedMessage.innerText="",n(),t=setTimeout(i.bind(this),this.interval))};this.container.style.display="block",t=setTimeout(i.bind(this),this.interval)}});const l=o().getPlugin("plugin");o().registerPlugin("upnext",class extends l{constructor(e,t={}){const s={next:t.next,getTitle:t.getTitle,timeout:t.timeout||5e3,cancelText:t.cancelText||"Cancel",headText:t.headText||"Up Next",suspendedText:t.suspendedText||"Autoplay is suspended",condition:t.condition,suspended:t.suspended};super(e),this.player.ready((()=>{e.addClass("vjs-upnext")})),e.addChild("EndCard",s)}});var r=s(5723),d=s(4771);const u=o().getComponent("Component");class h extends u{constructor(){super(...arguments),this.metadataStore={},this.intervalMs=300,this.playerNetworkInfo={}}createEl(){const e=super.createEl("div",{className:"vjs-stats-content",innerHTML:this.getMainTemplate()});return this.container=e,this.container.style.display="none",this.closeButton=this.container.getElementsByClassName("vjs-stats-close")[0],this.closeButton.onclick=()=>this.hide(),this.list=this.container.getElementsByClassName("vjs-stats-list")[0],this.player_.on("p2pInfo",((e,t)=>{if(!t)return;this.mode=t.source;const s=t.p2p,n=t.http;this.playerNetworkInfo.downloadSpeed=(0,d.aI)(s.downloadSpeed+n.downloadSpeed).join(" "),this.playerNetworkInfo.uploadSpeed=(0,d.aI)(s.uploadSpeed+n.uploadSpeed).join(" "),this.playerNetworkInfo.totalDownloaded=(0,d.aI)(s.downloaded+n.downloaded).join(" "),this.playerNetworkInfo.totalUploaded=(0,d.aI)(s.uploaded+n.uploaded).join(" "),this.playerNetworkInfo.numPeers=s.numPeers,this.playerNetworkInfo.averageBandwidth=(0,d.aI)(t.bandwidthEstimate).join(" ")+"/s","p2p-media-loader"===t.source&&(this.playerNetworkInfo.downloadedFromServer=(0,d.aI)(n.downloaded).join(" "),this.playerNetworkInfo.downloadedFromPeers=(0,d.aI)(s.downloaded).join(" "))})),e}toggle(){this.updateInterval?this.hide():this.show()}show(){this.container.style.display="block",this.updateInterval=setInterval((()=>(0,n.mG)(this,void 0,void 0,(function*(){try{const e="p2p-media-loader"===this.mode?this.buildHLSOptions():yield this.buildWebTorrentOptions();this.list.innerHTML=this.getListTemplate(e)}catch(e){console.error("Cannot update stats.",e),clearInterval(this.updateInterval)}}))),this.intervalMs)}hide(){clearInterval(this.updateInterval),this.container.style.display="none"}buildHLSOptions(){const e=this.player_.p2pMediaLoader(),t=e.getCurrentLevel(),s=(null==t?void 0:t.videoCodec)||(null==t?void 0:t.audioCodec)?`${(null==t?void 0:t.videoCodec)||""} / ${(null==t?void 0:t.audioCodec)||""}`:void 0,n=`${null==t?void 0:t.height}p${(null==t?void 0:t.attrs["FRAME-RATE"])||""}`,i=this.timeRangesToString(this.player().buffered());let o,a;return this.options_.videoIsLive?a=(0,r.nH)(e.getLiveLatency()):o=this.player().bufferedPercent(),{playerNetworkInfo:this.playerNetworkInfo,resolution:n,codecs:s,buffer:i,latency:a,progress:o}}buildWebTorrentOptions(){var e;return(0,n.mG)(this,void 0,void 0,(function*(){const t=this.player_.webtorrent().getCurrentVideoFile();this.metadataStore[t.fileUrl]||(this.metadataStore[t.fileUrl]=yield fetch(t.metadataUrl).then((e=>e.json())));const s=this.metadataStore[t.fileUrl];let n="unknown",i="unknown";if(null==s?void 0:s.streams[0]){const e=s.streams[0];n="unknown"!==e.color_space?e.color_space:"bt709",i=e.codec_name||"avc1"}const o=(null==t?void 0:t.resolution.label)+(null==t?void 0:t.fps),a=this.timeRangesToString(this.player().buffered()),l=null===(e=this.player_.webtorrent().getTorrent())||void 0===e?void 0:e.progress;return{playerNetworkInfo:this.playerNetworkInfo,progress:l,colorSpace:n,codecs:i,resolution:o,buffer:a}}))}getListTemplate(e){const{playerNetworkInfo:t,progress:s,colorSpace:n,codecs:i,resolution:o,buffer:a,latency:l}=e,r=this.player(),d=r.getVideoPlaybackQuality(),u=`${Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)}x${Math.max(document.documentElement.clientHeight||0,window.innerHeight||0)}*${(window.devicePixelRatio||1).toFixed(2)} / ${d.droppedVideoFrames} dropped of ${d.totalVideoFrames}`,h=r.duration();let c=`${Math.round(100*r.volume())}`;r.muted()&&(c+=" (muted)");const p=t.downloadSpeed?`${t.downloadSpeed} &dArr; / ${t.uploadSpeed} &uArr;`:void 0,m=t.totalDownloaded?`${t.totalDownloaded} &dArr; / ${t.totalUploaded} &uArr;`:void 0,g=t.downloadedFromServer?`${t.downloadedFromServer} from server \xb7 ${t.downloadedFromPeers} from peers`:void 0,v=void 0!==s?`${(100*s).toFixed(1)}% (${(s*h).toFixed(1)}s)`:void 0;return`\n      ${this.buildElement(r.localize("Player mode"),this.mode||"HTTP")}\n\n      ${this.buildElement(r.localize("Video UUID"),this.options_.videoUUID)}\n\n      ${this.buildElement(r.localize("Viewport / Frames"),u)}\n\n      ${this.buildElement(r.localize("Resolution"),o)}\n\n      ${this.buildElement(r.localize("Volume"),c)}\n\n      ${this.buildElement(r.localize("Codecs"),i)}\n      ${this.buildElement(r.localize("Color"),n)}\n\n      ${this.buildElement(r.localize("Connection Speed"),t.averageBandwidth)}\n\n      ${this.buildElement(r.localize("Network Activity"),p)}\n      ${this.buildElement(r.localize("Total Transfered"),m)}\n      ${this.buildElement(r.localize("Download Breakdown"),g)}\n\n      ${this.buildElement(r.localize("Buffer Progress"),v)}\n      ${this.buildElement(r.localize("Buffer State"),a)}\n\n      ${this.buildElement(r.localize("Live Latency"),l)}\n    `}getMainTemplate(){return'\n      <button class="vjs-stats-close" tabindex=0 aria-label="Close stats" title="Close stats">[x]</button>\n      <div class="vjs-stats-list"></div>\n    '}buildElement(e,t){return t?`<div><div>${e}</div><span>${t}</span></div>`:""}timeRangesToString(e){let t="";for(let s=0;s<e.length;s++){const n=Math.floor(e.start(s)),i=Math.floor(e.end(s));t+=`[${(0,r.nH)(n)}, ${(0,r.nH)(i)}] `}return t}}o().registerComponent("StatsCard",h);const c=o().getPlugin("plugin");o().registerPlugin("stats",class extends c{constructor(e,t){const s=Object.assign({},t);super(e),this.player.ready((()=>{e.addClass("vjs-stats-for-nerds")})),this.statsCard=new h(e,t),e.addChild(this.statsCard,s)}show(){this.statsCard.show()}});const p=o().getComponent("Component");o().registerComponent("PauseBezel",class extends p{constructor(e,t){super(e,t),e.on("pause",(t=>{e.seeking()||e.ended()||(this.container.innerHTML='\n  <div class="vjs-bezels-pause">\n    <div class="vjs-bezel" role="status" aria-label="Pause">\n      <div class="vjs-bezel-icon">\n        <svg height="100%" version="1.1" viewBox="0 0 36 36" width="100%">\n          <use class="vjs-svg-shadow" xlink:href="#vjs-id-1"></use>\n          <path class="vjs-svg-fill" d="M 12,26 16,26 16,10 12,10 z M 21,26 25,26 25,10 21,10 z" id="vjs-id-1"></path>\n        </svg>\n      </div>\n    </div>\n  </div>\n  ',this.showBezel())})),e.on("play",(t=>{e.seeking()||(this.container.innerHTML='\n  <div class="vjs-bezels-play">\n    <div class="vjs-bezel" role="status" aria-label="Play">\n      <div class="vjs-bezel-icon">\n        <svg height="100%" version="1.1" viewBox="0 0 36 36" width="100%">\n          <use class="vjs-svg-shadow" xlink:href="#vjs-id-2"></use>\n          <path class="vjs-svg-fill" d="M 12,26 18.5,22 18.5,14 12,10 z M 18.5,22 25,18 25,18 18.5,14 z" id="ytp-id-2"></path>\n        </svg>\n      </div>\n    </div>\n  </div>\n  ',this.showBezel())}))}createEl(){return this.container=super.createEl("div",{className:"vjs-bezels-content"}),this.container.style.display="none",this.container}showBezel(){this.container.style.display="inherit",setTimeout((()=>{this.container.style.display="none"}),500)}});const m=o().getPlugin("plugin");o().registerPlugin("bezels",class extends m{constructor(e,t){super(e),this.player.ready((()=>{e.addClass("vjs-bezels")})),e.addChild("PauseBezel",t)}});const g=o().getComponent("MenuItem"),v=o().getComponent("Component");class y extends g{constructor(e,t){super(e,t),this.settingsButton=t.menuButton,this.dialog=this.settingsButton.dialog,this.mainMenu=this.settingsButton.menu,this.panel=this.dialog.getChild("settingsPanel"),this.panelChild=this.panel.getChild("settingsPanelChild"),this.panelChildEl=this.panelChild.el(),this.size=null,this.menuToLoad="mainmenu";const s=(0,d.LF)(t.entry),n=o().getComponent(s);if(!n)throw new Error(`Component ${s} does not exist`);const i=Object.assign({},t,{entry:t.menuButton,menuButton:this});this.subMenu=new n(this.player(),i);const a=this.subMenu.buildCSSClass().split(" ")[0];this.settingsSubMenuEl_.className+=" "+a,this.eventHandlers(),e.ready((()=>{setTimeout((()=>{this.player_&&(this.build(),e.on("ratechange",this.submenuClickHandler),"CaptionsButton"===s&&e.on("captionsChanged",(()=>{setTimeout((()=>{this.settingsSubMenuEl_.innerHTML="",this.settingsSubMenuEl_.appendChild(this.subMenu.menu.el()),this.update(),this.bindClickEvents()}),0)})),this.reset())}),0)}))}eventHandlers(){this.submenuClickHandler=this.onSubmenuClick.bind(this),this.transitionEndHandler=this.onTransitionEnd.bind(this)}onSubmenuClick(e){let t=null;t="tap"===e.type?e.target:e.currentTarget,(null==t?void 0:t.classList.contains("vjs-back-button"))?this.loadMainMenu():(setTimeout((()=>this.update(e)),0),this.subMenu.menu.removeClass("vjs-hidden"))}createEl(){const e=o().dom.createEl("li",{className:"vjs-menu-item"});return this.settingsSubMenuTitleEl_=o().dom.createEl("div",{className:"vjs-settings-sub-menu-title"}),e.appendChild(this.settingsSubMenuTitleEl_),this.settingsSubMenuValueEl_=o().dom.createEl("div",{className:"vjs-settings-sub-menu-value"}),e.appendChild(this.settingsSubMenuValueEl_),this.settingsSubMenuEl_=o().dom.createEl("div",{className:"vjs-settings-sub-menu"}),e}handleClick(e){this.menuToLoad="submenu",o().dom.removeClass(this.el(),"open"),super.handleClick(e),this.mainMenu.el().style.opacity="0",o().dom.hasClass(this.settingsSubMenuEl_,"vjs-hidden")?(o().dom.removeClass(this.settingsSubMenuEl_,"vjs-hidden"),setTimeout((()=>{this.settingsSubMenuEl_.style.opacity="1",this.settingsSubMenuEl_.style.marginRight="0px"}),0),this.settingsButton.setDialogSize(this.size)):o().dom.addClass(this.settingsSubMenuEl_,"vjs-hidden")}createBackButton(){const e=this.subMenu.menu.addChild("MenuItem",{},0);e.addClass("vjs-back-button"),e.el().innerHTML=this.player().localize(this.subMenu.controlText())}PrefixedEvent(e,t,s,n="addEvent"){const i=["webkit","moz","MS","o",""];for(let o=0;o<i.length;o++)i[o]||(t=t.toLowerCase()),"addEvent"===n?e.addEventListener(i[o]+t,s,!1):"removeEvent"===n&&e.removeEventListener(i[o]+t,s,!1)}onTransitionEnd(e){"margin-right"===e.propertyName&&"mainmenu"===this.menuToLoad&&(o().dom.addClass(this.settingsSubMenuEl_,"vjs-hidden"),this.settingsSubMenuEl_.style.opacity="0")}reset(){o().dom.addClass(this.settingsSubMenuEl_,"vjs-hidden"),this.settingsSubMenuEl_.style.opacity="0",this.setMargin()}loadMainMenu(){const e=this.mainMenu.el();this.menuToLoad="mainmenu",this.mainMenu.show(),e.style.opacity="0";const t=this.mainMenu;this.settingsButton.setDialogSize([t.width,t.height]),setTimeout((()=>{this.setMargin(),e.style.opacity="1"}),0)}build(){this.subMenu.on("updateLabel",(()=>{this.update()})),this.subMenu.on("menuChanged",(()=>{this.bindClickEvents(),this.setSize(),this.update()})),this.settingsSubMenuTitleEl_.innerHTML=this.player().localize(this.subMenu.controlText()),this.settingsSubMenuEl_.appendChild(this.subMenu.menu.el()),this.panelChildEl.appendChild(this.settingsSubMenuEl_),this.update(),this.createBackButton(),this.setSize(),this.bindClickEvents(),this.PrefixedEvent(this.settingsSubMenuEl_,"TransitionEnd",this.transitionEndHandler,"addEvent")}update(e){let t=null;const s=this.subMenu.name();if(e&&"tap"===e.type?t=e.target:e&&(t=e.currentTarget),"PlaybackRateMenuButton"===s){const e=this.subMenu.labelEl_.innerHTML;setTimeout((()=>{this.settingsSubMenuValueEl_.innerHTML=e}),250)}else for(const e of this.subMenu.menu.children_)if(e instanceof v&&e.hasClass("vjs-selected")){const t=e;if("function"==typeof t.getLabel){this.settingsSubMenuValueEl_.innerHTML=t.getLabel();break}this.settingsSubMenuValueEl_.innerHTML=t.options_.label}t&&!t.classList.contains("vjs-back-button")&&this.settingsButton.hideDialog()}bindClickEvents(){for(const e of this.subMenu.menu.children())e instanceof v&&e.on(["tap","click"],this.submenuClickHandler)}setSize(){this.dialog.removeClass("vjs-hidden"),o().dom.removeClass(this.settingsSubMenuEl_,"vjs-hidden"),this.size=this.settingsButton.getComponentSize(this.settingsSubMenuEl_),this.setMargin(),this.dialog.addClass("vjs-hidden"),o().dom.addClass(this.settingsSubMenuEl_,"vjs-hidden")}setMargin(){if(!this.size)return;const[e]=this.size;this.settingsSubMenuEl_.style.marginRight=`-${e}px`}hideSubMenu(){this.el()&&o().dom.hasClass(this.el(),"open")&&(o().dom.addClass(this.settingsSubMenuEl_,"vjs-hidden"),o().dom.removeClass(this.el(),"open"))}}y.prototype.contentElType="button",o().registerComponent("SettingsMenuItem",y);const b=o().getComponent("Button"),C=o().getComponent("Menu"),f=o().getComponent("Component");f.registerComponent("SettingsButton",class extends b{constructor(e,t){super(e,t),this.settingsButtonOptions=t,this.controlText("Settings"),this.dialog=this.player().addChild("settingsDialog"),this.dialogEl=this.dialog.el(),this.menu=null,this.panel=this.dialog.addChild("settingsPanel"),this.panelChild=this.panel.addChild("settingsPanelChild"),this.addClass("vjs-settings"),this.el().setAttribute("aria-label","Settings Button"),this.addSettingsItemHandler=this.onAddSettingsItem.bind(this),this.disposeSettingsItemHandler=this.onDisposeSettingsItem.bind(this),this.documentClickHandler=this.onDocumentClick.bind(this),this.userInactiveHandler=this.onUserInactive.bind(this),this.buildMenu(),this.bindEvents(),this.player().one("play",(()=>this.hideDialog()))}onDocumentClick(e){var t,s,n;const i=e.target;(null===(t=null==i?void 0:i.classList)||void 0===t?void 0:t.contains("vjs-settings"))||(null===(n=null===(s=null==i?void 0:i.parentElement)||void 0===s?void 0:s.classList)||void 0===n?void 0:n.contains("vjs-settings"))||this.dialog.hasClass("vjs-hidden")||this.hideDialog()}onDisposeSettingsItem(e,t){if(void 0===t){const e=this.menu.children();for(;e.length>0;)e[0].dispose(),this.menu.removeChild(e[0]);this.addClass("vjs-hidden")}else{const e=this.menu.getChild(t);e&&(e.dispose(),this.menu.removeChild(e))}this.hideDialog(),0===this.settingsButtonOptions.entries.length&&this.addClass("vjs-hidden")}dispose(){document.removeEventListener("click",this.documentClickHandler),this.isInIframe()&&window.removeEventListener("blur",this.documentClickHandler)}onAddSettingsItem(e,t){const[s,n]=t;this.addMenuItem(s,n),this.removeClass("vjs-hidden")}onUserInactive(){this.dialog.hasClass("vjs-hidden")||this.hideDialog()}bindEvents(){document.addEventListener("click",this.documentClickHandler),this.isInIframe()&&window.addEventListener("blur",this.documentClickHandler),this.player().on("addsettingsitem",this.addSettingsItemHandler),this.player().on("disposesettingsitem",this.disposeSettingsItemHandler),this.player().on("userinactive",this.userInactiveHandler)}buildCSSClass(){return`vjs-icon-settings ${super.buildCSSClass()}`}handleClick(){this.dialog.hasClass("vjs-hidden")?this.showDialog():this.hideDialog()}showDialog(){this.player().peertube().onMenuOpen(),this.menu.el().style.opacity="1",this.dialog.show(),this.setDialogSize(this.getComponentSize(this.menu))}hideDialog(){this.player_.peertube().onMenuClosed(),this.dialog.hide(),this.setDialogSize(this.getComponentSize(this.menu)),this.menu.el().style.opacity="1",this.resetChildren()}getComponentSize(e){let t=null,s=null;if(e instanceof f){const n=e.el();t=n.offsetWidth,s=n.offsetHeight,e.width=t,e.height=s}else t=e.offsetWidth,s=e.offsetHeight;return[t,s]}setDialogSize([e,t]){if("number"!=typeof t)return;const s=this.settingsButtonOptions.setup.maxHeightOffset,n=this.player().el().offsetHeight-s,i=this.panel.el();t>n?(e+=17,i.style.maxHeight=`${t=n}px`):""!==i.style.maxHeight&&(i.style.maxHeight=""),this.dialogEl.style.width=`${e}px`,this.dialogEl.style.height=`${t}px`}buildMenu(){this.menu=new C(this.player()),this.menu.addClass("vjs-main-menu");const e=this.settingsButtonOptions.entries;if(0===e.length)return this.addClass("vjs-hidden"),void this.panelChild.addChild(this.menu);for(const t of e)this.addMenuItem(t,this.settingsButtonOptions);this.panelChild.addChild(this.menu)}addMenuItem(e,t){t.name=(0,d.LF)(e);const s=Object.assign({},t,{entry:e,menuButton:this}),n=new y(this.player(),s);this.menu.addChild(n),n.on("click",o().bind(this,this.hideChildren)),n.on("click",(function(){o().dom.hasClass(this.el_,"open")?o().dom.removeClass(this.el_,"open"):o().dom.addClass(this.el_,"open")}))}resetChildren(){for(const e of this.menu.children())e.reset()}hideChildren(){for(const e of this.menu.children())e.hideSubMenu()}isInIframe(){return window.self!==window.top}});var E=s(4093);const w=o().getPlugin("plugin");o().registerPlugin("peertube",class extends w{constructor(e,t){super(e),this.CONSTANTS={USER_WATCHING_VIDEO_INTERVAL:5e3},this.menuOpened=!1,this.mouseInControlBar=!1,this.videoViewUrl=t.videoViewUrl,this.videoDuration=t.videoDuration,this.videoCaptions=t.videoCaptions,this.isLive=t.isLive,this.savedInactivityTimeout=e.options_.inactivityTimeout,t.autoplay&&this.player.addClass("vjs-has-autoplay"),this.player.on("autoplay-failure",(()=>{this.player.removeClass("vjs-has-autoplay")})),this.player.ready((()=>{const e=this.player.options_;"webtorrent"===t.mode&&(this.player.webtorrent().on("resolutionChange",((e,t)=>this.handleResolutionChange(t))),this.player.webtorrent().on("autoResolutionChange",((e,t)=>this.trigger("autoResolutionChange",t)))),"p2p-media-loader"===t.mode&&this.player.p2pMediaLoader().on("resolutionChange",((e,t)=>this.handleResolutionChange(t))),this.player.tech(!0).on("loadedqualitydata",(()=>{setTimeout((()=>{this.lastResolutionChange&&this.handleResolutionChange(this.lastResolutionChange)}),0)}));const s=(0,E.OV)();void 0!==s&&this.player.volume(s);const n=void 0!==e.muted?e.muted:(0,E.W7)();if(void 0!==n&&this.player.muted(n),this.defaultSubtitle=t.subtitle||(0,E.pW)(),this.player.on("volumechange",(()=>{(0,E.ao)(this.player.volume()),(0,E.ZC)(this.player.muted())})),t.stopTime){const e=(0,r.h8)(t.stopTime),s=this;this.player.on("timeupdate",(function t(){s.player.currentTime()>e&&(s.player.pause(),s.player.trigger("stopped"),s.player.off("timeupdate",t))}))}this.player.textTracks().on("change",(()=>{const e=this.player.textTracks().tracks_.find((e=>"captions"===e.kind&&"showing"===e.mode));(0,E.v_)(e?e.language:"off")})),this.player.on("sourcechange",(()=>this.initCaptions())),this.player.duration(t.videoDuration),this.initializePlayer(),this.runViewAdd(),this.runUserWatchVideo(t.userWatching,t.videoUUID)}))}dispose(){this.videoViewInterval&&clearInterval(this.videoViewInterval),this.userWatchingVideoInterval&&clearInterval(this.userWatchingVideoInterval)}onMenuOpen(){this.menuOpened=!1,this.alterInactivity()}onMenuClosed(){this.menuOpened=!0,this.alterInactivity()}initializePlayer(){(0,d.tq)()&&this.player.addClass("vjs-is-mobile"),this.initSmoothProgressBar(),this.initCaptions(),this.listenControlBarMouse()}runViewAdd(){this.clearVideoViewInterval();let e=30;!this.isLive&&this.videoDuration<e&&(e=3*this.videoDuration/4);let t=0;this.videoViewInterval=setInterval((()=>{this.player&&!this.player.paused()&&(t+=1,t>e&&(this.isLive?t=0:this.clearVideoViewInterval(),this.addViewToVideo().catch((e=>console.error(e)))))}),1e3)}runUserWatchVideo(e,t){let s=0;this.userWatchingVideoInterval=setInterval((()=>{const n=Math.floor(this.player.currentTime());n-s>=1&&(s=n,e?this.notifyUserIsWatching(n,e.url,e.authorizationHeader).catch((e=>console.error("Cannot notify user is watching.",e))):(0,E.Pz)(t,n))}),this.CONSTANTS.USER_WATCHING_VIDEO_INTERVAL)}clearVideoViewInterval(){void 0!==this.videoViewInterval&&(clearInterval(this.videoViewInterval),this.videoViewInterval=void 0)}addViewToVideo(){return this.videoViewUrl?fetch(this.videoViewUrl,{method:"POST"}):Promise.resolve(void 0)}notifyUserIsWatching(e,t,s){const n=new URLSearchParams;n.append("currentTime",e.toString());const i=new Headers({Authorization:s});return fetch(t,{method:"PUT",body:n,headers:i})}handleResolutionChange(e){this.lastResolutionChange=e;const t=this.player.qualityLevels();for(let s=0;s<t.length;s++)if(t[s].height===e.resolutionId){e.id=t[s].id;break}console.log("Resolution changed.",e),this.trigger("resolutionChange",e)}listenControlBarMouse(){this.player.controlBar.on("mouseenter",(()=>{this.mouseInControlBar=!0,this.alterInactivity()})),this.player.controlBar.on("mouseleave",(()=>{this.mouseInControlBar=!1,this.alterInactivity()}))}alterInactivity(){this.menuOpened?this.player.options_.inactivityTimeout=this.savedInactivityTimeout:this.mouseInControlBar||this.isTouchEnabled()||(this.player.options_.inactivityTimeout=1)}isTouchEnabled(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}initCaptions(){for(const e of this.videoCaptions)this.player.addRemoteTextTrack({kind:"captions",label:e.label,language:e.language,id:e.language,src:e.src,default:this.defaultSubtitle===e.language},!1);this.player.trigger("captionsChanged")}initSmoothProgressBar(){const e=o().getComponent("SeekBar");e.prototype.getPercent=function(){const e=this.player_.currentTime()/this.player_.duration();return e>=1?1:e},e.prototype.handleMouseMove=function(e){let t=this.calculateDistance(e)*this.player_.duration();t===this.player_.duration()&&(t-=.1),this.player_.currentTime(t),this.update()}}});const T=o().getComponent("Button");class S extends T{constructor(e,t){super(e,t),this.nextPreviousVideoButtonOptions=t,this.update()}createEl(){const e=this.options_.type,t=o().dom.createEl("button",{className:"vjs-"+e+"-video"}),s=o().dom.createEl("span",{className:"icon icon-"+e});return t.appendChild(s),t.title=this.player_.localize("next"===e?"Next video":"Previous video"),t}handleClick(){this.nextPreviousVideoButtonOptions.handler()}update(){this.nextPreviousVideoButtonOptions.isDisabled()?this.addClass("vjs-disabled"):this.removeClass("vjs-disabled")}}o().registerComponent("NextVideoButton",S),o().registerComponent("PreviousVideoButton",S);const M=o().getComponent("Button");o().registerComponent("P2PInfoButton",class extends M{createEl(){const e=o().dom.createEl("div",{className:"vjs-peertube"}),t=o().dom.createEl("div",{className:"vjs-peertube-hidden"});e.appendChild(t);const s=o().dom.createEl("span",{className:"icon icon-download"});t.appendChild(s);const n=o().dom.createEl("span",{className:"download-speed-text"}),i=o().dom.createEl("span",{className:"download-speed-number"}),a=o().dom.createEl("span");n.appendChild(i),n.appendChild(a),t.appendChild(n);const l=o().dom.createEl("span",{className:"icon icon-upload"});t.appendChild(l);const r=o().dom.createEl("span",{className:"upload-speed-text"}),u=o().dom.createEl("span",{className:"upload-speed-number"}),h=o().dom.createEl("span");r.appendChild(u),r.appendChild(h),t.appendChild(r);const c=o().dom.createEl("span",{className:"peers-text"}),p=o().dom.createEl("span",{className:"peers-number"});t.appendChild(p),t.appendChild(c);const m=o().dom.createEl("div",{className:"vjs-peertube-hidden"}),g=o().dom.createEl("span",{className:"http-fallback",textContent:"HTTP"});return m.appendChild(g),e.appendChild(m),this.player_.on("p2pInfo",((e,s)=>{if(!s)return m.className="vjs-peertube-displayed",void(t.className="vjs-peertube-hidden");const n=s.p2p,o=s.http,l=(0,d.aI)(n.downloadSpeed+o.downloadSpeed),r=(0,d.aI)(n.uploadSpeed+o.uploadSpeed),g=(0,d.aI)(n.downloaded+o.downloaded),v=(0,d.aI)(n.uploaded+o.uploaded),y=n.numPeers;if(t.title=this.player().localize("Total downloaded: ")+g.join(" ")+"\n","p2p-media-loader"===s.source){const e=(0,d.aI)(o.downloaded).join(" "),s=(0,d.aI)(n.downloaded).join(" ");t.title+=" * "+this.player().localize("From servers: ")+e+"\n * "+this.player().localize("From peers: ")+s+"\n"}t.title+=this.player().localize("Total uploaded: ")+v.join(" "),i.textContent=l[0],a.textContent=" "+l[1],u.textContent=r[0],h.textContent=" "+r[1],p.textContent=y.toString(),c.textContent=" "+(y>1?this.player().localize("peers"):this.player_.localize("peer")),m.className="vjs-peertube-hidden",t.className="vjs-peertube-displayed"})),e}});const x=o().getComponent("Button");o().registerComponent("PeerTubeLinkButton",class extends x{constructor(e,t){super(e,t)}createEl(){return this.buildElement()}updateHref(){this.el().setAttribute("href",this.buildLink())}handleClick(){this.player().pause()}buildElement(){const e=o().dom.createEl("a",{href:this.buildLink(),innerHTML:"PeerTube",title:this.player().localize("Video page (new window)"),className:"vjs-peertube-link",target:"_blank"});return e.addEventListener("mouseenter",(()=>this.updateHref())),e}buildLink(){const e=(0,r.d6)({shortUUID:this.options_.shortUUID});return(0,r.fj)({url:e,startTime:this.player().currentTime()})}});const I=o().getComponent("Component");I.registerComponent("PeerTubeLoadProgressBar",class extends I{constructor(e,t){super(e,t),this.on(e,"progress",this.update)}createEl(){return super.createEl("div",{className:"vjs-load-progress",innerHTML:`<span class="vjs-control-text"><span>${this.localize("Loaded")}</span>: 0%</span>`})}dispose(){super.dispose()}update(){const e=this.player().webtorrent().getTorrent();e&&(this.el().style.width=100*e.progress+"%")}});const k=o().getComponent("MenuItem");class j extends k{constructor(e,t){t.selectable=!0,super(e,t),this.autoResolutionPossible=!0,this.currentResolutionLabel="",this.resolutionId=t.id,this.label=t.label,this.labels=t.labels,this.callback=t.callback,e.peertube().on("resolutionChange",((e,t)=>this.updateSelection(t))),-1===this.resolutionId&&e.peertube().on("autoResolutionChange",((e,t)=>this.updateAutoResolution(t)))}handleClick(e){!1===this.autoResolutionPossible&&-1===this.resolutionId||(super.handleClick(e),this.callback(this.resolutionId,"video"))}updateSelection(e){-1===this.resolutionId&&(this.currentResolutionLabel=this.labels[e.id]),this.selected(!0!==e.auto?this.resolutionId===e.id:-1===this.resolutionId)}updateAutoResolution(e){!1===e.possible?this.addClass("disabled"):this.removeClass("disabled"),this.autoResolutionPossible=e.possible}getLabel(){return-1===this.resolutionId?this.label+" <small>"+this.currentResolutionLabel+"</small>":this.label}}o().registerComponent("ResolutionMenuItem",j);const L=o().getComponent("Menu"),P=o().getComponent("MenuButton");o().registerComponent("ResolutionMenuButton",class extends P{constructor(e,t){super(e,t),this.controlText("Quality"),e.tech(!0).on("loadedqualitydata",((e,t)=>this.buildQualities(t))),e.peertube().on("resolutionChange",(()=>setTimeout((()=>this.trigger("updateLabel")),0)))}createEl(){const e=super.createEl();return this.labelEl_=o().dom.createEl("div",{className:"vjs-resolution-value"}),e.appendChild(this.labelEl_),e}updateARIAAttributes(){this.el().setAttribute("aria-label","Quality")}createMenu(){return new L(this.player_)}buildCSSClass(){return super.buildCSSClass()+" vjs-resolution-button"}buildWrapperCSSClass(){return"vjs-resolution-control "+super.buildWrapperCSSClass()}addClickListener(e){e.on("click",(()=>{const t=this.menu.children();for(const s of t)e!==s&&s.selected(!1)}))}buildQualities(e){const t={};e.qualityData.video.sort(((e,t)=>e.id>t.id?-1:e.id===t.id?0:1));for(const s of e.qualityData.video){if(-1===s.id)continue;const n="0p"===s.label?this.player().localize("Audio-only"):s.label;this.menu.addChild(new j(this.player_,{id:s.id,label:n,selected:s.selected,callback:e.qualitySwitchCallback})),t[s.id]=s.label}this.menu.addChild(new j(this.player_,{id:-1,label:this.player_.localize("Auto"),labels:t,callback:e.qualitySwitchCallback,selected:!0}));for(const e of this.menu.children())this.addClickListener(e);this.trigger("menuChanged")}});const N=o().getComponent("Component");N.registerComponent("SettingsDialog",class extends N{constructor(e){super(e),this.hide()}createEl(){const e=this.id();return super.createEl("div",{className:"vjs-settings-dialog vjs-modal-overlay",innerHTML:"",tabIndex:-1},{role:"dialog","aria-labelledby":"TTsettingsDialogLabel-"+e,"aria-describedby":"TTsettingsDialogDescription-"+e})}});const B=o().getComponent("Component");B.registerComponent("SettingsPanel",class extends B{createEl(){return super.createEl("div",{className:"vjs-settings-panel",innerHTML:"",tabIndex:-1})}});const _=o().getComponent("Component");_.registerComponent("SettingsPanelChild",class extends _{createEl(){return super.createEl("div",{className:"vjs-settings-panel-child",innerHTML:"",tabIndex:-1})}});const U=o().getComponent("Button");class H extends U{constructor(e,t){super(e,t);const s=(0,E.y_)();!0===s&&(this.player().addClass(H.THEATER_MODE_CLASS),this.handleTheaterChange()),this.controlText("Theater mode"),this.player().theaterEnabled=s}buildCSSClass(){return`vjs-theater-control ${super.buildCSSClass()}`}handleTheaterChange(){const e=this.isTheaterEnabled();this.controlText(e?"Normal mode":"Theater mode"),(0,E.AO)(e),this.player_.trigger("theaterChange",e)}handleClick(){this.player_.toggleClass(H.THEATER_MODE_CLASS),this.handleTheaterChange()}isTheaterEnabled(){return this.player_.hasClass(H.THEATER_MODE_CLASS)}}H.THEATER_MODE_CLASS="vjs-theater-enabled",o().registerComponent("TheaterButton",H);const V=o().getComponent("ClickableComponent");class D extends V{constructor(e,t){super(e,t)}createEl(){this.wrapper=super.createEl("div",{className:"vjs-playlist-button",innerHTML:"",tabIndex:-1});const e=super.createEl("div",{className:"vjs-playlist-icon",innerHTML:"",tabIndex:-1});return this.playlistInfoElement=super.createEl("div",{className:"vjs-playlist-info",innerHTML:"",tabIndex:-1}),this.wrapper.appendChild(e),this.wrapper.appendChild(this.playlistInfoElement),this.update(),this.wrapper}update(){const e=this.options_;this.playlistInfoElement.innerHTML=e.getCurrentPosition()+"/"+e.playlist.videosLength,this.wrapper.title=this.player().localize("Playlist: {1}",[e.playlist.displayName])}handleClick(){this.getPlaylistMenu().open()}getPlaylistMenu(){return this.options_.playlistMenu}}o().registerComponent("PlaylistButton",D);const z=o().getComponent("Component");class O extends z{constructor(e,t){super(e,t),this.emitTapEvents(),this.element=t.element,this.on(["click","tap"],(()=>this.switchPlaylistItem())),this.on("keydown",(e=>this.handleKeyDown(e)))}createEl(){const e=this.options_,t=super.createEl("li",{className:"vjs-playlist-menu-item",innerHTML:""});e.element.video||t.classList.add("vjs-disabled");const s=super.createEl("div",{className:"item-position-block"}),n=super.createEl("div",{className:"item-position",innerHTML:e.element.position});return s.appendChild(n),t.appendChild(s),e.element.video?this.buildAvailableVideo(t,s,e):this.buildUnavailableVideo(t),t}setSelected(e){e?this.addClass("vjs-selected"):this.removeClass("vjs-selected")}getElement(){return this.element}buildAvailableVideo(e,t,s){const n=s.element,i=super.createEl("div",{className:"item-player"});t.appendChild(i);const o=super.createEl("img",{src:window.location.origin+n.video.thumbnailPath}),a=super.createEl("div",{className:"info-block"}),l=super.createEl("div",{innerHTML:n.video.name,className:"title"}),d=super.createEl("div",{innerHTML:n.video.channel.displayName,className:"channel"});if(a.appendChild(l),a.appendChild(d),n.startTimestamp||n.stopTimestamp){let e="";n.startTimestamp&&(e+=(0,r.nH)(n.startTimestamp)),n.stopTimestamp&&(e+=" - "+(0,r.nH)(n.stopTimestamp));const t=super.createEl("div",{innerHTML:e,className:"timestamps"});a.append(t)}e.append(o),e.append(a)}buildUnavailableVideo(e){const t=super.createEl("div",{className:"item-unavailable",innerHTML:this.player().localize("Unavailable video")});e.appendChild(t)}handleKeyDown(e){"Space"!==e.code&&"Enter"!==e.code||this.switchPlaylistItem()}switchPlaylistItem(){this.options_.onClicked()}}z.registerComponent("PlaylistMenuItem",O);const R=o().getComponent("Component");class A extends R{constructor(e,t){super(e,t);const s=this;function n(){s.close()}this.el().addEventListener("mouseenter",(()=>{this.player().off("userinactive",n)})),this.el().addEventListener("mouseleave",(()=>{this.player().one("userinactive",n)})),this.player().on("click",(e=>{let t=e.target;do{if(t.classList.contains("vjs-playlist-menu")||t.classList.contains("vjs-playlist-button"))return;t=t.parentElement}while(t);this.close()}))}createEl(){this.menuItems=[];const e=this.getOptions(),t=super.createEl("div",{className:"vjs-playlist-menu",innerHTML:"",tabIndex:-1}),s=super.createEl("div",{className:"header"}),n=super.createEl("div"),i=super.createEl("div",{innerHTML:e.playlist.displayName,className:"title"}),o=e.playlist.videoChannel,a=super.createEl("div",{innerHTML:o?this.player().localize("By {1}",[o.displayName]):"",className:"channel"});n.appendChild(i),n.appendChild(a);const l=super.createEl("div",{className:"cross"});l.addEventListener("click",(()=>this.close())),s.appendChild(n),s.appendChild(l);const r=super.createEl("ol");for(const t of e.elements){const e=new O(this.player(),{element:t,onClicked:()=>this.onItemClicked(t)});r.appendChild(e.el()),this.menuItems.push(e)}return t.appendChild(s),t.appendChild(r),t}update(){const e=this.getOptions();this.updateSelected(e.getCurrentPosition())}open(){this.player().addClass("playlist-menu-displayed")}close(){this.player().removeClass("playlist-menu-displayed")}updateSelected(e){for(const t of this.menuItems)t.setSelected(t.getElement().position===e)}getOptions(){return this.options_}onItemClicked(e){this.getOptions().onItemClicked(e)}}R.registerComponent("PlaylistMenu",A);const $=o().getPlugin("plugin");o().registerPlugin("playlist",class extends ${constructor(e,t){super(e,t),this.options=t,this.player.ready((()=>{e.addClass("vjs-playlist")})),this.playlistMenu=new A(e,t),this.playlistButton=new D(e,Object.assign({},t,{playlistMenu:this.playlistMenu})),e.addChild(this.playlistMenu,t),e.addChild(this.playlistButton,t)}updateSelected(){this.playlistMenu.updateSelected(this.options.getCurrentPosition())}});var F=s(4182),W=s(5319),K=s(2776);class q{constructor(e=[]){this.baseUrls=e}removeBySegmentUrl(e){console.log("Removing redundancy of segment URL %s.",e);const t=(0,K.dirname)(e);this.baseUrls=this.baseUrls.filter((e=>e!==t&&e!==t+"/"))}buildUrl(e){const t=this.baseUrls.length+1,s=this.getRandomInt(t);if(s===t-1)return e;const n=this.baseUrls[s],i=n.endsWith("/")?"":"/";return n+i+(0,K.basename)(e)}countBaseUrls(){return this.baseUrls.length}getRandomInt(e){return Math.floor(Math.random()*Math.floor(e))}}function G(e){return function(t){return e.buildUrl(t.url)}}var Q=s(2236).Buffer;function Z(e,t){let i=J(e);const o=/bytes=(\d+)-(\d+)/;return function a(l,r,d,u=1){return(0,n.mG)(this,void 0,void 0,(function*(){t&&(yield(0,W.Dc)(1e3));const h=(0,K.basename)(l.url),c=(yield i)[h];if(!c&&u>3)throw new Error(`Unknown segment name ${h} in segment validator`);if(!c)return console.log("Refetching sha segments for %s.",h),yield(0,W.Dc)(1e3),i=J(e),void(yield a(l,r,d,u+1));let p,m="";if("string"==typeof c)p=c;else{const e=o.exec(l.range);m=e[1]+"-"+e[2],p=c[m]}if(void 0===p)throw new Error(`Unknown segment name ${h}/${m} in segment validator`);const g=yield function(e){return(0,n.mG)(this,void 0,void 0,(function*(){if(e)return window.crypto.subtle?window.crypto.subtle.digest("SHA-256",e).then((e=>function(e){if(!e)return"";let t="";const s="0123456789abcdef";return new Uint8Array(e).forEach((e=>{t+=s[e>>4]+s[15&e]})),t}(e))):(new((yield s.e(875).then(s.t.bind(s,875,23))).default.sha256)).update(Q.from(e)).digest("hex")}))}(l.data);if(g!==p)throw new Error(`Hashes does not correspond for segment ${h}/${m}(expected: ${p} instead of ${g})`)}))}}function J(e){return fetch(e).then((e=>e.json())).catch((e=>(console.error("Cannot get sha256 segments",e),{})))}var X=s(645);o().getComponent("PlaybackRateMenuButton").prototype.controlText_="Speed";const Y=o().getComponent("CaptionsButton");Y.prototype.controlText_="Subtitles/CC",Y.prototype.label_=" ";class ee{static initState(){ee.alreadyPlayed=!1}static initialize(e,t,i){return(0,n.mG)(this,void 0,void 0,(function*(){let n;this.pluginsManager=t.pluginsManager,this.onPlayerChange=i,this.playerElementClassName=t.common.playerElement.className,"webtorrent"===e&&(yield Promise.all([s.e(731),s.e(100),s.e(650)]).then(s.bind(s,899))),"p2p-media-loader"===e&&([n]=yield Promise.all([Promise.all([s.e(731),s.e(569),s.e(470)]).then(s.t.bind(s,569,23)),Promise.all([s.e(731),s.e(569),s.e(538),s.e(586)]).then(s.bind(s,4746))]));const a=yield this.getVideojsOptions(e,t,n);yield X.N.loadLocaleInVideoJS(t.common.serverUrl,t.common.language,o());const l=this;return new Promise((s=>{o()(t.common.playerElement,a,(function(){const n=this;let i=!1;return n.tech(!0).one("error",(()=>{i||l.maybeFallbackToWebTorrent(e,n,t),i=!0})),n.one("error",(()=>{i||l.maybeFallbackToWebTorrent(e,n,t),i=!0})),n.one("play",(()=>{ee.alreadyPlayed=!0})),l.addContextMenu({mode:e,player:n,videoShortUUID:t.common.videoShortUUID,videoEmbedUrl:t.common.embedUrl,videoEmbedTitle:t.common.embedTitle}),n.bezels(),n.stats({videoUUID:t.common.videoUUID,videoIsLive:t.common.isLive,mode:e}),n.on("p2pInfo",((e,t)=>{"p2p-media-loader"!==t.source||isNaN(t.bandwidthEstimate)||(0,E.M_)(t.bandwidthEstimate)})),s(n)}))}))}))}static maybeFallbackToWebTorrent(e,t,i){return(0,n.mG)(this,void 0,void 0,(function*(){if("webtorrent"===e)return;console.log("Fallback to webtorrent.");const n=document.createElement("video");n.className=this.playerElementClassName;let a=i.common.playerElement.parentNode;a||(a=document.getElementById(i.common.playerElement.id).parentNode),a.parentNode.insertBefore(n,a),i.common.playerElement=n,i.common.onPlayerElementChange(n),t.dispose(),yield Promise.all([s.e(731),s.e(100),s.e(650)]).then(s.bind(s,899));const l="webtorrent",r=yield this.getVideojsOptions(l,i),d=this;o()(n,r,(function(){d.addContextMenu({mode:l,player:this,videoShortUUID:i.common.videoShortUUID,videoEmbedUrl:i.common.embedUrl,videoEmbedTitle:i.common.embedTitle}),ee.onPlayerChange(this)}))}))}static getVideojsOptions(e,t,s){return(0,n.mG)(this,void 0,void 0,(function*(){const n=t.common,i="p2p-media-loader"===e;let o=this.getAutoPlayValue(n.autoplay);const a={preloadTextTracks:!1},l={peertube:{mode:e,autoplay:o,videoViewUrl:n.videoViewUrl,videoDuration:n.videoDuration,userWatching:n.userWatching,subtitle:n.subtitle,videoCaptions:n.videoCaptions,stopTime:n.stopTime,isLive:n.isLive,videoUUID:n.videoUUID}};if(n.playlist&&(l.playlist=n.playlist),!0===n.enableHotkeys&&ee.addHotkeysOptions(l),i){const{hlsjs:e}=ee.addP2PMediaLoaderOptions(l,t,s);Object.assign(a,e.html5)}"webtorrent"===e&&(ee.addWebTorrentOptions(l,t),o=!1);const r={html5:a,textTrackSettings:!1,controls:void 0===n.controls||n.controls,loop:void 0!==n.loop&&n.loop,muted:void 0!==n.muted?n.muted:void 0,autoplay:this.getAutoPlayValue(o),poster:n.poster,inactivityTimeout:n.inactivityTimeout,playbackRates:[.5,.75,1,1.25,1.5,1.75,2],plugins:l,controlBar:{children:this.getControlBarChildren(e,{videoShortUUID:n.videoShortUUID,captions:n.captions,peertubeLink:n.peertubeLink,theaterButton:n.theaterButton,nextVideo:n.nextVideo,hasNextVideo:n.hasNextVideo,previousVideo:n.previousVideo,hasPreviousVideo:n.hasPreviousVideo})}};return n.language&&!(0,F.TF)(n.language)&&Object.assign(r,{language:n.language}),this.pluginsManager.runHook("filter:internal.player.videojs.options.result",r)}))}static addP2PMediaLoaderOptions(e,t,s){const n=t.p2pMediaLoader,i=t.common,o=n.trackerAnnounce.filter((e=>e.startsWith("ws"))),a=new q(t.p2pMediaLoader.redundancyBaseUrls),l={redundancyUrlManager:a,type:"application/x-mpegURL",startTime:i.startTime,src:n.playlistUrl};let r=!1;navigator&&navigator.connection&&"cellular"===navigator.connection.type&&(console.log("We are on a cellular connection: disabling seeding."),r=!0);const u={loader:{trackerAnnounce:o,segmentValidator:Z(t.p2pMediaLoader.segmentsSha256Url,t.common.isLive),rtcConfig:(0,d.gI)(),requiredSegmentsPriority:1,simultaneousHttpDownloads:1,segmentUrlBuilder:G(a),useP2P:(0,E.H2)(),consumeOnly:r},segments:{swarmId:n.playlistUrl}},h={p2pMediaLoader:l,hlsjs:{levelLabelHandler:e=>{const t=Math.min(e.height||0,e.width||0),s=n.videoFiles.find((e=>e.resolution.id===t));if(!s)return e.height;let i=s.resolution.label;return s.fps>=50&&(i+=s.fps),i},html5:{hlsjsConfig:this.getHLSOptions(s,u)}}};return Object.assign(e,h),h}static getHLSOptions(e,t){const s={capLevelToPlayerSize:!0,autoStartLoad:!1,liveSyncDurationCount:5,loader:new e.Engine(t).createLoaderClass()},n=(0,E.zZ)();return n?Object.assign(Object.assign({},s),{abrEwmaDefaultEstimate:8*n,startLevel:-1,testBandwidth:!1,debug:!1}):s}static addWebTorrentOptions(e,t){const s=t.common,n=t.webtorrent,i=t.p2pMediaLoader,o="play"===this.getAutoPlayValue(s.autoplay);Object.assign(e,{webtorrent:{autoplay:o,videoDuration:s.videoDuration,playerElement:s.playerElement,videoFiles:0!==n.videoFiles.length?n.videoFiles:(null==i?void 0:i.videoFiles)||[],startTime:s.startTime}})}static getControlBarChildren(e,t){const s=[],n="webtorrent"===e?"peerTubeLoadProgressBar":"loadProgressBar";s.push("playbackRateMenuButton"),!0===t.captions&&s.push("captionsButton"),s.push("resolutionMenuButton");const i={};return t.previousVideo&&Object.assign(i,{previousVideoButton:{type:"previous",handler:t.previousVideo,isDisabled:()=>!!t.hasPreviousVideo&&!t.hasPreviousVideo()}}),Object.assign(i,{playToggle:{}}),t.nextVideo&&Object.assign(i,{nextVideoButton:{type:"next",handler:t.nextVideo,isDisabled:()=>!!t.hasNextVideo&&!t.hasNextVideo()}}),Object.assign(i,{currentTimeDisplay:{},timeDivider:{},durationDisplay:{},liveDisplay:{},flexibleWidthSpacer:{},progressControl:{children:{seekBar:{children:{[n]:{},mouseTimeDisplay:{},playProgressBar:{}}}}},p2PInfoButton:{},muteToggle:{},volumeControl:{},settingsButton:{setup:{maxHeightOffset:40},entries:s}}),!0===t.peertubeLink&&Object.assign(i,{peerTubeLinkButton:{shortUUID:t.videoShortUUID}}),!0===t.theaterButton&&Object.assign(i,{theaterButton:{}}),Object.assign(i,{fullscreenToggle:{}}),i}static addContextMenu(e){const{mode:t,player:s,videoEmbedTitle:n,videoEmbedUrl:i,videoShortUUID:o}=e;s.contextmenuUI({content:()=>{const e=s.options_.loop,a=[{icon:"repeat",label:s.localize("Play in loop")+(e?'<span class="vjs-icon-tick-white"></span>':""),listener:function(){s.options_.loop=!e}},{label:s.localize("Copy the video URL"),listener:function(){(0,W.vQ)((0,r.d6)({shortUUID:o}))}},{label:s.localize("Copy the video URL at the current time"),listener:function(){const e=(0,r.d6)({shortUUID:o});(0,W.vQ)((0,r.fj)({url:e,startTime:this.currentTime()}))}},{icon:"code",label:s.localize("Copy embed code"),listener:()=>{(0,W.vQ)((0,d.t3)(i,n))}}];return"webtorrent"===t&&a.push({label:s.localize("Copy magnet URI"),listener:function(){(0,W.vQ)(this.webtorrent().getCurrentVideoFile().magnetUri)}}),a.push({icon:"info",label:s.localize("Stats for nerds"),listener:()=>{s.stats().show()}}),a.map((e=>Object.assign(Object.assign({},e),{label:`<span class="vjs-icon-${e.icon||"link-2"}"></span>`+e.label})))}})}static addHotkeysOptions(e){const t=(e,t)=>!(e.ctrlKey||e.altKey||e.metaKey||e.shiftKey||e.key!==t);Object.assign(e,{hotkeys:{skipInitialFocus:!0,enableInactiveFocus:!1,captureDocumentHotkeys:!0,documentHotkeysFocusElementFilter:e=>{const t=e.tagName.toLowerCase();return"content"===e.id||"body"===t||"video"===t},enableVolumeScroll:!1,enableModifiersForNumbers:!1,rewindKey:function(e){return t(e,"ArrowLeft")},forwardKey:function(e){return t(e,"ArrowRight")},fullscreenKey:function(e){return t(e,"f")||!e.altKey&&e.ctrlKey&&"Enter"===e.key},customKeys:{increasePlaybackRateKey:{key:function(e){return t(e,">")},handler:function(e){const t=Math.min(e.playbackRate()+.1,5);e.playbackRate(parseFloat(t.toFixed(2)))}},decreasePlaybackRateKey:{key:function(e){return t(e,"<")},handler:function(e){const t=Math.max(e.playbackRate()-.1,.1);e.playbackRate(parseFloat(t.toFixed(2)))}},frameByFrame:{key:function(e){return t(e,".")},handler:function(e){e.pause(),e.currentTime(e.currentTime()+1/30)}}}}})}static getAutoPlayValue(e){return!0!==e?e:(0,d.gn)()||(0,d.G6)()?!!ee.alreadyPlayed&&"play":"play"}}ee.alreadyPlayed=!1},4771:(e,t,s)=>{s.d(t,{gI:()=>p,LF:()=>i,t3:()=>u,qx:()=>h,FE:()=>c,tq:()=>d,aI:()=>r,gn:()=>o,G6:()=>a});var n=s(5474);function i(e){return e.charAt(0).toUpperCase()+e.slice(1)}function o(){return!!/iPad|iPhone|iPod/.test(navigator.platform)||!!(navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&navigator.platform.includes("MacIntel"))}function a(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}const l=[{max:1024,type:"B"},{max:1048576,type:"KB"},{max:1073741824,type:"MB"},{max:10995116e5,type:"GB"}];function r(e){const t=l.find((t=>e<t.max))||l[l.length-1];return[Math.floor(e/(t.max/1024)).toString(),t.type]}function d(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)}function u(e,t){return'<iframe width="560" height="315" sandbox="allow-same-origin allow-scripts allow-popups" title="'+(0,n.r)(t)+'" src="'+e+'" frameborder="0" allowfullscreen></iframe>'}function h(e){let t=e[0];for(let s=1;s<e.length;s++){const n=e[s];t.resolution.id<n.resolution.id&&(t=n)}return t}function c(e){let t=e[0];for(let s=1;s<e.length;s++){const n=e[s];t.resolution.id>n.resolution.id&&(t=n)}return t}function p(){return{iceServers:[{urls:"stun:stun.stunprotocol.org"},{urls:"stun:stun.framasoft.org"}]}}},2776:(e,t,s)=>{e.exports=s(1328)},5723:(e,t,s)=>{function n(e){if(!e)return 0;if("number"==typeof e)return e;const t=e.match(/^((\d+)[h:])?((\d+)[m:])?((\d+)s?)?$/);return t?3600*parseInt(t[2]||"0",10)+60*parseInt(t[4]||"0",10)+parseInt(t[6]||"0",10):0}function i(e,t=!1,s){let n="";if(0===e&&!t)return"0s";const i=s||"h",o=s||"m",a=t?"":"s",l=Math.floor(e/3600);l>=1?n=l+i:t&&(n="0"+i),e%=3600;const r=Math.floor(e/60);return r>=1&&r<10&&t?n+="0"+r+o:r>=1?n+=r+o:t&&(n+="00"+o),(e%=60)>=1&&e<10&&t?n+="0"+e+a:e>=1?n+=e+a:t&&(n+="00"),n}function o(e,t){return(null!=t?t:window.location.origin)+function(e){return"/w/"+e.shortUUID}(e)}function a(e){const{url:t}=e,s=function(e){const t=new URLSearchParams(window.location.search);return t.delete("videoId"),t.delete("resume"),t}(window);if(null!=e.startTime){const t=Math.floor(e.startTime);s.set("start",i(t))}if(e.stopTime){const t=Math.floor(e.stopTime);s.set("stop",i(t))}return e.subtitle&&s.set("subtitle",e.subtitle),!0===e.loop&&s.set("loop","1"),!0===e.autoplay&&s.set("autoplay","1"),!0===e.muted&&s.set("muted","1"),!1===e.title&&s.set("title","0"),!1===e.warningTitle&&s.set("warningTitle","0"),!1===e.controls&&s.set("controls","0"),!1===e.peertubeLink&&s.set("peertubeLink","0"),function(e,t){let s=!1;return t.forEach((()=>{s=!0})),s?e+"?"+t.toString():e}(t,s)}s.d(t,{d6:()=>o,fj:()=>a,nH:()=>i,h8:()=>n}),s(4182),s(5474),s(9794)},5474:(e,t,s)=>{s.d(t,{r:()=>o});const n=["linkify","autolink","emphasis","link","newline","list"],i=n.concat(["html_inline","html_block"]);function o(e){if(!e)return"";const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=/]/g,(e=>t[e]))}n.concat(["image"]),i.concat(["image"]).concat(["block","inline","heading","paragraph"])}}]);