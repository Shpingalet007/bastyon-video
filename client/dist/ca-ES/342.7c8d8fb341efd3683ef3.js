(self.webpackChunkpeertube_client=self.webpackChunkpeertube_client||[]).push([[342],{20593:function(Ot){"undefined"!=typeof window&&(Ot.exports=function(G){var I={};function p(b){if(I[b])return I[b].exports;var R=I[b]={i:b,l:!1,exports:{}};return G[b].call(R.exports,R,R.exports,p),R.l=!0,R.exports}return p.m=G,p.c=I,p.d=function(b,R,S){p.o(b,R)||Object.defineProperty(b,R,{enumerable:!0,get:S})},p.r=function(b){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(b,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(b,"__esModule",{value:!0})},p.t=function(b,R){if(1&R&&(b=p(b)),8&R||4&R&&"object"==typeof b&&b&&b.__esModule)return b;var S=Object.create(null);if(p.r(S),Object.defineProperty(S,"default",{enumerable:!0,value:b}),2&R&&"string"!=typeof b)for(var C in b)p.d(S,C,function(P){return b[P]}.bind(null,C));return S},p.n=function(b){var R=b&&b.__esModule?function(){return b.default}:function(){return b};return p.d(R,"a",R),R},p.o=function(b,R){return Object.prototype.hasOwnProperty.call(b,R)},p.p="/dist/",p(p.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(G,I,p){"use strict";var b=Object.prototype.hasOwnProperty,R="~";function S(){}function C(s,f,c){this.fn=s,this.context=f,this.once=c||!1}function P(s,f,c,T,y){if("function"!=typeof c)throw new TypeError("The listener must be a function");var g=new C(c,T||s,y),v=R?R+f:f;return s._events[v]?s._events[v].fn?s._events[v]=[s._events[v],g]:s._events[v].push(g):(s._events[v]=g,s._eventsCount++),s}function A(s,f){0==--s._eventsCount?s._events=new S:delete s._events[f]}function m(){this._events=new S,this._eventsCount=0}Object.create&&(S.prototype=Object.create(null),(new S).__proto__||(R=!1)),m.prototype.eventNames=function(){var c,T,f=[];if(0===this._eventsCount)return f;for(T in c=this._events)b.call(c,T)&&f.push(R?T.slice(1):T);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(c)):f},m.prototype.listeners=function(f){var T=this._events[R?R+f:f];if(!T)return[];if(T.fn)return[T.fn];for(var y=0,g=T.length,v=new Array(g);y<g;y++)v[y]=T[y].fn;return v},m.prototype.listenerCount=function(f){var T=this._events[R?R+f:f];return T?T.fn?1:T.length:0},m.prototype.emit=function(f,c,T,y,g,v){var r=R?R+f:f;if(!this._events[r])return!1;var d,i,t=this._events[r],e=arguments.length;if(t.fn){switch(t.once&&this.removeListener(f,t.fn,void 0,!0),e){case 1:return t.fn.call(t.context),!0;case 2:return t.fn.call(t.context,c),!0;case 3:return t.fn.call(t.context,c,T),!0;case 4:return t.fn.call(t.context,c,T,y),!0;case 5:return t.fn.call(t.context,c,T,y,g),!0;case 6:return t.fn.call(t.context,c,T,y,g,v),!0}for(i=1,d=new Array(e-1);i<e;i++)d[i-1]=arguments[i];t.fn.apply(t.context,d)}else{var u,n=t.length;for(i=0;i<n;i++)switch(t[i].once&&this.removeListener(f,t[i].fn,void 0,!0),e){case 1:t[i].fn.call(t[i].context);break;case 2:t[i].fn.call(t[i].context,c);break;case 3:t[i].fn.call(t[i].context,c,T);break;case 4:t[i].fn.call(t[i].context,c,T,y);break;default:if(!d)for(u=1,d=new Array(e-1);u<e;u++)d[u-1]=arguments[u];t[i].fn.apply(t[i].context,d)}}return!0},m.prototype.on=function(f,c,T){return P(this,f,c,T,!1)},m.prototype.once=function(f,c,T){return P(this,f,c,T,!0)},m.prototype.removeListener=function(f,c,T,y){var g=R?R+f:f;if(!this._events[g])return this;if(!c)return A(this,g),this;var v=this._events[g];if(v.fn)v.fn===c&&(!y||v.once)&&(!T||v.context===T)&&A(this,g);else{for(var r=0,t=[],e=v.length;r<e;r++)(v[r].fn!==c||y&&!v[r].once||T&&v[r].context!==T)&&t.push(v[r]);t.length?this._events[g]=1===t.length?t[0]:t:A(this,g)}return this},m.prototype.removeAllListeners=function(f){var c;return f?this._events[c=R?R+f:f]&&A(this,c):(this._events=new S,this._eventsCount=0),this},m.prototype.off=m.prototype.removeListener,m.prototype.addListener=m.prototype.on,m.prefixed=R,m.EventEmitter=m,G.exports=m},"./node_modules/url-toolkit/src/url-toolkit.js":function(G,I,p){var R,S,C,P,A;R=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,S=/^([^\/?#]*)([^]*)$/,C=/(?:\/|^)\.(?=\/)/g,P=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,G.exports=A={buildAbsoluteURL:function(m,s,f){if(f=f||{},m=m.trim(),!(s=s.trim())){if(!f.alwaysNormalize)return m;var c=A.parseURL(m);if(!c)throw new Error("Error trying to parse base URL.");return c.path=A.normalizePath(c.path),A.buildURLFromParts(c)}var T=A.parseURL(s);if(!T)throw new Error("Error trying to parse relative URL.");if(T.scheme)return f.alwaysNormalize?(T.path=A.normalizePath(T.path),A.buildURLFromParts(T)):s;var y=A.parseURL(m);if(!y)throw new Error("Error trying to parse base URL.");if(!y.netLoc&&y.path&&"/"!==y.path[0]){var g=S.exec(y.path);y.netLoc=g[1],y.path=g[2]}y.netLoc&&!y.path&&(y.path="/");var v={scheme:y.scheme,netLoc:T.netLoc,path:null,params:T.params,query:T.query,fragment:T.fragment};if(!T.netLoc&&(v.netLoc=y.netLoc,"/"!==T.path[0]))if(T.path){var r=y.path,t=r.substring(0,r.lastIndexOf("/")+1)+T.path;v.path=A.normalizePath(t)}else v.path=y.path,T.params||(v.params=y.params,T.query||(v.query=y.query));return null===v.path&&(v.path=f.alwaysNormalize?A.normalizePath(T.path):T.path),A.buildURLFromParts(v)},parseURL:function(m){var s=R.exec(m);return s?{scheme:s[1]||"",netLoc:s[2]||"",path:s[3]||"",params:s[4]||"",query:s[5]||"",fragment:s[6]||""}:null},normalizePath:function(m){for(m=m.split("").reverse().join("").replace(C,"");m.length!==(m=m.replace(P,"")).length;);return m.split("").reverse().join("")},buildURLFromParts:function(m){return m.scheme+m.netLoc+m.path+m.params+m.query+m.fragment}}},"./node_modules/webworkify-webpack/index.js":function(G,I,p){function b(f){var c={};function T(g){if(c[g])return c[g].exports;var v=c[g]={i:g,l:!1,exports:{}};return f[g].call(v.exports,v,v.exports,T),v.l=!0,v.exports}T.m=f,T.c=c,T.i=function(g){return g},T.d=function(g,v,r){T.o(g,v)||Object.defineProperty(g,v,{configurable:!1,enumerable:!0,get:r})},T.r=function(g){Object.defineProperty(g,"__esModule",{value:!0})},T.n=function(g){var v=g&&g.__esModule?function(){return g.default}:function(){return g};return T.d(v,"a",v),v},T.o=function(g,v){return Object.prototype.hasOwnProperty.call(g,v)},T.p="/",T.oe=function(g){throw console.error(g),g};var y=T(T.s=ENTRY_MODULE);return y.default||y}var R="[\\.|\\-|\\+|\\w|/|@]+",S="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+R+").*?\\)";function C(f){return(f+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function P(f){return!isNaN(1*f)}function A(f,c,T){var y={};y[T]=[];var g=c.toString(),v=g.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!v)return y;for(var e,r=v[1],t=new RegExp("(\\\\n|\\W)"+C(r)+S,"g");e=t.exec(g);)"dll-reference"!==e[3]&&y[T].push(e[3]);for(t=new RegExp("\\("+C(r)+'\\("(dll-reference\\s('+R+'))"\\)\\)'+S,"g");e=t.exec(g);)f[e[2]]||(y[T].push(e[1]),f[e[2]]=p(e[1]).m),y[e[2]]=y[e[2]]||[],y[e[2]].push(e[4]);for(var d=Object.keys(y),i=0;i<d.length;i++)for(var n=0;n<y[d[i]].length;n++)P(y[d[i]][n])&&(y[d[i]][n]=1*y[d[i]][n]);return y}function m(f){return Object.keys(f).reduce(function(T,y){return T||f[y].length>0},!1)}G.exports=function(f,c){var T={main:p.m},y=(c=c||{}).all?{main:Object.keys(T.main)}:function(f,c){for(var T={main:[c]},y={main:[]},g={main:{}};m(T);)for(var v=Object.keys(T),r=0;r<v.length;r++){var t=v[r],d=T[t].pop();if(g[t]=g[t]||{},!g[t][d]&&f[t][d]){g[t][d]=!0,y[t]=y[t]||[],y[t].push(d);for(var i=A(f,f[t][d],t),n=Object.keys(i),u=0;u<n.length;u++)T[n[u]]=T[n[u]]||[],T[n[u]]=T[n[u]].concat(i[n[u]])}}return y}(T,f),g="";Object.keys(y).filter(function(d){return"main"!==d}).forEach(function(d){for(var i=0;y[d][i];)i++;y[d].push(i),T[d][i]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",g=g+"var "+d+" = ("+b.toString().replace("ENTRY_MODULE",JSON.stringify(i))+")({"+y[d].map(function(n){return JSON.stringify(n)+": "+T[d][n].toString()}).join(",")+"});\n"}),g=g+"new (("+b.toString().replace("ENTRY_MODULE",JSON.stringify(f))+")({"+y.main.map(function(d){return JSON.stringify(d)+": "+T.main[d].toString()}).join(",")+"}))(self);";var v=new window.Blob([g],{type:"text/javascript"});if(c.bare)return v;var t=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(v),e=new window.Worker(t);return e.objectURL=t,e}},"./src/config.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"hlsDefaultConfig",function(){return r}),p.d(I,"mergeConfig",function(){return e}),p.d(I,"enableStreamingMode",function(){return d});var b=p("./src/controller/abr-controller.ts"),R=p("./src/empty.js"),S=p.n(R),C=p("./src/controller/buffer-controller.ts"),P=p("./src/controller/cap-level-controller.ts"),A=p("./src/controller/fps-controller.ts"),m=p("./src/utils/xhr-loader.ts"),s=p("./src/utils/fetch-loader.ts"),f=p("./src/utils/mediakeys-helper.ts"),c=p("./src/utils/logger.ts");function T(){return(T=Object.assign||function(i){for(var n=1;n<arguments.length;n++){var u=arguments[n];for(var a in u)Object.prototype.hasOwnProperty.call(u,a)&&(i[a]=u[a])}return i}).apply(this,arguments)}function y(i,n){var u=Object.keys(i);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(i);n&&(a=a.filter(function(o){return Object.getOwnPropertyDescriptor(i,o).enumerable})),u.push.apply(u,a)}return u}function g(i){for(var n=1;n<arguments.length;n++){var u=null!=arguments[n]?arguments[n]:{};n%2?y(Object(u),!0).forEach(function(a){v(i,a,u[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(u)):y(Object(u)).forEach(function(a){Object.defineProperty(i,a,Object.getOwnPropertyDescriptor(u,a))})}return i}function v(i,n,u){return n in i?Object.defineProperty(i,n,{value:u,enumerable:!0,configurable:!0,writable:!0}):i[n]=u,i}var r=g(g({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:m.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:b.default,bufferController:C.default,capLevelController:P.default,fpsController:A.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:f.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},{cueHandler:S.a,enableCEA708Captions:!1,enableWebVTT:!1,enableIMSC1:!1,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:void 0,subtitleTrackController:void 0,timelineController:void 0,audioStreamController:void 0,audioTrackController:void 0,emeController:void 0});function e(i,n){if((n.liveSyncDurationCount||n.liveMaxLatencyDurationCount)&&(n.liveSyncDuration||n.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==n.liveMaxLatencyDurationCount&&(void 0===n.liveSyncDurationCount||n.liveMaxLatencyDurationCount<=n.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==n.liveMaxLatencyDuration&&(void 0===n.liveSyncDuration||n.liveMaxLatencyDuration<=n.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return T({},i,n)}function d(i){var n=i.loader;n!==s.default&&n!==m.default?(c.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),i.progressive=!1):Object(s.fetchSupported)()&&(i.loader=s.default,i.progressive=!0,i.enableSoftwareAES=!0,c.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function(G,I,p){"use strict";p.r(I);var b=p("./src/polyfills/number.ts"),R=p("./src/utils/ewma-bandwidth-estimator.ts"),S=p("./src/events.ts"),C=p("./src/utils/buffer-helper.ts"),P=p("./src/errors.ts"),A=p("./src/types/loader.ts"),m=p("./src/utils/logger.ts");function s(T,y){for(var g=0;g<y.length;g++){var v=y[g];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(T,v.key,v)}}I.default=function(){function T(g){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=g;var v=g.config;this.bwEstimator=new R.default(v.abrEwmaSlowVoD,v.abrEwmaFastVoD,v.abrEwmaDefaultEstimate),this.registerListeners()}var y=T.prototype;return y.registerListeners=function(){var v=this.hls;v.on(S.Events.FRAG_LOADING,this.onFragLoading,this),v.on(S.Events.FRAG_LOADED,this.onFragLoaded,this),v.on(S.Events.FRAG_BUFFERED,this.onFragBuffered,this),v.on(S.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.on(S.Events.ERROR,this.onError,this)},y.unregisterListeners=function(){var v=this.hls;v.off(S.Events.FRAG_LOADING,this.onFragLoading,this),v.off(S.Events.FRAG_LOADED,this.onFragLoaded,this),v.off(S.Events.FRAG_BUFFERED,this.onFragBuffered,this),v.off(S.Events.LEVEL_LOADED,this.onLevelLoaded,this),v.off(S.Events.ERROR,this.onError,this)},y.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},y.onFragLoading=function(v,r){var e,t=r.frag;t.type!==A.PlaylistLevelType.MAIN||this.timer||(this.fragCurrent=t,this.partCurrent=null!=(e=r.part)?e:null,this.timer=self.setInterval(this.onCheck,100))},y.onLevelLoaded=function(v,r){var t=this.hls.config;r.details.live?this.bwEstimator.update(t.abrEwmaSlowLive,t.abrEwmaFastLive):this.bwEstimator.update(t.abrEwmaSlowVoD,t.abrEwmaFastVoD)},y._abandonRulesCheck=function(){var v=this.fragCurrent,r=this.partCurrent,t=this.hls,e=t.autoLevelEnabled,d=t.config,i=t.media;if(v&&i){var n=r?r.stats:v.stats,u=r?r.duration:v.duration;if(n.aborted)return m.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(e&&!i.paused&&i.playbackRate&&i.readyState){var a=performance.now()-n.loading.start,o=Math.abs(i.playbackRate);if(!(a<=500*u/o)){var l=t.levels,h=t.minAutoLevel,O=n.total||Math.max(n.loaded,Math.round(u*l[v.level].maxBitrate/8)),E=Math.max(1,n.bwEstimate?n.bwEstimate/8:1e3*n.loaded/a),x=(O-n.loaded)/E,D=i.currentTime,M=(C.BufferHelper.bufferInfo(i,D,d.maxBufferHole).end-D)/o;if(!(M>=2*u/o||x<=M)){var B,F=Number.POSITIVE_INFINITY;for(B=v.level-1;B>h&&!((F=u*l[B].maxBitrate/(6.4*E))<M);B--);if(!(F>=x)){var k=this.bwEstimator.getEstimate();m.logger.warn("Fragment "+v.sn+(r?" part "+r.index:"")+" of level "+v.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+B+"\n      Current BW estimate: "+(Object(b.isFiniteNumber)(k)?(k/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+x.toFixed(3)+" s\n      Estimated load time for the next fragment: "+F.toFixed(3)+" s\n      Time to underbuffer: "+M.toFixed(3)+" s"),t.nextLoadLevel=B,this.bwEstimator.sample(a,n.loaded),this.clearTimer(),v.loader&&(this.fragCurrent=this.partCurrent=null,v.loader.abort()),t.trigger(S.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:v,part:r,stats:n})}}}}}},y.onFragLoaded=function(v,r){var t=r.frag,e=r.part;if(t.type===A.PlaylistLevelType.MAIN&&Object(b.isFiniteNumber)(t.sn)){var d=e?e.stats:t.stats,i=e?e.duration:t.duration;if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var n=this.hls.levels[t.level],u=(n.loaded?n.loaded.bytes:0)+d.loaded,a=(n.loaded?n.loaded.duration:0)+i;n.loaded={bytes:u,duration:a},n.realBitrate=Math.round(8*u/a)}t.bitrateTest&&(this.onFragBuffered(S.Events.FRAG_BUFFERED,{stats:d,frag:t,part:e,id:t.type}),t.bitrateTest=!1)}},y.onFragBuffered=function(v,r){var t=r.frag,e=r.part,d=e?e.stats:t.stats;if(!d.aborted&&t.type===A.PlaylistLevelType.MAIN&&"initSegment"!==t.sn){var i=d.parsing.end-d.loading.start;this.bwEstimator.sample(i,d.loaded),d.bwEstimate=this.bwEstimator.getEstimate(),this.bitrateTestDelay=t.bitrateTest?i/1e3:0}},y.onError=function(v,r){switch(r.details){case P.ErrorDetails.FRAG_LOAD_ERROR:case P.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},y.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},y.getNextABRAutoLevel=function(){var v=this.fragCurrent,r=this.partCurrent,t=this.hls,e=t.maxAutoLevel,d=t.config,i=t.minAutoLevel,n=t.media,u=r?r.duration:v?v.duration:0,a=n?n.currentTime:0,o=n&&0!==n.playbackRate?Math.abs(n.playbackRate):1,l=this.bwEstimator?this.bwEstimator.getEstimate():d.abrEwmaDefaultEstimate,h=(C.BufferHelper.bufferInfo(n,a,d.maxBufferHole).end-a)/o,L=this.findBestLevel(l,i,e,h,d.abrBandWidthFactor,d.abrBandWidthUpFactor);if(L>=0)return L;m.logger.trace((h?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var O=u?Math.min(u,d.maxStarvationDelay):d.maxStarvationDelay,E=d.abrBandWidthFactor,x=d.abrBandWidthUpFactor;if(!h){var D=this.bitrateTestDelay;D&&(O=(u?Math.min(u,d.maxLoadingDelay):d.maxLoadingDelay)-D,m.logger.trace("bitrate test took "+Math.round(1e3*D)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*O)+" ms"),E=x=1)}return L=this.findBestLevel(l,i,e,h+O,E,x),Math.max(L,0)},y.findBestLevel=function(v,r,t,e,d,i){for(var n,u=this.fragCurrent,a=this.partCurrent,o=this.lastLoadedFragLevel,l=this.hls.levels,h=l[o],L=!(null==h||null===(n=h.details)||void 0===n||!n.live),O=null==h?void 0:h.codecSet,E=a?a.duration:u?u.duration:0,x=t;x>=r;x--){var D=l[x];if(D&&(!O||D.codecSet===O)){var B,M=D.details,F=(a?null==M?void 0:M.partTarget:null==M?void 0:M.averagetargetduration)||E,U=l[x].maxBitrate,k=U*F/(B=x<=o?d*v:i*v);if(m.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+x+"/"+Math.round(B)+"/"+U+"/"+F+"/"+e+"/"+k),B>U&&(!k||L&&!this.bitrateTestDelay||k<e))return x}}return-1},function(T,y,g){y&&s(T.prototype,y),g&&s(T,g)}(T,[{key:"nextAutoLevel",get:function(){var v=this._nextAutoLevel,r=this.bwEstimator;if(!(-1===v||r&&r.canEstimate()))return v;var t=this.getNextABRAutoLevel();return-1!==v&&(t=Math.min(v,t)),t},set:function(v){this._nextAutoLevel=v}}]),T}()},"./src/controller/base-playlist-controller.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"default",function(){return A});var b=p("./src/polyfills/number.ts"),R=p("./src/types/level.ts"),S=p("./src/controller/level-helper.ts"),C=p("./src/utils/logger.ts"),P=p("./src/errors.ts"),A=function(){function m(f,c){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=C.logger.log.bind(C.logger,c+":"),this.warn=C.logger.warn.bind(C.logger,c+":"),this.hls=f}var s=m.prototype;return s.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},s.onError=function(c,T){T.fatal&&T.type===P.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},s.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},s.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},s.stopLoad=function(){this.canLoad=!1,this.clearTimer()},s.switchParams=function(c,T){var y=null==T?void 0:T.renditionReports;if(y)for(var g=0;g<y.length;g++){var v=y[g],r=""+v.URI;if(r===c.substr(-r.length)){var t=parseInt(v["LAST-MSN"]),e=parseInt(v["LAST-PART"]);if(T&&this.hls.config.lowLatencyMode){var d=Math.min(T.age-T.partTarget,T.targetduration);void 0!==e&&d>T.partTarget&&(e+=1)}if(Object(b.isFiniteNumber)(t))return new R.HlsUrlParameters(t,Object(b.isFiniteNumber)(e)?e:void 0,R.HlsSkip.No)}}},s.loadPlaylist=function(c){},s.shouldLoadTrack=function(c){return this.canLoad&&c&&!!c.url&&(!c.details||c.details.live)},s.playlistLoaded=function(c,T,y){var g=this,v=T.details,r=T.stats,t=r.loading.end?Math.max(0,self.performance.now()-r.loading.end):0;if(v.advancedDateTime=Date.now()-t,v.live||null!=y&&y.live){if(v.reloaded(y),y&&this.log("live playlist "+c+" "+(v.advanced?"REFRESHED "+v.lastPartSn+"-"+v.lastPartIndex:"MISSED")),y&&v.fragments.length>0&&Object(S.mergeDetails)(y,v),!this.canLoad||!v.live)return;var e,d=void 0,i=void 0;if(v.canBlockReload&&v.endSN&&v.advanced){var n=this.hls.config.lowLatencyMode,u=v.lastPartSn,a=v.endSN,o=v.lastPartIndex,h=u===a;-1!==o?(d=h?a+1:u,i=h?n?0:o:o+1):d=a+1;var O=v.age,x=Math.min(O+v.ageHeader-v.partTarget,1.5*v.targetduration);if(x>0){if(y&&x>y.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+y.tuneInGoal+" to: "+x+" with playlist age: "+v.age),x=0;else{var D=Math.floor(x/v.targetduration);d+=D,void 0!==i&&(i+=Math.round(x%v.targetduration/v.partTarget)),this.log("CDN Tune-in age: "+v.ageHeader+"s last advanced "+O.toFixed(2)+"s goal: "+x+" skip sn "+D+" to part "+i)}v.tuneInGoal=x}if(e=this.getDeliveryDirectives(v,T.deliveryDirectives,d,i),n||!h)return void this.loadPlaylist(e)}else e=this.getDeliveryDirectives(v,T.deliveryDirectives,d,i);var F=Object(S.computeReloadInterval)(v,r);void 0!==d&&v.canBlockReload&&(F-=v.partTarget||1),this.log("reload live playlist "+c+" in "+Math.round(F)+" ms"),this.timer=self.setTimeout(function(){return g.loadPlaylist(e)},F)}else this.clearTimer()},s.getDeliveryDirectives=function(c,T,y,g){var v=Object(R.getSkipValue)(c,y);return null!=T&&T.skip&&c.deltaUpdateFailed&&(y=T.msn,g=T.part,v=R.HlsSkip.No),new R.HlsUrlParameters(y,g,v)},s.retryLoadingOrFail=function(c){var v,T=this,y=this.hls.config,g=this.retryCount<y.levelLoadingMaxRetry;if(g)if(this.retryCount++,c.details.indexOf("LoadTimeOut")>-1&&null!==(v=c.context)&&void 0!==v&&v.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+c.details+'"'),this.loadPlaylist();else{var r=Math.min(Math.pow(2,this.retryCount)*y.levelLoadingRetryDelay,y.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return T.loadPlaylist()},r),this.warn("retry playlist loading #"+this.retryCount+" in "+r+' ms after "'+c.details+'"')}else this.warn('cannot recover from error "'+c.details+'"'),this.clearTimer(),c.fatal=!0;return g},m}()},"./src/controller/base-stream-controller.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"State",function(){return a}),p.d(I,"default",function(){return o});var b=p("./src/polyfills/number.ts"),R=p("./src/task-loop.ts"),S=p("./src/controller/fragment-tracker.ts"),C=p("./src/utils/buffer-helper.ts"),P=p("./src/utils/logger.ts"),A=p("./src/events.ts"),m=p("./src/errors.ts"),s=p("./src/types/transmuxer.ts"),f=p("./src/utils/mp4-tools.ts"),c=p("./src/utils/discontinuities.ts"),T=p("./src/controller/fragment-finders.ts"),y=p("./src/controller/level-helper.ts"),g=p("./src/loader/fragment-loader.ts"),v=p("./src/crypt/decrypter.ts"),r=p("./src/utils/time-ranges.ts"),t=p("./src/types/loader.ts");function e(l,h){for(var L=0;L<h.length;L++){var O=h[L];O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(l,O.key,O)}}function n(l,h){l.prototype=Object.create(h.prototype),l.prototype.constructor=l,u(l,h)}function u(l,h){return(u=Object.setPrototypeOf||function(O,E){return O.__proto__=E,O})(l,h)}var a={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},o=function(l){function h(O,E,x){var D;return(D=l.call(this)||this).hls=void 0,D.fragPrevious=null,D.fragCurrent=null,D.fragmentTracker=void 0,D.transmuxer=null,D._state=a.STOPPED,D.media=void 0,D.mediaBuffer=void 0,D.config=void 0,D.bitrateTest=!1,D.lastCurrentTime=0,D.nextLoadPosition=0,D.startPosition=0,D.loadedmetadata=!1,D.fragLoadError=0,D.retryDate=0,D.levels=null,D.fragmentLoader=void 0,D.levelLastLoaded=null,D.startFragRequested=!1,D.decrypter=void 0,D.initPTS=[],D.onvseeking=null,D.onvended=null,D.logPrefix="",D.log=void 0,D.warn=void 0,D.logPrefix=x,D.log=P.logger.log.bind(P.logger,x+":"),D.warn=P.logger.warn.bind(P.logger,x+":"),D.hls=O,D.fragmentLoader=new g.default(O.config),D.fragmentTracker=E,D.config=O.config,D.decrypter=new v.default(O,O.config),O.on(A.Events.KEY_LOADED,D.onKeyLoaded,function(l){if(void 0===l)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return l}(D)),D}n(h,l);var L=h.prototype;return L.doTick=function(){this.onTickEnd()},L.onTickEnd=function(){},L.startLoad=function(E){},L.stopLoad=function(){this.fragmentLoader.abort();var E=this.fragCurrent;E&&this.fragmentTracker.removeFragment(E),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=a.STOPPED},L._streamEnded=function(E,x){var D=this.fragCurrent;if(!x.live&&D&&D.sn===x.endSN&&!E.nextStart){var F=this.fragmentTracker.getState(D);return F===S.FragmentState.PARTIAL||F===S.FragmentState.OK}return!1},L.onMediaAttached=function(E,x){var D=this.media=this.mediaBuffer=x.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),D.addEventListener("seeking",this.onvseeking),D.addEventListener("ended",this.onvended);var M=this.config;this.levels&&M.autoStartLoad&&this.state===a.STOPPED&&this.startLoad(M.startPosition)},L.onMediaDetaching=function(){var E=this.media;null!=E&&E.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),E&&(E.removeEventListener("seeking",this.onvseeking),E.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},L.onMediaSeeking=function(){var E=this.config,x=this.fragCurrent,D=this.media,F=this.state,B=D?D.currentTime:0,U=C.BufferHelper.bufferInfo(this.mediaBuffer||D,B,E.maxBufferHole);if(this.log("media seeking to "+(Object(b.isFiniteNumber)(B)?B.toFixed(3):B)+", state: "+F),F===a.ENDED)this.resetLoadingState();else if(x&&!U.len){var k=E.maxFragLookUpTolerance,W=B>x.start+x.duration+k;(B<x.start-k||W)&&(W&&x.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),x.loader.abort()),this.resetLoadingState())}D&&(this.lastCurrentTime=B),!this.loadedmetadata&&!U.len&&(this.nextLoadPosition=this.startPosition=B),this.tickImmediate()},L.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},L.onKeyLoaded=function(E,x){if(this.state===a.KEY_LOADING&&x.frag===this.fragCurrent&&this.levels){this.state=a.IDLE;var D=this.levels[x.frag.level].details;D&&this.loadFragment(x.frag,D,x.frag.start)}},L.onHandlerDestroying=function(){this.stopLoad(),l.prototype.onHandlerDestroying.call(this)},L.onHandlerDestroyed=function(){this.state=a.STOPPED,this.hls.off(A.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,l.prototype.onHandlerDestroyed.call(this)},L.loadKey=function(E,x){this.log("Loading key for "+E.sn+" of ["+x.startSN+"-"+x.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+E.level),this.state=a.KEY_LOADING,this.fragCurrent=E,this.hls.trigger(A.Events.KEY_LOADING,{frag:E})},L.loadFragment=function(E,x,D){this._loadFragForPlayback(E,x,D)},L._loadFragForPlayback=function(E,x,D){var M=this;this._doFragLoad(E,x,D,function(U){if(M.fragContextChanged(E))return M.warn("Fragment "+E.sn+(U.part?" p: "+U.part.index:"")+" of level "+E.level+" was dropped during download."),void M.fragmentTracker.removeFragment(E);E.stats.chunkCount++,M._handleFragmentLoadProgress(U)}).then(function(B){if(B){M.fragLoadError=0;var U=M.state;if(M.fragContextChanged(E))return void((U===a.FRAG_LOADING||U===a.BACKTRACKING||!M.fragCurrent&&U===a.PARSING)&&(M.fragmentTracker.removeFragment(E),M.state=a.IDLE));if("payload"in B&&(M.log("Loaded fragment "+E.sn+" of level "+E.level),M.hls.trigger(A.Events.FRAG_LOADED,B),M.state===a.BACKTRACKING))return M.fragmentTracker.backtrack(E,B),void M.resetFragmentLoading(E);M._handleFragmentLoadComplete(B)}}).catch(function(B){M.warn(B),M.resetFragmentLoading(E)})},L.flushMainBuffer=function(E,x,D){if(void 0===D&&(D=null),E-x){var M={startOffset:E,endOffset:x,type:D};this.fragLoadError=0,this.hls.trigger(A.Events.BUFFER_FLUSHING,M)}},L._loadInitSegment=function(E){var x=this;this._doFragLoad(E).then(function(D){if(!D||x.fragContextChanged(E)||!x.levels)throw new Error("init load aborted");return D}).then(function(D){var M=x.hls,F=D.payload,B=E.decryptdata;if(F&&F.byteLength>0&&B&&B.key&&B.iv&&"AES-128"===B.method){var U=self.performance.now();return x.decrypter.webCryptoDecrypt(new Uint8Array(F),B.key.buffer,B.iv.buffer).then(function(k){var N=self.performance.now();return M.trigger(A.Events.FRAG_DECRYPTED,{frag:E,payload:k,stats:{tstart:U,tdecrypt:N}}),D.payload=k,D})}return D}).then(function(D){var M=x.fragCurrent,F=x.hls,B=x.levels;if(!B)throw new Error("init load aborted, missing levels");console.assert(B[E.level].details,"Level details are defined when init segment is loaded");var k=E.stats;x.state=a.IDLE,x.fragLoadError=0,E.data=new Uint8Array(D.payload),k.parsing.start=k.buffering.start=self.performance.now(),k.parsing.end=k.buffering.end=self.performance.now(),D.frag===M&&F.trigger(A.Events.FRAG_BUFFERED,{stats:k,frag:M,part:null,id:E.type}),x.tick()}).catch(function(D){x.warn(D),x.resetFragmentLoading(E)})},L.fragContextChanged=function(E){var x=this.fragCurrent;return!E||!x||E.level!==x.level||E.sn!==x.sn||E.urlId!==x.urlId},L.fragBufferedComplete=function(E,x){this.log("Buffered "+E.type+" sn: "+E.sn+(x?" part: "+x.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+E.level+" "+r.default.toString(C.BufferHelper.getBuffered(this.mediaBuffer?this.mediaBuffer:this.media))),this.state=a.IDLE,this.tick()},L._handleFragmentLoadComplete=function(E){var x=this.transmuxer;if(x){var D=E.frag,M=E.part,F=E.partsLoaded,B=!F||0===F.length||F.some(function(k){return!k}),U=new s.ChunkMetadata(D.level,D.sn,D.stats.chunkCount+1,0,M?M.index:-1,!B);x.flush(U)}},L._handleFragmentLoadProgress=function(E){},L._doFragLoad=function(E,x,D,M){var F=this;if(void 0===D&&(D=null),!this.levels)throw new Error("frag load aborted, missing levels");if(D=Math.max(E.start,D||0),this.config.lowLatencyMode&&x){var B=x.partList;if(B&&M){D>E.end&&x.fragmentHint&&(E=x.fragmentHint);var U=this.getNextPart(B,E,D);if(U>-1){var k=B[U];return this.log("Loading part sn: "+E.sn+" p: "+k.index+" cc: "+E.cc+" of playlist ["+x.startSN+"-"+x.endSN+"] parts [0-"+U+"-"+(B.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+E.level+", target: "+parseFloat(D.toFixed(3))),this.nextLoadPosition=k.start+k.duration,this.state=a.FRAG_LOADING,this.hls.trigger(A.Events.FRAG_LOADING,{frag:E,part:B[U],targetBufferTime:D}),this.doFragPartsLoad(E,B,U,M).catch(function(N){return F.handleFragLoadError(N)})}if(!E.url||this.loadedEndOfParts(B,D))return Promise.resolve(null)}}return this.log("Loading fragment "+E.sn+" cc: "+E.cc+" "+(x?"of ["+x.startSN+"-"+x.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+E.level+", target: "+parseFloat(D.toFixed(3))),Object(b.isFiniteNumber)(E.sn)&&!this.bitrateTest&&(this.nextLoadPosition=E.start+E.duration),this.state=a.FRAG_LOADING,this.hls.trigger(A.Events.FRAG_LOADING,{frag:E,targetBufferTime:D}),this.fragmentLoader.load(E,M).catch(function(N){return F.handleFragLoadError(N)})},L.doFragPartsLoad=function(E,x,D,M){var F=this;return new Promise(function(B,U){var k=[];!function K(W){var w=x[W];F.fragmentLoader.loadPart(E,w,M).then(function(H){k[w.index]=H;var j=H.part;F.hls.trigger(A.Events.FRAG_LOADED,H);var z=x[W+1];if(!z||z.fragment!==E)return B({frag:E,part:j,partsLoaded:k});K(W+1)}).catch(U)}(D)})},L.handleFragLoadError=function(E){var x=E.data;return x&&x.details===m.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(x.frag,x.part):this.hls.trigger(A.Events.ERROR,x),null},L._handleTransmuxerFlush=function(E){var x=this.getCurrentContext(E);if(x&&this.state===a.PARSING){var D=x.frag,M=x.part,F=x.level,B=self.performance.now();D.stats.parsing.end=B,M&&(M.stats.parsing.end=B),this.updateLevelTiming(D,M,F,E.partial)}else this.fragCurrent||(this.state=a.IDLE)},L.getCurrentContext=function(E){var x=this.levels,D=E.level,M=E.sn,F=E.part;if(!x||!x[D])return this.warn("Levels object was unset while buffering fragment "+M+" of level "+D+". The current chunk will not be buffered."),null;var B=x[D],U=F>-1?Object(y.getPartWith)(B,M,F):null,k=U?U.fragment:Object(y.getFragmentWithSN)(B,M,this.fragCurrent);return k?{frag:k,part:U,level:B}:null},L.bufferFragmentData=function(E,x,D,M){if(E&&this.state===a.PARSING){var F=E.data1,B=E.data2,U=F;F&&B&&(U=Object(f.appendUint8Array)(F,B)),U&&U.length&&(this.hls.trigger(A.Events.BUFFER_APPENDING,{type:E.type,frag:x,part:D,chunkMeta:M,parent:x.type,data:U}),E.dropped&&E.independent&&!D&&this.flushBufferGap(x))}},L.flushBufferGap=function(E){var x=this.media;if(x){if(!C.BufferHelper.isBuffered(x,x.currentTime))return void this.flushMainBuffer(0,E.start);var D=x.currentTime,M=C.BufferHelper.bufferInfo(x,D,0),B=Math.min(2*this.config.maxFragLookUpTolerance,.25*E.duration),U=Math.max(Math.min(E.start-B,M.end-B),D+B);E.start-U>B&&this.flushMainBuffer(U,E.start)}},L.getFwdBufferInfo=function(E,x){var D=this.config,M=this.getLoadPosition();if(!Object(b.isFiniteNumber)(M))return null;var F=C.BufferHelper.bufferInfo(E,M,D.maxBufferHole);if(0===F.len&&void 0!==F.nextStart){var B=this.fragmentTracker.getBufferedFrag(M,x);if(B&&F.nextStart<B.end)return C.BufferHelper.bufferInfo(E,M,Math.max(F.nextStart,D.maxBufferHole))}return F},L.getMaxBufferLength=function(E){var D,x=this.config;return D=E?Math.max(8*x.maxBufferSize/E,x.maxBufferLength):x.maxBufferLength,Math.min(D,x.maxMaxBufferLength)},L.reduceMaxBufferLength=function(E){var x=this.config;return x.maxMaxBufferLength>=(E||x.maxBufferLength)&&(x.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+x.maxMaxBufferLength+"s"),!0)},L.getNextFragment=function(E,x){var D,M,F=x.fragments,B=F.length;if(!B)return null;var N,U=this.config,k=F[0].start;if(x.live){var K=U.initialLiveManifestSize;if(B<K)return this.warn("Not enough fragments to start playback (have: "+B+", need: "+K+")"),null;!x.PTSKnown&&!this.startFragRequested&&-1===this.startPosition&&(N=this.getInitialLiveFragment(x,F),this.startPosition=N?this.hls.liveSyncPosition||N.start:E)}else E<=k&&(N=F[0]);return N||(N=this.getFragmentAtPosition(E,U.lowLatencyMode?x.partEnd:x.fragmentEnd,x)),null!==(D=N)&&void 0!==D&&D.initSegment&&!(null!==(M=N)&&void 0!==M&&M.initSegment.data)&&!this.bitrateTest&&(N=N.initSegment),N},L.getNextPart=function(E,x,D){for(var M=-1,F=!1,B=!0,U=0,k=E.length;U<k;U++){var N=E[U];if(B=B&&!N.independent,M>-1&&D<N.start)break;var K=N.loaded;!K&&(F||N.independent||B)&&N.fragment===x&&(M=U),F=K}return M},L.loadedEndOfParts=function(E,x){var D=E[E.length-1];return D&&x>D.start&&D.loaded},L.getInitialLiveFragment=function(E,x){var D=this.fragPrevious,M=null;if(D){if(E.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+D.programDateTime),M=Object(T.findFragmentByPDT)(x,D.endProgramDateTime,this.config.maxFragLookUpTolerance)),!M){var F=D.sn+1;if(F>=E.startSN&&F<=E.endSN){var B=x[F-E.startSN];D.cc===B.cc&&this.log("Live playlist, switching playlist, load frag with next SN: "+(M=B).sn)}M||(M=Object(T.findFragWithCC)(x,D.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+M.sn)}}else{var U=this.hls.liveSyncPosition;null!==U&&(M=this.getFragmentAtPosition(U,this.bitrateTest?E.fragmentEnd:E.edge,E))}return M},L.getFragmentAtPosition=function(E,x,D){var W,M=this.config,F=this.fragPrevious,B=D.fragments,U=D.endSN,k=D.fragmentHint,N=M.maxFragLookUpTolerance,K=!!(M.lowLatencyMode&&D.partList&&k);if(K&&k&&!this.bitrateTest&&(B=B.concat(k),U=k.sn),E<x){var w=E>x-N?0:N;W=Object(T.findFragmentByPTS)(F,B,E,w)}else W=B[B.length-1];if(W){var H=W.sn-D.startSN,j=F&&W.level===F.level,z=B[H+1];if(this.fragmentTracker.getState(W)===S.FragmentState.BACKTRACKED){W=null;for(var X=H;B[X]&&this.fragmentTracker.getState(B[X])===S.FragmentState.BACKTRACKED;)W=F?B[X--]:B[--X];W||(W=z)}else F&&W.sn===F.sn&&!K&&j&&(W.sn<U&&this.fragmentTracker.getState(z)!==S.FragmentState.OK?(this.log("SN "+W.sn+" just loaded, load next one: "+z.sn),W=z):W=null)}return W},L.synchronizeToLiveEdge=function(E){var x=this.config,D=this.media;if(D){var M=this.hls.liveSyncPosition,F=D.currentTime,U=E.edge,k=F>=E.fragments[0].start-x.maxFragLookUpTolerance&&F<=U;null!==M&&D.duration>M&&(F<M||!k)&&(!k&&D.readyState<4||F<U-(void 0!==x.liveMaxLatencyDuration?x.liveMaxLatencyDuration:x.liveMaxLatencyDurationCount*E.targetduration))&&(this.loadedmetadata||(this.nextLoadPosition=M),D.readyState&&(this.warn("Playback: "+F.toFixed(3)+" is located too far from the end of live sliding playlist: "+U+", reset currentTime to : "+M.toFixed(3)),D.currentTime=M))}},L.alignPlaylists=function(E,x){var M=this.levelLastLoaded,F=this.fragPrevious,B=null!==M?this.levels[M]:null,U=E.fragments.length;if(!U)return this.warn("No fragments in live playlist"),0;var k=E.fragments[0].start,N=!x,K=E.alignedSliding&&Object(b.isFiniteNumber)(k);if(N||!K&&!k){Object(c.alignStream)(F,B,E);var W=E.fragments[0].start;return this.log("Live playlist sliding: "+W.toFixed(2)+" start-sn: "+(x?x.startSN:"na")+"->"+E.startSN+" prev-sn: "+(F?F.sn:"na")+" fragments: "+U),W}return k},L.waitForCdnTuneIn=function(E){return E.live&&E.canBlockReload&&E.tuneInGoal>Math.max(E.partHoldBack,3*E.partTarget)},L.setStartPosition=function(E,x){var D=this.startPosition;if(D<x&&(D=-1),-1===D||-1===this.lastCurrentTime){var M=E.startTimeOffset;Object(b.isFiniteNumber)(M)?(D=x+M,M<0&&(D+=E.totalduration),D=Math.min(Math.max(x,D),x+E.totalduration),this.log("Start time offset "+M+" found in playlist, adjust startPosition to "+D),this.startPosition=D):E.live?D=this.hls.liveSyncPosition||x:this.startPosition=D=0,this.lastCurrentTime=D}this.nextLoadPosition=D},L.getLoadPosition=function(){var E=this.media,x=0;return this.loadedmetadata&&E?x=E.currentTime:this.nextLoadPosition&&(x=this.nextLoadPosition),x},L.handleFragLoadAborted=function(E,x){this.transmuxer&&"initSegment"!==E.sn&&E.stats.aborted&&(this.warn("Fragment "+E.sn+(x?" part"+x.index:"")+" of level "+E.level+" was aborted"),this.resetFragmentLoading(E))},L.resetFragmentLoading=function(E){(!this.fragCurrent||!this.fragContextChanged(E))&&(this.state=a.IDLE)},L.onFragmentOrKeyLoadError=function(E,x){if(!x.fatal){var D=x.frag;if(D&&D.type===E){var M=this.fragCurrent;console.assert(M&&D.sn===M.sn&&D.level===M.level&&D.urlId===M.urlId,"Frag load error must match current frag to retry");var F=this.config;if(this.fragLoadError+1<=F.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(D.level))return;var B=Math.min(Math.pow(2,this.fragLoadError)*F.fragLoadingRetryDelay,F.fragLoadingMaxRetryTimeout);this.warn("Fragment "+D.sn+" of "+E+" "+D.level+" failed to load, retrying in "+B+"ms"),this.retryDate=self.performance.now()+B,this.fragLoadError++,this.state=a.FRAG_LOADING_WAITING_RETRY}else x.levelRetry?(E===t.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=a.IDLE):(P.logger.error(x.details+" reaches max retry, redispatch as fatal ..."),x.fatal=!0,this.hls.stopLoad(),this.state=a.ERROR)}}},L.afterBufferFlushed=function(E,x,D){if(E){var M=C.BufferHelper.getBuffered(E);this.fragmentTracker.detectEvictedFragments(x,M,D),this.state===a.ENDED&&this.resetLoadingState()}},L.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=a.IDLE},L.resetLiveStartWhenNotLoaded=function(E){if(!this.loadedmetadata){this.startFragRequested=!1;var x=this.levels?this.levels[E].details:null;if(null!=x&&x.live)return this.startPosition=-1,this.setStartPosition(x,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},L.updateLevelTiming=function(E,x,D,M){var F=this,B=D.details;console.assert(!!B,"level.details must be defined"),Object.keys(E.elementaryStreams).reduce(function(k,N){var K=E.elementaryStreams[N];if(K){var W=K.endPTS-K.startPTS;if(W<=0)return F.warn("Could not parse fragment "+E.sn+" "+N+" duration reliably ("+W+") resetting transmuxer to fallback to playlist timing"),F.resetTransmuxer(),k||!1;var w=M?0:Object(y.updateFragPTSDTS)(B,E,K.startPTS,K.endPTS,K.startDTS,K.endDTS);return F.hls.trigger(A.Events.LEVEL_PTS_UPDATED,{details:B,level:D,drift:w,type:N,frag:E,start:K.startPTS,end:K.endPTS}),!0}return k},!1)?(this.state=a.PARSED,this.hls.trigger(A.Events.FRAG_PARSED,{frag:E,part:x})):this.resetLoadingState()},L.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},function(l,h,L){h&&e(l.prototype,h),L&&e(l,L)}(h,[{key:"state",get:function(){return this._state},set:function(E){var x=this._state;x!==E&&(this._state=E,this.log(x+"->"+E))}}]),h}(R.default)},"./src/controller/buffer-controller.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"default",function(){return T});var b=p("./src/polyfills/number.ts"),R=p("./src/events.ts"),S=p("./src/utils/logger.ts"),C=p("./src/errors.ts"),P=p("./src/utils/buffer-helper.ts"),A=p("./src/utils/mediasource-helper.ts"),m=p("./src/loader/fragment.ts"),s=p("./src/controller/buffer-operation-queue.ts"),f=Object(A.getMediaSource)(),c=/([ha]vc.)(?:\.[^.,]+)+/,T=function(){function y(v){var r=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=r.hls,e=r.media,d=r.mediaSource;S.logger.log("[buffer-controller]: Media source opened"),e&&(r.updateMediaElementDuration(),t.trigger(R.Events.MEDIA_ATTACHED,{media:e})),d&&d.removeEventListener("sourceopen",r._onMediaSourceOpen),r.checkPendingTracks()},this._onMediaSourceClose=function(){S.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){S.logger.log("[buffer-controller]: Media source ended")},this.hls=v,this._initSourceBuffer(),this.registerListeners()}var g=y.prototype;return g.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},g.destroy=function(){this.unregisterListeners(),this.details=null},g.registerListeners=function(){var r=this.hls;r.on(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.on(R.Events.BUFFER_RESET,this.onBufferReset,this),r.on(R.Events.BUFFER_APPENDING,this.onBufferAppending,this),r.on(R.Events.BUFFER_CODECS,this.onBufferCodecs,this),r.on(R.Events.BUFFER_EOS,this.onBufferEos,this),r.on(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(R.Events.LEVEL_UPDATED,this.onLevelUpdated,this),r.on(R.Events.FRAG_PARSED,this.onFragParsed,this),r.on(R.Events.FRAG_CHANGED,this.onFragChanged,this)},g.unregisterListeners=function(){var r=this.hls;r.off(R.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(R.Events.MANIFEST_PARSED,this.onManifestParsed,this),r.off(R.Events.BUFFER_RESET,this.onBufferReset,this),r.off(R.Events.BUFFER_APPENDING,this.onBufferAppending,this),r.off(R.Events.BUFFER_CODECS,this.onBufferCodecs,this),r.off(R.Events.BUFFER_EOS,this.onBufferEos,this),r.off(R.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(R.Events.LEVEL_UPDATED,this.onLevelUpdated,this),r.off(R.Events.FRAG_PARSED,this.onFragParsed,this),r.off(R.Events.FRAG_CHANGED,this.onFragChanged,this)},g._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new s.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},g.onManifestParsed=function(r,t){var e=2;(t.audio&&!t.video||!t.altAudio)&&(e=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=e,this.details=null,S.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},g.onMediaAttaching=function(r,t){var e=this.media=t.media;if(e&&f){var d=this.mediaSource=new f;d.addEventListener("sourceopen",this._onMediaSourceOpen),d.addEventListener("sourceended",this._onMediaSourceEnded),d.addEventListener("sourceclose",this._onMediaSourceClose),e.src=self.URL.createObjectURL(d),this._objectUrl=e.src}},g.onMediaDetaching=function(){var r=this.media,t=this.mediaSource,e=this._objectUrl;if(t){if(S.logger.log("[buffer-controller]: media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(d){S.logger.warn("[buffer-controller]: onMediaDetaching: "+d.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),r&&(e&&self.URL.revokeObjectURL(e),r.src===e?(r.removeAttribute("src"),r.load()):S.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(R.Events.MEDIA_DETACHED,void 0)},g.onBufferReset=function(){var r=this;this.getSourceBufferTypes().forEach(function(t){var e=r.sourceBuffer[t];try{e&&(r.removeBufferListeners(t),r.mediaSource&&r.mediaSource.removeSourceBuffer(e),r.sourceBuffer[t]=void 0)}catch(d){S.logger.warn("[buffer-controller]: Failed to reset the "+t+" buffer",d)}}),this._initSourceBuffer()},g.onBufferCodecs=function(r,t){var e=this,d=this.getSourceBufferTypes().length;Object.keys(t).forEach(function(i){if(d){var n=e.tracks[i];if(n&&"function"==typeof n.buffer.changeType){var u=t[i],a=u.codec,o=u.levelCodec,l=u.container;(n.levelCodec||n.codec).replace(c,"$1")!==(o||a).replace(c,"$1")&&e.appendChangeType(i,l+";codecs="+(o||a))}}else e.pendingTracks[i]=t[i]}),!d&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},g.appendChangeType=function(r,t){var e=this,d=this.operationQueue,i={execute:function(){var u=e.sourceBuffer[r];u&&(S.logger.log("[buffer-controller]: changing "+r+" sourceBuffer type to "+t),u.changeType(t)),d.shiftAndExecuteNext(r)},onStart:function(){},onComplete:function(){},onError:function(u){S.logger.warn("[buffer-controller]: Failed to change "+r+" SourceBuffer type",u)}};d.append(i,r)},g.onBufferAppending=function(r,t){var e=this,d=this.hls,i=this.operationQueue,n=this.tracks,u=t.data,a=t.type,o=t.frag,l=t.part,h=t.chunkMeta,L=h.buffering[a],O=self.performance.now();L.start=O;var E=o.stats.buffering,x=l?l.stats.buffering:null;0===E.start&&(E.start=O),x&&0===x.start&&(x.start=O);var D=n.audio,M="audio"===a&&1===h.id&&"audio/mpeg"===(null==D?void 0:D.container);i.append({execute:function(){if(L.executeStart=self.performance.now(),M){var U=e.sourceBuffer[a];if(U){var k=o.start-U.timestampOffset;Math.abs(k)>=.1&&(S.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+o.start+" (delta: "+k+") sn: "+o.sn+")"),U.timestampOffset=o.start)}}e.appendExecutor(u,a)},onStart:function(){},onComplete:function(){var U=self.performance.now();L.executeEnd=L.end=U,0===E.first&&(E.first=U),x&&0===x.first&&(x.first=U);var k=e.sourceBuffer,N={};for(var K in k)N[K]=P.BufferHelper.getBuffered(k[K]);e.appendError=0,e.hls.trigger(R.Events.BUFFER_APPENDED,{type:a,frag:o,part:l,chunkMeta:h,parent:o.type,timeRanges:N})},onError:function(U){S.logger.error("[buffer-controller]: Error encountered while trying to append to the "+a+" SourceBuffer",U);var k={type:C.ErrorTypes.MEDIA_ERROR,parent:o.type,details:C.ErrorDetails.BUFFER_APPEND_ERROR,err:U,fatal:!1};U.code===DOMException.QUOTA_EXCEEDED_ERR?k.details=C.ErrorDetails.BUFFER_FULL_ERROR:(e.appendError++,k.details=C.ErrorDetails.BUFFER_APPEND_ERROR,e.appendError>d.config.appendErrorMaxRetry&&(S.logger.error("[buffer-controller]: Failed "+d.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),k.fatal=!0)),d.trigger(R.Events.ERROR,k)}},a)},g.onBufferFlushing=function(r,t){var e=this,d=this.operationQueue,i=function(u){return{execute:e.removeExecutor.bind(e,u,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){e.hls.trigger(R.Events.BUFFER_FLUSHED,{type:u})},onError:function(o){S.logger.warn("[buffer-controller]: Failed to remove from "+u+" SourceBuffer",o)}}};t.type?d.append(i(t.type),t.type):this.getSourceBufferTypes().forEach(function(n){d.append(i(n),n)})},g.onFragParsed=function(r,t){var e=this,d=t.frag,i=t.part,n=[],u=i?i.elementaryStreams:d.elementaryStreams;u[m.ElementaryStreamTypes.AUDIOVIDEO]?n.push("audiovideo"):(u[m.ElementaryStreamTypes.AUDIO]&&n.push("audio"),u[m.ElementaryStreamTypes.VIDEO]&&n.push("video"));0===n.length&&S.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+d.type+" level: "+d.level+" sn: "+d.sn),this.blockBuffers(function(){var l=self.performance.now();d.stats.buffering.end=l,i&&(i.stats.buffering.end=l),e.hls.trigger(R.Events.FRAG_BUFFERED,{frag:d,part:i,stats:i?i.stats:d.stats,id:d.type})},n)},g.onFragChanged=function(r,t){this.flushBackBuffer()},g.onBufferEos=function(r,t){var e=this;this.getSourceBufferTypes().reduce(function(i,n){var u=e.sourceBuffer[n];return(!t.type||t.type===n)&&u&&!u.ended&&(u.ended=!0,S.logger.log("[buffer-controller]: "+n+" sourceBuffer now EOS")),i&&!(u&&!u.ended)},!0)&&this.blockBuffers(function(){var i=e.mediaSource;!i||"open"!==i.readyState||i.endOfStream()})},g.onLevelUpdated=function(r,t){var e=t.details;!e.fragments.length||(this.details=e,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},g.flushBackBuffer=function(){var r=this.hls,t=this.details,e=this.media,d=this.sourceBuffer;if(e&&null!==t){var i=this.getSourceBufferTypes();if(i.length){var n=t.live&&null!==r.config.liveBackBufferLength?r.config.liveBackBufferLength:r.config.backBufferLength;if(Object(b.isFiniteNumber)(n)&&!(n<0)){var u=e.currentTime,a=t.levelTargetDuration,o=Math.max(n,a),l=Math.floor(u/a)*a-o;i.forEach(function(h){var L=d[h];if(L){var O=P.BufferHelper.getBuffered(L);O.length>0&&l>O.start(0)&&(r.trigger(R.Events.BACK_BUFFER_REACHED,{bufferEnd:l}),t.live&&r.trigger(R.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:l}),r.trigger(R.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:l,type:h}))}})}}}},g.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var r=this.details,t=this.hls,d=this.mediaSource,i=r.fragments[0].start+r.totalduration,n=this.media.duration,u=Object(b.isFiniteNumber)(d.duration)?d.duration:0;r.live&&t.config.liveDurationInfinity?(S.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),d.duration=1/0,this.updateSeekableRange(r)):(i>u&&i>n||!Object(b.isFiniteNumber)(n))&&(S.logger.log("[buffer-controller]: Updating Media Source duration to "+i.toFixed(3)),d.duration=i)}},g.updateSeekableRange=function(r){var t=this.mediaSource,e=r.fragments;if(e.length&&r.live&&null!=t&&t.setLiveSeekableRange){var i=Math.max(0,e[0].start),n=Math.max(i,i+r.totalduration);t.setLiveSeekableRange(i,n)}},g.checkPendingTracks=function(){var r=this.bufferCodecEventsExpected,t=this.operationQueue,e=this.pendingTracks,d=Object.keys(e).length;if(d&&!r||2===d){this.createSourceBuffers(e),this.pendingTracks={};var i=this.getSourceBufferTypes();if(0===i.length)return void this.hls.trigger(R.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});i.forEach(function(n){t.executeNext(n)})}},g.createSourceBuffers=function(r){var t=this.sourceBuffer,e=this.mediaSource;if(!e)throw Error("createSourceBuffers called when mediaSource was null");var d=0;for(var i in r)if(!t[i]){var n=r[i];if(!n)throw Error("source buffer exists for track "+i+", however track does not");var u=n.levelCodec||n.codec,a=n.container+";codecs="+u;S.logger.log("[buffer-controller]: creating sourceBuffer("+a+")");try{var o=t[i]=e.addSourceBuffer(a),l=i;this.addBufferListener(l,"updatestart",this._onSBUpdateStart),this.addBufferListener(l,"updateend",this._onSBUpdateEnd),this.addBufferListener(l,"error",this._onSBUpdateError),this.tracks[i]={buffer:o,codec:u,container:n.container,levelCodec:n.levelCodec,id:n.id},d++}catch(h){S.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+h.message),this.hls.trigger(R.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:h,mimeType:a})}}d&&this.hls.trigger(R.Events.BUFFER_CREATED,{tracks:this.tracks})},g._onSBUpdateStart=function(r){this.operationQueue.current(r).onStart()},g._onSBUpdateEnd=function(r){var t=this.operationQueue;t.current(r).onComplete(),t.shiftAndExecuteNext(r)},g._onSBUpdateError=function(r,t){S.logger.error("[buffer-controller]: "+r+" SourceBuffer error",t),this.hls.trigger(R.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var e=this.operationQueue.current(r);e&&e.onError(t)},g.removeExecutor=function(r,t,e){var d=this.media,i=this.mediaSource,n=this.operationQueue,a=this.sourceBuffer[r];if(!d||!i||!a)return S.logger.warn("[buffer-controller]: Attempting to remove from the "+r+" SourceBuffer, but it does not exist"),void n.shiftAndExecuteNext(r);var o=Object(b.isFiniteNumber)(d.duration)?d.duration:1/0,l=Object(b.isFiniteNumber)(i.duration)?i.duration:1/0,h=Math.max(0,t),L=Math.min(e,o,l);L>h?(S.logger.log("[buffer-controller]: Removing ["+h+","+L+"] from the "+r+" SourceBuffer"),console.assert(!a.updating,r+" sourceBuffer must not be updating"),a.remove(h,L)):n.shiftAndExecuteNext(r)},g.appendExecutor=function(r,t){var e=this.operationQueue,i=this.sourceBuffer[t];if(!i)return S.logger.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void e.shiftAndExecuteNext(t);i.ended=!1,console.assert(!i.updating,t+" sourceBuffer must not be updating"),i.appendBuffer(r)},g.blockBuffers=function(r,t){var e=this;if(void 0===t&&(t=this.getSourceBufferTypes()),!t.length)return S.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(r);var d=this.operationQueue,i=t.map(function(n){return d.appendBlocker(n)});Promise.all(i).then(function(){r(),t.forEach(function(n){var u=e.sourceBuffer[n];(!u||!u.updating)&&d.shiftAndExecuteNext(n)})})},g.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},g.addBufferListener=function(r,t,e){var d=this.sourceBuffer[r];if(d){var i=e.bind(this,r);this.listeners[r].push({event:t,listener:i}),d.addEventListener(t,i)}},g.removeBufferListeners=function(r){var t=this.sourceBuffer[r];!t||this.listeners[r].forEach(function(e){t.removeEventListener(e.event,e.listener)})},y}()},"./src/controller/buffer-operation-queue.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"default",function(){return R});var b=p("./src/utils/logger.ts"),R=function(){function S(P){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=P}var C=S.prototype;return C.append=function(A,m){var s=this.queues[m];s.push(A),1===s.length&&this.buffers[m]&&this.executeNext(m)},C.insertAbort=function(A,m){this.queues[m].unshift(A),this.executeNext(m)},C.appendBlocker=function(A){var m,s=new Promise(function(c){m=c});return this.append({execute:m,onStart:function(){},onComplete:function(){},onError:function(){}},A),s},C.executeNext=function(A){var f=this.buffers[A],c=this.queues[A];if(c.length){var T=c[0];try{T.execute()}catch(y){b.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),T.onError(y),(!f||!f.updating)&&(c.shift(),this.executeNext(A))}}},C.shiftAndExecuteNext=function(A){this.queues[A].shift(),this.executeNext(A)},C.current=function(A){return this.queues[A][0]},S}()},"./src/controller/cap-level-controller.ts":function(G,I,p){"use strict";p.r(I);var b=p("./src/events.ts");function R(P,A){for(var m=0;m<A.length;m++){var s=A[m];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(P,s.key,s)}}I.default=function(){function P(m){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=m,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var A=P.prototype;return A.setStreamController=function(s){this.streamController=s},A.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},A.registerListeners=function(){var s=this.hls;s.on(b.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),s.on(b.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),s.on(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),s.on(b.Events.BUFFER_CODECS,this.onBufferCodecs,this),s.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},A.unregisterListener=function(){var s=this.hls;s.off(b.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),s.off(b.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),s.off(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),s.off(b.Events.BUFFER_CODECS,this.onBufferCodecs,this),s.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},A.onFpsDropLevelCapping=function(s,f){P.isLevelAllowed(f.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(f.droppedLevel)},A.onMediaAttaching=function(s,f){this.media=f.media instanceof HTMLVideoElement?f.media:null},A.onManifestParsed=function(s,f){var c=this.hls;this.restrictedLevels=[],this.firstLevel=f.firstLevel,c.config.capLevelToPlayerSize&&f.video&&this.startCapping()},A.onBufferCodecs=function(s,f){this.hls.config.capLevelToPlayerSize&&f.video&&this.startCapping()},A.onMediaDetaching=function(){this.stopCapping()},A.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var s=this.hls.levels;if(s.length){var f=this.hls;f.autoLevelCapping=this.getMaxLevel(s.length-1),f.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=f.autoLevelCapping}}},A.getMaxLevel=function(s){var f=this,c=this.hls.levels;if(!c.length)return-1;var T=c.filter(function(y,g){return P.isLevelAllowed(g,f.restrictedLevels)&&g<=s});return this.clientRect=null,P.getMaxLevelByMediaSize(T,this.mediaWidth,this.mediaHeight)},A.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},A.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},A.getDimensions=function(){if(this.clientRect)return this.clientRect;var s=this.media,f={width:0,height:0};if(s){var c=s.getBoundingClientRect();f.width=c.width,f.height=c.height,!f.width&&!f.height&&(f.width=c.right-c.left||s.width||0,f.height=c.bottom-c.top||s.height||0)}return this.clientRect=f,f},P.isLevelAllowed=function(s,f){return void 0===f&&(f=[]),-1===f.indexOf(s)},P.getMaxLevelByMediaSize=function(s,f,c){if(!s||!s.length)return-1;for(var y=s.length-1,g=0;g<s.length;g+=1){var v=s[g];if((v.width>=f||v.height>=c)&&(t=v,!(e=s[g+1])||t.width!==e.width||t.height!==e.height)){y=g;break}}var t,e;return y},function(P,A,m){A&&R(P.prototype,A),m&&R(P,m)}(P,[{key:"mediaWidth",get:function(){return this.getDimensions().width*P.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*P.contentScaleFactor}}],[{key:"contentScaleFactor",get:function(){var s=1;try{s=self.devicePixelRatio}catch(f){}return s}}]),P}()},"./src/controller/fps-controller.ts":function(G,I,p){"use strict";p.r(I);var b=p("./src/events.ts"),R=p("./src/utils/logger.ts");I.default=function(){function C(A){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=A,this.registerListeners()}var P=C.prototype;return P.setStreamController=function(m){this.streamController=m},P.registerListeners=function(){this.hls.on(b.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},P.unregisterListeners=function(){this.hls.off(b.Events.MEDIA_ATTACHING,this.onMediaAttaching)},P.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},P.onMediaAttaching=function(m,s){var f=this.hls.config;if(f.capLevelOnFPSDrop){var c=s.media instanceof self.HTMLVideoElement?s.media:null;this.media=c,c&&"function"==typeof c.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),f.fpsDroppedMonitoringPeriod)}},P.checkFPS=function(m,s,f){var c=performance.now();if(s){if(this.lastTime){var y=f-this.lastDroppedFrames,g=s-this.lastDecodedFrames,v=1e3*y/(c-this.lastTime),r=this.hls;if(r.trigger(b.Events.FPS_DROP,{currentDropped:y,currentDecoded:g,totalDroppedFrames:f}),v>0&&y>r.config.fpsDroppedMonitoringThreshold*g){var t=r.currentLevel;R.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+t),t>0&&(-1===r.autoLevelCapping||r.autoLevelCapping>=t)&&(r.trigger(b.Events.FPS_DROP_LEVEL_CAPPING,{level:t-=1,droppedLevel:r.currentLevel}),r.autoLevelCapping=t,this.streamController.nextLevelSwitch())}}this.lastTime=c,this.lastDroppedFrames=f,this.lastDecodedFrames=s}},P.checkFPSInterval=function(){var m=this.media;if(m)if(this.isVideoPlaybackQualityAvailable){var s=m.getVideoPlaybackQuality();this.checkFPS(m,s.totalVideoFrames,s.droppedVideoFrames)}else this.checkFPS(m,m.webkitDecodedFrameCount,m.webkitDroppedFrameCount)},C}()},"./src/controller/fragment-finders.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"findFragmentByPDT",function(){return S}),p.d(I,"findFragmentByPTS",function(){return C}),p.d(I,"fragmentWithinToleranceTest",function(){return P}),p.d(I,"pdtWithinToleranceTest",function(){return A}),p.d(I,"findFragWithCC",function(){return m});var b=p("./src/polyfills/number.ts"),R=p("./src/utils/binary-search.ts");function S(s,f,c){if(null===f||!Array.isArray(s)||!s.length||!Object(b.isFiniteNumber)(f))return null;if(f<(s[0].programDateTime||0))return null;if(f>=(s[s.length-1].endProgramDateTime||0))return null;c=c||0;for(var g=0;g<s.length;++g){var v=s[g];if(A(f,c,v))return v}return null}function C(s,f,c,T){void 0===c&&(c=0),void 0===T&&(T=0);var y=null;return s?y=f[s.sn-f[0].sn+1]||null:0===c&&0===f[0].start&&(y=f[0]),y&&0===P(c,T,y)?y:R.default.search(f,P.bind(null,c,T))||y}function P(s,f,c){void 0===s&&(s=0),void 0===f&&(f=0);var T=Math.min(f,c.duration+(c.deltaPTS?c.deltaPTS:0));return c.start+c.duration-T<=s?1:c.start-T>s&&c.start?-1:0}function A(s,f,c){var T=1e3*Math.min(f,c.duration+(c.deltaPTS?c.deltaPTS:0));return(c.endProgramDateTime||0)-T>s}function m(s,f){return R.default.search(s,function(c){return c.cc<f?1:c.cc>f?-1:0})}},"./src/controller/fragment-tracker.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"FragmentState",function(){return S}),p.d(I,"FragmentTracker",function(){return C});var b=p("./src/events.ts"),R=p("./src/types/loader.ts"),S=(()=>{return(m=S||(S={})).NOT_LOADED="NOT_LOADED",m.BACKTRACKED="BACKTRACKED",m.APPENDING="APPENDING",m.PARTIAL="PARTIAL",m.OK="OK",S;var m})(),C=function(){function m(f){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=f,this._registerListeners()}var s=m.prototype;return s._registerListeners=function(){var c=this.hls;c.on(b.Events.BUFFER_APPENDED,this.onBufferAppended,this),c.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),c.on(b.Events.FRAG_LOADED,this.onFragLoaded,this)},s._unregisterListeners=function(){var c=this.hls;c.off(b.Events.BUFFER_APPENDED,this.onBufferAppended,this),c.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),c.off(b.Events.FRAG_LOADED,this.onFragLoaded,this)},s.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},s.getAppendedFrag=function(c,T){if(T===R.PlaylistLevelType.MAIN){var y=this.activeFragment,g=this.activeParts;if(!y)return null;if(g)for(var v=g.length;v--;){var r=g[v],t=r?r.end:y.appendedPTS;if(r.start<=c&&void 0!==t&&c<=t)return v>9&&(this.activeParts=g.slice(v-9)),r}else if(y.start<=c&&void 0!==y.appendedPTS&&c<=y.appendedPTS)return y}return this.getBufferedFrag(c,T)},s.getBufferedFrag=function(c,T){for(var y=this.fragments,g=Object.keys(y),v=g.length;v--;){var r=y[g[v]];if((null==r?void 0:r.body.type)===T&&r.buffered){var t=r.body;if(t.start<=c&&c<=t.end)return t}}return null},s.detectEvictedFragments=function(c,T,y){var g=this;Object.keys(this.fragments).forEach(function(v){var r=g.fragments[v];if(r){if(!r.buffered)return void(r.body.type===y&&g.removeFragment(r.body));var t=r.range[c];!t||t.time.some(function(e){var d=!g.isTimeBuffered(e.startPTS,e.endPTS,T);return d&&g.removeFragment(r.body),d})}})},s.detectPartialFragments=function(c){var T=this,y=this.timeRanges,g=c.frag,v=c.part;if(y&&"initSegment"!==g.sn){var r=A(g),t=this.fragments[r];!t||(Object.keys(y).forEach(function(e){var d=g.elementaryStreams[e];d&&(t.range[e]=T.getBufferedTimes(g,v,null!==v||!0===d.partial,y[e]))}),t.backtrack=t.loaded=null,Object.keys(t.range).length?t.buffered=!0:this.removeFragment(t.body))}},s.fragBuffered=function(c){var T=A(c),y=this.fragments[T];y&&(y.backtrack=y.loaded=null,y.buffered=!0)},s.getBufferedTimes=function(c,T,y,g){for(var v={time:[],partial:y},r=T?T.start:c.start,t=T?T.end:c.end,e=c.minEndPTS||t,d=c.maxStartPTS||r,i=0;i<g.length;i++){var n=g.start(i)-this.bufferPadding,u=g.end(i)+this.bufferPadding;if(d>=n&&e<=u){v.time.push({startPTS:Math.max(r,g.start(i)),endPTS:Math.min(t,g.end(i))});break}if(r<u&&t>n)v.partial=!0,v.time.push({startPTS:Math.max(r,g.start(i)),endPTS:Math.min(t,g.end(i))});else if(t<=n)break}return v},s.getPartialFragment=function(c){var y,g,v,T=null,r=0,t=this.bufferPadding,e=this.fragments;return Object.keys(e).forEach(function(d){var i=e[d];!i||P(i)&&(v=i.body.end+t,c>=(g=i.body.start-t)&&c<=v&&(y=Math.min(c-g,v-c),r<=y&&(T=i.body,r=y)))}),T},s.getState=function(c){var T=A(c),y=this.fragments[T];return y?y.buffered?P(y)?S.PARTIAL:S.OK:y.backtrack?S.BACKTRACKED:S.APPENDING:S.NOT_LOADED},s.backtrack=function(c,T){var y=A(c),g=this.fragments[y];if(!g||g.backtrack)return null;var v=g.backtrack=T||g.loaded;return g.loaded=null,v},s.getBacktrackData=function(c){var T=A(c),y=this.fragments[T];if(y){var g,v=y.backtrack;if(null!=v&&null!==(g=v.payload)&&void 0!==g&&g.byteLength)return v;this.removeFragment(c)}return null},s.isTimeBuffered=function(c,T,y){for(var g,v,r=0;r<y.length;r++){if(g=y.start(r)-this.bufferPadding,v=y.end(r)+this.bufferPadding,c>=g&&T<=v)return!0;if(T<=g)return!1}return!1},s.onFragLoaded=function(c,T){var y=T.frag;if("initSegment"!==y.sn&&!y.bitrateTest&&!T.part){var v=A(y);this.fragments[v]={body:y,loaded:T,backtrack:null,buffered:!1,range:Object.create(null)}}},s.onBufferAppended=function(c,T){var y=this,g=T.frag,v=T.part,r=T.timeRanges;if(g.type===R.PlaylistLevelType.MAIN)if(this.activeFragment=g,v){var t=this.activeParts;t||(this.activeParts=t=[]),t.push(v)}else this.activeParts=null;this.timeRanges=r,Object.keys(r).forEach(function(e){var d=r[e];if(y.detectEvictedFragments(e,d),!v)for(var i=0;i<d.length;i++)g.appendedPTS=Math.max(d.end(i),g.appendedPTS||0)})},s.onFragBuffered=function(c,T){this.detectPartialFragments(T)},s.hasFragment=function(c){var T=A(c);return!!this.fragments[T]},s.removeFragmentsInRange=function(c,T,y){var g=this;Object.keys(this.fragments).forEach(function(v){var r=g.fragments[v];if(r&&r.buffered){var t=r.body;t.type===y&&t.start<T&&t.end>c&&g.removeFragment(t)}})},s.removeFragment=function(c){var T=A(c);c.stats.loaded=0,c.clearElementaryStreamInfo(),delete this.fragments[T]},s.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},m}();function P(m){var s,f;return m.buffered&&((null===(s=m.range.video)||void 0===s?void 0:s.partial)||(null===(f=m.range.audio)||void 0===f?void 0:f.partial))}function A(m){return m.type+"_"+m.level+"_"+m.urlId+"_"+m.sn}},"./src/controller/gap-controller.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"STALL_MINIMUM_DURATION_MS",function(){return P}),p.d(I,"MAX_START_GAP_JUMP",function(){return A}),p.d(I,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return m}),p.d(I,"SKIP_BUFFER_RANGE_START",function(){return s}),p.d(I,"default",function(){return f});var b=p("./src/utils/buffer-helper.ts"),R=p("./src/errors.ts"),S=p("./src/events.ts"),C=p("./src/utils/logger.ts"),P=250,A=2,m=.1,s=.05,f=function(){function c(y,g,v,r){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=y,this.media=g,this.fragmentTracker=v,this.hls=r}var T=c.prototype;return T.destroy=function(){this.hls=this.fragmentTracker=this.media=null},T.poll=function(g){var v=this.config,r=this.media,t=this.stalled,e=r.currentTime,d=r.seeking,i=this.seeking&&!d,n=!this.seeking&&d;if(this.seeking=d,e===g){if((n||i)&&(this.stalled=null),!r.paused&&!r.ended&&0!==r.playbackRate&&b.BufferHelper.getBuffered(r).length){var a=b.BufferHelper.bufferInfo(r,e,0),l=a.nextStart||0;if(a.len>0||l){if(d){var h=a.len>A,L=!l||l-e>A&&!this.fragmentTracker.getPartialFragment(e);if(h||L)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var O,E=Math.max(l,a.start||0)-e,x=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,D=null==x||null===(O=x.details)||void 0===O?void 0:O.live;if(E>0&&E<=(D?2*x.details.targetduration:A))return void this._trySkipBufferHole(null)}var F=self.performance.now();if(null===t)return void(this.stalled=F);var B=F-t;!d&&B>=P&&this._reportStall(a.len);var U=b.BufferHelper.bufferInfo(r,e,v.maxBufferHole);this._tryFixBufferStall(U,B)}}}else if(this.moved=!0,null!==t){if(this.stallReported){var u=self.performance.now()-t;C.logger.warn("playback not stuck anymore @"+e+", after "+Math.round(u)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},T._tryFixBufferStall=function(g,v){var r=this.config,i=this.fragmentTracker.getPartialFragment(this.media.currentTime);i&&this._trySkipBufferHole(i)||g.len>r.maxBufferHole&&v>1e3*r.highBufferWatchdogPeriod&&(C.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},T._reportStall=function(g){var v=this.hls,r=this.media;this.stallReported||(this.stallReported=!0,C.logger.warn("Playback stalling at @"+r.currentTime+" due to low buffer (buffer="+g+")"),v.trigger(S.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:g}))},T._trySkipBufferHole=function(g){for(var v=this.config,r=this.hls,t=this.media,e=t.currentTime,d=0,i=b.BufferHelper.getBuffered(t),n=0;n<i.length;n++){var u=i.start(n);if(e+v.maxBufferHole>=d&&e<u){var a=Math.max(u+s,t.currentTime+m);return C.logger.warn("skipping hole, adjusting currentTime from "+e+" to "+a),this.moved=!0,this.stalled=null,t.currentTime=a,g&&r.trigger(S.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+e+" to "+a,frag:g}),a}d=i.end(n)}return 0},T._tryNudgeBuffer=function(){var g=this.config,v=this.hls,r=this.media,t=r.currentTime,e=(this.nudgeRetry||0)+1;if(this.nudgeRetry=e,e<g.nudgeMaxRetry){var d=t+e*g.nudgeOffset;C.logger.warn("Nudging 'currentTime' from "+t+" to "+d),r.currentTime=d,v.trigger(S.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else C.logger.error("Playhead still not moving while enough data buffered @"+t+" after "+g.nudgeMaxRetry+" nudges"),v.trigger(S.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},c}()},"./src/controller/id3-track-controller.ts":function(G,I,p){"use strict";p.r(I);var b=p("./src/events.ts"),R=p("./src/utils/texttrack-utils.ts"),S=p("./src/demux/id3.ts");I.default=function(){function A(s){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=s,this._registerListeners()}var m=A.prototype;return m.destroy=function(){this._unregisterListeners()},m._registerListeners=function(){var f=this.hls;f.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.on(b.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),f.on(b.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},m._unregisterListeners=function(){var f=this.hls;f.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.off(b.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),f.off(b.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},m.onMediaAttached=function(f,c){this.media=c.media},m.onMediaDetaching=function(){!this.id3Track||(Object(R.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},m.getID3Track=function(f){if(this.media){for(var c=0;c<f.length;c++){var T=f[c];if("metadata"===T.kind&&"id3"===T.label)return Object(R.sendAddTrackEvent)(T,this.media),T}return this.media.addTextTrack("metadata","id3")}},m.onFragParsingMetadata=function(f,c){if(this.media){var T=c.frag,y=c.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var g=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,v=0;v<y.length;v++){var r=S.getID3Frames(y[v].data);if(r){var t=y[v].pts,e=v<y.length-1?y[v+1].pts:T.end;e-t<=0&&(e=t+.25);for(var i=0;i<r.length;i++){var n=r[i];if(!S.isTimeStampFrame(n)){var u=new g(t,e,"");u.value=n,this.id3Track.addCue(u)}}}}}},m.onBufferFlushing=function(f,c){var T=c.startOffset,y=c.endOffset,g=c.type;if(!g||"audio"===g){var v=this.id3Track;v&&Object(R.removeCuesInRange)(v,T,y)}},A}()},"./src/controller/latency-controller.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"default",function(){return A});var b=p("./src/errors.ts"),R=p("./src/events.ts"),S=p("./src/utils/logger.ts");function C(m,s){for(var f=0;f<s.length;f++){var c=s[f];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(m,c.key,c)}}var A=function(){function m(f){var c=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return c.timeupdate()},this.hls=f,this.config=f.config,this.registerListeners()}var s=m.prototype;return s.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},s.registerListeners=function(){this.hls.on(R.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(R.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(R.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(R.Events.ERROR,this.onError,this)},s.unregisterListeners=function(){this.hls.off(R.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(R.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(R.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(R.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(R.Events.ERROR,this.onError)},s.onMediaAttached=function(c,T){this.media=T.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},s.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},s.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},s.onLevelUpdated=function(c,T){var y=T.details;this.levelDetails=y,y.advanced&&this.timeupdate(),!y.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},s.onError=function(c,T){T.details===b.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,S.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},s.timeupdate=function(){var c=this.media,T=this.levelDetails;if(c&&T){this.currentTime=c.currentTime;var y=this.computeLatency();if(null!==y){this._latency=y;var g=this.config,r=g.maxLiveSyncPlaybackRate;if(g.lowLatencyMode&&1!==r){var t=this.targetLatency;if(null!==t){var e=y-t,d=Math.min(this.maxLatency,t+T.targetduration);if(T.live&&e<d&&e>.05&&this.forwardBufferLength>1){var n=Math.min(2,Math.max(1,r)),u=Math.round(2/(1+Math.exp(-.75*e-this.edgeStalled))*20)/20;c.playbackRate=Math.min(n,Math.max(1,u))}else 1!==c.playbackRate&&0!==c.playbackRate&&(c.playbackRate=1)}}}}},s.estimateLiveEdge=function(){var c=this.levelDetails;return null===c?null:c.edge+c.age},s.computeLatency=function(){var c=this.estimateLiveEdge();return null===c?null:c-this.currentTime},function(m,s,f){s&&C(m.prototype,s),f&&C(m,f)}(m,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var c=this.config,T=this.levelDetails;return void 0!==c.liveMaxLatencyDuration?c.liveMaxLatencyDuration:T?c.liveMaxLatencyDurationCount*T.targetduration:0}},{key:"targetLatency",get:function(){var c=this.levelDetails;if(null===c)return null;var g=c.targetduration,v=this.config,r=v.liveSyncDuration,d=this.hls.userConfig,i=v.lowLatencyMode&&c.partHoldBack||c.holdBack;return(d.liveSyncDuration||d.liveSyncDurationCount||0===i)&&(i=void 0!==r?r:v.liveSyncDurationCount*g),i+Math.min(1*this.stallCount,g)}},{key:"liveSyncPosition",get:function(){var c=this.estimateLiveEdge(),T=this.targetLatency,y=this.levelDetails;if(null===c||null===T||null===y)return null;var g=y.edge,t=g-(this.config.lowLatencyMode&&y.partTarget||y.targetduration);return Math.min(Math.max(g-y.totalduration,c-T-this.edgeStalled),t)}},{key:"drift",get:function(){var c=this.levelDetails;return null===c?1:c.drift}},{key:"edgeStalled",get:function(){var c=this.levelDetails;return null===c?0:Math.max(c.age-3*(this.config.lowLatencyMode&&c.partTarget||c.targetduration),0)}},{key:"forwardBufferLength",get:function(){var c=this.media,T=this.levelDetails;if(!c||!T)return 0;var y=c.buffered.length;return y?c.buffered.end(y-1):T.edge-this.currentTime}}]),m}()},"./src/controller/level-controller.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"default",function(){return v});var b=p("./src/types/level.ts"),R=p("./src/events.ts"),S=p("./src/errors.ts"),C=p("./src/utils/codecs.ts"),P=p("./src/controller/level-helper.ts"),A=p("./src/controller/base-playlist-controller.ts"),m=p("./src/types/loader.ts");function s(){return(s=Object.assign||function(r){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var d in e)Object.prototype.hasOwnProperty.call(e,d)&&(r[d]=e[d])}return r}).apply(this,arguments)}function f(r,t){for(var e=0;e<t.length;e++){var d=t[e];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(r,d.key,d)}}function T(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r,y(r,t)}function y(r,t){return(y=Object.setPrototypeOf||function(d,i){return d.__proto__=i,d})(r,t)}var g=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),v=function(r){function t(d){var i;return(i=r.call(this,d,"[level-controller]")||this)._levels=[],i._firstLevel=-1,i._startLevel=void 0,i.currentLevelIndex=-1,i.manualLevelIndex=-1,i.onParsedComplete=void 0,i._registerListeners(),i}T(t,r);var e=t.prototype;return e._registerListeners=function(){var i=this.hls;i.on(R.Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.on(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.on(R.Events.FRAG_LOADED,this.onFragLoaded,this),i.on(R.Events.ERROR,this.onError,this)},e._unregisterListeners=function(){var i=this.hls;i.off(R.Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.off(R.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(R.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.off(R.Events.FRAG_LOADED,this.onFragLoaded,this),i.off(R.Events.ERROR,this.onError,this)},e.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,r.prototype.destroy.call(this)},e.startLoad=function(){this._levels.forEach(function(n){n.loadError=0}),r.prototype.startLoad.call(this)},e.onManifestLoaded=function(i,n){var l,L,u=[],a=[],o=[],h={},O=!1,E=!1,x=!1;if(n.levels.forEach(function(B){var U=B.attrs;O=O||!(!B.width||!B.height),E=E||!!B.videoCodec,x=x||!!B.audioCodec,g&&B.audioCodec&&-1!==B.audioCodec.indexOf("mp4a.40.34")&&(B.audioCodec=void 0);var k=B.bitrate+"-"+B.attrs.RESOLUTION+"-"+B.attrs.CODECS;(L=h[k])?L.url.push(B.url):(L=new b.Level(B),h[k]=L,u.push(L)),U&&(U.AUDIO&&Object(P.addGroupId)(L,"audio",U.AUDIO),U.SUBTITLES&&Object(P.addGroupId)(L,"text",U.SUBTITLES))}),(O||E)&&x&&(u=u.filter(function(B){return!!B.videoCodec||!(!B.width||!B.height)})),u=u.filter(function(B){var U=B.audioCodec,k=B.videoCodec;return(!U||Object(C.isCodecSupportedInMp4)(U,"audio"))&&(!k||Object(C.isCodecSupportedInMp4)(k,"video"))}),n.audioTracks&&(a=n.audioTracks.filter(function(B){return!B.audioCodec||Object(C.isCodecSupportedInMp4)(B.audioCodec,"audio")}),Object(P.assignTrackIdsByGroup)(a)),n.subtitles&&(o=n.subtitles,Object(P.assignTrackIdsByGroup)(o)),u.length>0){l=u[0].bitrate,u.sort(function(B,U){return B.bitrate-U.bitrate}),this._levels=u;for(var D=0;D<u.length;D++)if(u[D].bitrate===l){this._firstLevel=D,this.log("manifest loaded, "+u.length+" level(s) found, first bitrate: "+l);break}var F={levels:u,audioTracks:a,subtitleTracks:o,firstLevel:this._firstLevel,stats:n.stats,audio:x,video:E,altAudio:!(x&&!E)&&a.some(function(B){return!!B.url})};this.hls.trigger(R.Events.MANIFEST_PARSED,F),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(R.Events.ERROR,{type:S.ErrorTypes.MEDIA_ERROR,details:S.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:n.url,reason:"no level with compatible codecs found in manifest"})},e.onError=function(i,n){if(r.prototype.onError.call(this,i,n),!n.fatal){var u=n.context,a=this._levels[this.currentLevelIndex];if(u&&(u.type===m.PlaylistContextType.AUDIO_TRACK&&a.audioGroupIds&&u.groupId===a.audioGroupIds[a.urlId]||u.type===m.PlaylistContextType.SUBTITLE_TRACK&&a.textGroupIds&&u.groupId===a.textGroupIds[a.urlId]))return void this.redundantFailover(this.currentLevelIndex);var h,o=!1,l=!0;switch(n.details){case S.ErrorDetails.FRAG_LOAD_ERROR:case S.ErrorDetails.FRAG_LOAD_TIMEOUT:case S.ErrorDetails.KEY_LOAD_ERROR:case S.ErrorDetails.KEY_LOAD_TIMEOUT:if(n.frag){var L=this._levels[n.frag.level];L?(L.fragmentError++,L.fragmentError>this.hls.config.fragLoadingMaxRetry&&(h=n.frag.level)):h=n.frag.level}break;case S.ErrorDetails.LEVEL_LOAD_ERROR:case S.ErrorDetails.LEVEL_LOAD_TIMEOUT:u&&(u.deliveryDirectives&&(l=!1),h=u.level),o=!0;break;case S.ErrorDetails.REMUX_ALLOC_ERROR:h=n.level,o=!0}void 0!==h&&this.recoverLevel(n,h,o,l)}},e.recoverLevel=function(i,n,u,a){var o=i.details,l=this._levels[n];if(l.loadError++,u){if(!this.retryLoadingOrFail(i))return void(this.currentLevelIndex=-1);i.levelRetry=!0}if(a){var L=l.url.length;if(L>1&&l.loadError<L)i.levelRetry=!0,this.redundantFailover(n);else if(-1===this.manualLevelIndex){var O=0===n?this._levels.length-1:n-1;this.currentLevelIndex!==O&&0===this._levels[O].loadError&&(this.warn(o+": switch to "+O),i.levelRetry=!0,this.hls.nextAutoLevel=O)}}},e.redundantFailover=function(i){var n=this._levels[i],u=n.url.length;if(u>1){var a=(n.urlId+1)%u;this.warn("Switching to redundant URL-id "+a),this._levels.forEach(function(o){o.urlId=a}),this.level=i}},e.onFragLoaded=function(i,n){var u=n.frag;if(void 0!==u&&u.type===m.PlaylistLevelType.MAIN){var a=this._levels[u.level];void 0!==a&&(a.fragmentError=0,a.loadError=0)}},e.onLevelLoaded=function(i,n){var u,h,a=n.level,o=n.details,l=this._levels[a];if(!l)return this.warn("Invalid level index "+a),void(null!==(h=n.deliveryDirectives)&&void 0!==h&&h.skip&&(o.deltaUpdateFailed=!0));a===this.currentLevelIndex?(0===l.fragmentError&&(l.loadError=0,this.retryCount=0),this.playlistLoaded(a,n,l.details)):null!==(u=n.deliveryDirectives)&&void 0!==u&&u.skip&&(o.deltaUpdateFailed=!0)},e.onAudioTrackSwitched=function(i,n){var u=this.hls.levels[this.currentLevelIndex];if(u&&u.audioGroupIds){for(var a=-1,o=this.hls.audioTracks[n.id].groupId,l=0;l<u.audioGroupIds.length;l++)if(u.audioGroupIds[l]===o){a=l;break}a!==u.urlId&&(u.urlId=a,this.startLoad())}},e.loadPlaylist=function(i){var n=this.currentLevelIndex,u=this._levels[n];if(this.canLoad&&u&&u.url.length>0){var a=u.urlId,o=u.url[a];if(i)try{o=i.addDirectives(o)}catch(l){this.warn("Could not construct new URL with HLS Delivery Directives: "+l)}this.log("Attempt loading level index "+n+(i?" at sn "+i.msn+" part "+i.part:"")+" with URL-id "+a+" "+o),this.clearTimer(),this.hls.trigger(R.Events.LEVEL_LOADING,{url:o,level:n,id:a,deliveryDirectives:i||null})}},e.removeLevel=function(i,n){var u=function(l,h){return h!==n},a=this._levels.filter(function(o,l){return l!==i||o.url.length>1&&void 0!==n&&(o.url=o.url.filter(u),o.audioGroupIds&&(o.audioGroupIds=o.audioGroupIds.filter(u)),o.textGroupIds&&(o.textGroupIds=o.textGroupIds.filter(u)),o.urlId=0,!0)}).map(function(o,l){var h=o.details;return null!=h&&h.fragments&&h.fragments.forEach(function(L){L.level=l}),o});this._levels=a,this.hls.trigger(R.Events.LEVELS_UPDATED,{levels:a})},function(r,t,e){t&&f(r.prototype,t),e&&f(r,e)}(t,[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(i){var n,u=this._levels;if(0!==u.length&&(this.currentLevelIndex!==i||null===(n=u[i])||void 0===n||!n.details)){if(i<0||i>=u.length){var a=i<0;if(this.hls.trigger(R.Events.ERROR,{type:S.ErrorTypes.OTHER_ERROR,details:S.ErrorDetails.LEVEL_SWITCH_ERROR,level:i,fatal:a,reason:"invalid level idx"}),a)return;i=Math.min(i,u.length-1)}this.clearTimer();var o=this.currentLevelIndex,l=u[o],h=u[i];this.log("switching to level "+i+" from "+o),this.currentLevelIndex=i;var L=s({},h,{level:i,maxBitrate:h.maxBitrate,uri:h.uri,urlId:h.urlId});delete L._urlId,this.hls.trigger(R.Events.LEVEL_SWITCHING,L);var O=h.details;if(!O||O.live){var E=this.switchParams(h.uri,null==l?void 0:l.details);this.loadPlaylist(E)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(i){this.manualLevelIndex=i,void 0===this._startLevel&&(this._startLevel=i),-1!==i&&(this.level=i)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(i){this._firstLevel=i}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var i=this.hls.config.startLevel;return void 0!==i?i:this._firstLevel}return this._startLevel},set:function(i){this._startLevel=i}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(i){this.level=i,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=i)}}]),t}(A.default)},"./src/controller/level-helper.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"addGroupId",function(){return S}),p.d(I,"assignTrackIdsByGroup",function(){return C}),p.d(I,"updatePTS",function(){return P}),p.d(I,"updateFragPTSDTS",function(){return m}),p.d(I,"mergeDetails",function(){return s}),p.d(I,"mapPartIntersection",function(){return f}),p.d(I,"mapFragmentIntersection",function(){return c}),p.d(I,"adjustSliding",function(){return T}),p.d(I,"addSliding",function(){return y}),p.d(I,"computeReloadInterval",function(){return g}),p.d(I,"getFragmentWithSN",function(){return v}),p.d(I,"getPartWith",function(){return r});var b=p("./src/polyfills/number.ts"),R=p("./src/utils/logger.ts");function S(t,e,d){switch(e){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(d);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(d)}}function C(t){var e={};t.forEach(function(d){var i=d.groupId||"";d.id=e[i]=e[i]||0,e[i]++})}function P(t,e,d){A(t[e],t[d])}function A(t,e){var d=e.startPTS;if(Object(b.isFiniteNumber)(d)){var n,i=0;e.sn>t.sn?(i=d-t.start,n=t):(i=t.start-d,n=e),n.duration!==i&&(n.duration=i)}else e.start=e.sn>t.sn?t.cc===e.cc&&t.minEndPTS?t.start+(t.minEndPTS-t.start):t.start+t.duration:Math.max(t.start-e.duration,0)}function m(t,e,d,i,n,u){i-d<=0&&(R.logger.warn("Fragment should have a positive duration",e),i=d+e.duration,u=n+e.duration);var o=d,l=i,h=e.startPTS,L=e.endPTS;if(Object(b.isFiniteNumber)(h)){var O=Math.abs(h-d);e.deltaPTS=Object(b.isFiniteNumber)(e.deltaPTS)?Math.max(O,e.deltaPTS):O,o=Math.max(d,h),d=Math.min(d,h),n=Math.min(n,e.startDTS),l=Math.min(i,L),i=Math.max(i,L),u=Math.max(u,e.endDTS)}e.duration=i-d;var E=d-e.start;e.appendedPTS=i,e.start=e.startPTS=d,e.maxStartPTS=o,e.startDTS=n,e.endPTS=i,e.minEndPTS=l,e.endDTS=u;var x=e.sn;if(!t||x<t.startSN||x>t.endSN)return 0;var D,M=x-t.startSN,F=t.fragments;for(F[M]=e,D=M;D>0;D--)A(F[D],F[D-1]);for(D=M;D<F.length-1;D++)A(F[D],F[D+1]);return t.fragmentHint&&A(F[F.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,E}function s(t,e){for(var d=null,i=t.fragments,n=i.length-1;n>=0;n--){var u=i[n].initSegment;if(u){d=u;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;var o,a=0;if(c(t,e,function(x,D){var M;x.relurl&&(a=x.cc-D.cc),Object(b.isFiniteNumber)(x.startPTS)&&Object(b.isFiniteNumber)(x.endPTS)&&(D.start=D.startPTS=x.startPTS,D.startDTS=x.startDTS,D.appendedPTS=x.appendedPTS,D.maxStartPTS=x.maxStartPTS,D.endPTS=x.endPTS,D.endDTS=x.endDTS,D.minEndPTS=x.minEndPTS,D.duration=x.endPTS-x.startPTS,D.duration&&(o=D),e.PTSKnown=e.alignedSliding=!0),D.elementaryStreams=x.elementaryStreams,D.loader=x.loader,D.stats=x.stats,D.urlId=x.urlId,x.initSegment?(D.initSegment=x.initSegment,d=x.initSegment):(!D.initSegment||D.initSegment.relurl==(null===(M=d)||void 0===M?void 0:M.relurl))&&(D.initSegment=d)}),e.skippedSegments&&(e.deltaUpdateFailed=e.fragments.some(function(x){return!x}),e.deltaUpdateFailed)){R.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var l=e.skippedSegments;l--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}var h=e.fragments;if(a){R.logger.warn("discontinuity sliding from playlist, take drift into account");for(var L=0;L<h.length;L++)h[L].cc+=a}e.skippedSegments&&(e.startCC=e.fragments[0].cc),f(t.partList,e.partList,function(x,D){D.elementaryStreams=x.elementaryStreams,D.stats=x.stats}),o?m(e,o,o.startPTS,o.endPTS,o.startDTS,o.endDTS):T(t,e),h.length&&(e.totalduration=e.edge-h[0].start),e.driftStartTime=t.driftStartTime,e.driftStart=t.driftStart;var O=e.advancedDateTime;if(e.advanced&&O){var E=e.edge;e.driftStart||(e.driftStartTime=O,e.driftStart=E),e.driftEndTime=O,e.driftEnd=E}else e.driftEndTime=t.driftEndTime,e.driftEnd=t.driftEnd,e.advancedDateTime=t.advancedDateTime}function f(t,e,d){if(t&&e)for(var i=0,n=0,u=t.length;n<=u;n++){var a=t[n],o=e[n+i];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?d(a,o):i--}}function c(t,e,d){for(var i=e.skippedSegments,n=Math.max(t.startSN,e.startSN)-e.startSN,u=(t.fragmentHint?1:0)+(i?e.endSN:Math.min(t.endSN,e.endSN))-e.startSN,a=e.startSN-t.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,h=n;h<=u;h++){var L=l[a+h],O=o[h];i&&!O&&h<i&&(O=e.fragments[h]=L),L&&O&&d(L,O)}}function T(t,e){var d=e.startSN+e.skippedSegments-t.startSN,i=t.fragments;d<0||d>=i.length||y(e,i[d].start)}function y(t,e){if(e){for(var d=t.fragments,i=t.skippedSegments;i<d.length;i++)d[i].start+=e;t.fragmentHint&&(t.fragmentHint.start+=e)}}function g(t,e){var o,d=1e3*t.levelTargetDuration,i=d/2,n=t.age,u=n>0&&n<3*d,a=e.loading.end-e.loading.start,l=t.availabilityDelay;if(!1===t.updated)if(u){var h=333*t.misses;o=Math.max(Math.min(i,2*a),h),t.availabilityDelay=(t.availabilityDelay||0)+o}else o=i;else u?(l=Math.min(l||d/2,n),t.availabilityDelay=l,o=l+d-n):o=d-a;return Math.round(o)}function v(t,e,d){if(!t||!t.details)return null;var i=t.details,n=i.fragments[e-i.startSN];return n||(n=i.fragmentHint)&&n.sn===e?n:e<i.startSN&&d&&d.sn===e?d:null}function r(t,e,d){if(!t||!t.details)return null;var i=t.details.partList;if(i)for(var n=i.length;n--;){var u=i[n];if(u.index===d&&u.fragment.sn===e)return u}return null}},"./src/controller/stream-controller.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"default",function(){return i});var b=p("./src/polyfills/number.ts"),R=p("./src/controller/base-stream-controller.ts"),S=p("./src/is-supported.ts"),C=p("./src/events.ts"),P=p("./src/utils/buffer-helper.ts"),A=p("./src/controller/fragment-tracker.ts"),m=p("./src/types/loader.ts"),s=p("./src/loader/fragment.ts"),f=p("./src/demux/transmuxer-interface.ts"),c=p("./src/types/transmuxer.ts"),T=p("./src/controller/gap-controller.ts"),y=p("./src/errors.ts"),g=p("./src/utils/logger.ts");function v(n,u){for(var a=0;a<u.length;a++){var o=u[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}function t(n,u){n.prototype=Object.create(u.prototype),n.prototype.constructor=n,e(n,u)}function e(n,u){return(e=Object.setPrototypeOf||function(o,l){return o.__proto__=l,o})(n,u)}var i=function(n){function u(o,l){var h;return(h=n.call(this,o,l,"[stream-controller]")||this).audioCodecSwap=!1,h.gapController=null,h.level=-1,h._forceStartLoad=!1,h.altAudio=!1,h.audioOnly=!1,h.fragPlaying=null,h.onvplaying=null,h.onvseeked=null,h.fragLastKbps=0,h.stalled=!1,h.couldBacktrack=!1,h.audioCodecSwitch=!1,h.videoBuffer=null,h._registerListeners(),h}t(u,n);var a=u.prototype;return a._registerListeners=function(){var l=this.hls;l.on(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.on(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.on(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.on(C.Events.LEVEL_LOADING,this.onLevelLoading,this),l.on(C.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.on(C.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),l.on(C.Events.ERROR,this.onError,this),l.on(C.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),l.on(C.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),l.on(C.Events.BUFFER_CREATED,this.onBufferCreated,this),l.on(C.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),l.on(C.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),l.on(C.Events.FRAG_BUFFERED,this.onFragBuffered,this)},a._unregisterListeners=function(){var l=this.hls;l.off(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.off(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.off(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.off(C.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.off(C.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),l.off(C.Events.ERROR,this.onError,this),l.off(C.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),l.off(C.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),l.off(C.Events.BUFFER_CREATED,this.onBufferCreated,this),l.off(C.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),l.off(C.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),l.off(C.Events.FRAG_BUFFERED,this.onFragBuffered,this)},a.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},a.startLoad=function(l){if(this.levels){var h=this.lastCurrentTime,L=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var O=L.startLevel;-1===O&&(L.config.testBandwidth?(O=0,this.bitrateTest=!0):O=L.nextAutoLevel),this.level=L.nextLoadLevel=O,this.loadedmetadata=!1}h>0&&-1===l&&(this.log("Override startPosition with lastCurrentTime @"+h.toFixed(3)),l=h),this.state=R.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=l,this.tick()}else this._forceStartLoad=!0,this.state=R.State.STOPPED},a.stopLoad=function(){this._forceStartLoad=!1,n.prototype.stopLoad.call(this)},a.doTick=function(){switch(this.state){case R.State.IDLE:this.doTickIdle();break;case R.State.WAITING_LEVEL:var l,h=this.levels,O=null==h||null===(l=h[this.level])||void 0===l?void 0:l.details;if(O&&(!O.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(O))break;this.state=R.State.IDLE;break}break;case R.State.FRAG_LOADING_WAITING_RETRY:var E,x=self.performance.now(),D=this.retryDate;(!D||x>=D||null!==(E=this.media)&&void 0!==E&&E.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=R.State.IDLE)}this.onTickEnd()},a.onTickEnd=function(){n.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},a.doTickIdle=function(){var l,h,L=this.hls,E=this.levels,x=this.media,M=L.nextLoadLevel;if(null!==this.levelLastLoaded&&(x||!this.startFragRequested&&L.config.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&E&&E[M]){var F=E[M];this.level=L.nextLoadLevel=M;var B=F.details;if(!B||this.state===R.State.WAITING_LEVEL||B.live&&this.levelLastLoaded!==M)return void(this.state=R.State.WAITING_LEVEL);var U=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:x,m.PlaylistLevelType.MAIN);if(null!==U&&!(U.len>=this.getMaxBufferLength(F.maxBitrate))){if(this._streamEnded(U,B)){var K={};return this.altAudio&&(K.type="video"),this.hls.trigger(C.Events.BUFFER_EOS,K),void(this.state=R.State.ENDED)}var W=U.end,w=this.getNextFragment(W,B);if(this.couldBacktrack&&!this.fragPrevious&&w&&"initSegment"!==w.sn){var H=w.sn-B.startSN;H>1&&this.fragmentTracker.removeFragment(w=B.fragments[H-1])}w&&this.fragmentTracker.getState(w)===A.FragmentState.OK&&this.nextLoadPosition>W&&(this.afterBufferFlushed(x,this.audioOnly&&!this.altAudio?s.ElementaryStreamTypes.AUDIO:s.ElementaryStreamTypes.VIDEO,m.PlaylistLevelType.MAIN),w=this.getNextFragment(this.nextLoadPosition,B)),!w||(w.initSegment&&!w.initSegment.data&&!this.bitrateTest&&(w=w.initSegment),"identity"!==(null===(l=w.decryptdata)||void 0===l?void 0:l.keyFormat)||null!==(h=w.decryptdata)&&void 0!==h&&h.key?this.loadFragment(w,B,W):this.loadKey(w,B))}}},a.loadFragment=function(l,h,L){var O,E=this.fragmentTracker.getState(l);if(this.fragCurrent=l,E===A.FragmentState.BACKTRACKED){var x=this.fragmentTracker.getBacktrackData(l);if(x)return this._handleFragmentLoadProgress(x),void this._handleFragmentLoadComplete(x);E=A.FragmentState.NOT_LOADED}E===A.FragmentState.NOT_LOADED||E===A.FragmentState.PARTIAL?"initSegment"===l.sn?this._loadInitSegment(l):this.bitrateTest?(l.bitrateTest=!0,this.log("Fragment "+l.sn+" of level "+l.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(l)):(this.startFragRequested=!0,n.prototype.loadFragment.call(this,l,h,L)):E===A.FragmentState.APPENDING?this.reduceMaxBufferLength(l.duration)&&this.fragmentTracker.removeFragment(l):0===(null===(O=this.media)||void 0===O?void 0:O.buffered.length)&&this.fragmentTracker.removeAllFragments()},a.getAppendedFrag=function(l){var h=this.fragmentTracker.getAppendedFrag(l,m.PlaylistLevelType.MAIN);return h&&"fragment"in h?h.fragment:h},a.getBufferedFrag=function(l){return this.fragmentTracker.getBufferedFrag(l,m.PlaylistLevelType.MAIN)},a.followingBufferedFrag=function(l){return l?this.getBufferedFrag(l.end+.5):null},a.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},a.nextLevelSwitch=function(){var l=this.levels,h=this.media;if(null!=h&&h.readyState){var L,O=this.getAppendedFrag(h.currentTime);if(O&&O.start>1&&this.flushMainBuffer(0,O.start-1),!h.paused&&l){var D=this.fragLastKbps;L=D&&this.fragCurrent?this.fragCurrent.duration*l[this.hls.nextLoadLevel].maxBitrate/(1e3*D)+1:0}else L=0;var M=this.getBufferedFrag(h.currentTime+L);if(M){var F=this.followingBufferedFrag(M);if(F){this.abortCurrentFrag();var U=F.duration,k=Math.max(M.end,(F.maxStartPTS?F.maxStartPTS:F.start)+Math.min(Math.max(U-this.config.maxFragLookUpTolerance,.5*U),.75*U));this.flushMainBuffer(k,Number.POSITIVE_INFINITY)}}}},a.abortCurrentFrag=function(){var l=this.fragCurrent;this.fragCurrent=null,null!=l&&l.loader&&l.loader.abort(),this.state===R.State.KEY_LOADING&&(this.state=R.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},a.flushMainBuffer=function(l,h){n.prototype.flushMainBuffer.call(this,l,h,this.altAudio?"video":null)},a.onMediaAttached=function(l,h){n.prototype.onMediaAttached.call(this,l,h);var L=h.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),L.addEventListener("playing",this.onvplaying),L.addEventListener("seeked",this.onvseeked),this.gapController=new T.default(this.config,L,this.fragmentTracker,this.hls)},a.onMediaDetaching=function(){var l=this.media;l&&(l.removeEventListener("playing",this.onvplaying),l.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),n.prototype.onMediaDetaching.call(this)},a.onMediaPlaying=function(){this.tick()},a.onMediaSeeked=function(){var l=this.media,h=l?l.currentTime:null;Object(b.isFiniteNumber)(h)&&this.log("Media seeked to "+h.toFixed(3)),this.tick()},a.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(C.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},a.onManifestParsed=function(l,h){var E,L=!1,O=!1;h.levels.forEach(function(x){(E=x.audioCodec)&&(-1!==E.indexOf("mp4a.40.2")&&(L=!0),-1!==E.indexOf("mp4a.40.5")&&(O=!0))}),this.audioCodecSwitch=L&&O&&!Object(S.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=h.levels,this.startFragRequested=!1},a.onLevelLoading=function(l,h){var L=this.levels;if(L&&this.state===R.State.IDLE){var O=L[h.level];(!O.details||O.details.live&&this.levelLastLoaded!==h.level||this.waitForCdnTuneIn(O.details))&&(this.state=R.State.WAITING_LEVEL)}},a.onLevelLoaded=function(l,h){var L,O=this.levels,E=h.level,x=h.details;if(O){this.log("Level "+E+" loaded ["+x.startSN+","+x.endSN+"], cc ["+x.startCC+", "+x.endCC+"] duration:"+x.totalduration);var M=this.fragCurrent;M&&(this.state===R.State.FRAG_LOADING||this.state===R.State.FRAG_LOADING_WAITING_RETRY)&&M.level!==h.level&&M.loader&&(this.state=R.State.IDLE,M.loader.abort());var F=O[E],B=0;if(x.live||null!==(L=F.details)&&void 0!==L&&L.live){if(x.fragments[0]||(x.deltaUpdateFailed=!0),x.deltaUpdateFailed)return;B=this.alignPlaylists(x,F.details)}if(F.details=x,this.levelLastLoaded=E,this.hls.trigger(C.Events.LEVEL_UPDATED,{details:x,level:E}),this.state===R.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(x))return;this.state=R.State.IDLE}this.startFragRequested?x.live&&this.synchronizeToLiveEdge(x):this.setStartPosition(x,B),this.tick()}else this.warn("Levels were reset while loading level "+E)},a._handleFragmentLoadProgress=function(l){var h,L=l.frag,O=l.part,E=l.payload,x=this.levels;if(x){var D=x[L.level],M=D.details;if(M){var F=D.videoCodec,B=M.PTSKnown||!M.live,U=null===(h=L.initSegment)||void 0===h?void 0:h.data,k=this._getAudioCodec(D),N=this.transmuxer=this.transmuxer||new f.default(this.hls,m.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),K=O?O.index:-1,w=new c.ChunkMetadata(L.level,L.sn,L.stats.chunkCount,E.byteLength,K,-1!==K);N.push(E,U,k,F,L,O,M.totalduration,B,w,this.initPTS[L.cc])}else this.warn("Dropping fragment "+L.sn+" of level "+L.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+L.sn+" of level "+L.level+" will not be buffered")},a.onAudioTrackSwitching=function(l,h){var L=this.altAudio,E=h.id;if(!h.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var x=this.fragCurrent;null!=x&&x.loader&&(this.log("Switching to main audio track, cancel main fragment load"),x.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var D=this.hls;L&&D.trigger(C.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),D.trigger(C.Events.AUDIO_TRACK_SWITCHED,{id:E})}},a.onAudioTrackSwitched=function(l,h){var O=!!this.hls.audioTracks[h.id].url;if(O){var E=this.videoBuffer;E&&this.mediaBuffer!==E&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=E)}this.altAudio=O,this.tick()},a.onBufferCreated=function(l,h){var O,E,L=h.tracks,x=!1;for(var D in L){var M=L[D];if("main"===M.id){if(E=D,O=M,"video"===D){var F=L[D];F&&(this.videoBuffer=F.buffer)}}else x=!0}x&&O?(this.log("Alternate track found, use "+E+".buffered to schedule main fragment loading"),this.mediaBuffer=O.buffer):this.mediaBuffer=this.media},a.onFragBuffered=function(l,h){var L=h.frag,O=h.part;if(!L||L.type===m.PlaylistLevelType.MAIN){if(this.fragContextChanged(L))return this.warn("Fragment "+L.sn+(O?" p: "+O.index:"")+" of level "+L.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===R.State.PARSED&&(this.state=R.State.IDLE));var E=O?O.stats:L.stats;this.fragLastKbps=Math.round(8*E.total/(E.buffering.end-E.loading.first)),"initSegment"!==L.sn&&(this.fragPrevious=L),this.fragBufferedComplete(L,O)}},a.onError=function(l,h){switch(h.details){case y.ErrorDetails.FRAG_LOAD_ERROR:case y.ErrorDetails.FRAG_LOAD_TIMEOUT:case y.ErrorDetails.KEY_LOAD_ERROR:case y.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(m.PlaylistLevelType.MAIN,h);break;case y.ErrorDetails.LEVEL_LOAD_ERROR:case y.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==R.State.ERROR&&(h.fatal?(this.warn(""+h.details),this.state=R.State.ERROR):!h.levelRetry&&this.state===R.State.WAITING_LEVEL&&(this.state=R.State.IDLE));break;case y.ErrorDetails.BUFFER_FULL_ERROR:if("main"===h.parent&&(this.state===R.State.PARSING||this.state===R.State.PARSED)){var L=!0,O=this.getFwdBufferInfo(this.media,m.PlaylistLevelType.MAIN);O&&O.len>.5&&(L=!this.reduceMaxBufferLength(O.len)),L&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},a.checkBuffer=function(){var l=this.media,h=this.gapController;if(l&&h&&l.readyState){var L=P.BufferHelper.getBuffered(l);!this.loadedmetadata&&L.length?(this.loadedmetadata=!0,this.seekToStartPos()):h.poll(this.lastCurrentTime),this.lastCurrentTime=l.currentTime}},a.onFragLoadEmergencyAborted=function(){this.state=R.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},a.onBufferFlushed=function(l,h){var L=h.type;(L!==s.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio)&&this.afterBufferFlushed((L===s.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media,L,m.PlaylistLevelType.MAIN)},a.onLevelsUpdated=function(l,h){this.levels=h.levels},a.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},a.seekToStartPos=function(){var l=this.media,h=l.currentTime,L=this.startPosition;if(L>=0&&h<L){if(l.seeking)return void g.logger.log("could not seek to "+L+", already seeking at "+h);var O=P.BufferHelper.getBuffered(l),x=(O.length?O.start(0):0)-L;x>0&&x<this.config.maxBufferHole&&(g.logger.log("adjusting start position by "+x+" to match buffer start"),this.startPosition=L+=x),this.log("seek to target start position "+L+" from current time "+h),l.currentTime=L}},a._getAudioCodec=function(l){var h=this.config.defaultAudioCodec||l.audioCodec;return this.audioCodecSwap&&h&&(this.log("Swapping audio codec"),h=-1!==h.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),h},a._loadBitrateTestFrag=function(l){var h=this;this._doFragLoad(l).then(function(L){var O=h.hls;if(L&&!O.nextLoadLevel&&!h.fragContextChanged(l)){h.fragLoadError=0,h.state=R.State.IDLE,h.startFragRequested=!1,h.bitrateTest=!1;var E=l.stats;E.parsing.start=E.parsing.end=E.buffering.start=E.buffering.end=self.performance.now(),O.trigger(C.Events.FRAG_LOADED,L)}})},a._handleTransmuxComplete=function(l){var h,L="main",O=this.hls,E=l.remuxResult,x=l.chunkMeta,D=this.getCurrentContext(x);if(!D)return this.warn("The loading context changed while buffering fragment "+x.sn+" of level "+x.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(x.level);var M=D.frag,F=D.part,B=D.level,U=E.video,k=E.text,N=E.id3,K=E.initSegment,W=this.altAudio?void 0:E.audio;if(!this.fragContextChanged(M)){if(this.state=R.State.PARSING,K){K.tracks&&(this._bufferInitSegment(B,K.tracks,M,x),O.trigger(C.Events.FRAG_PARSING_INIT_SEGMENT,{frag:M,id:L,tracks:K.tracks}));var w=K.initPTS,H=K.timescale;Object(b.isFiniteNumber)(w)&&(this.initPTS[M.cc]=w,O.trigger(C.Events.INIT_PTS_FOUND,{frag:M,id:L,initPTS:w,timescale:H}))}if(U&&!1!==E.independent){if(B.details){var j=U.startPTS,z=U.endPTS,J=U.startDTS,X=U.endDTS;if(F)F.elementaryStreams[U.type]={startPTS:j,endPTS:z,startDTS:J,endDTS:X};else if(U.firstKeyFrame&&U.independent&&(this.couldBacktrack=!0),U.dropped&&U.independent){if(this.getLoadPosition()+this.config.maxBufferHole<j)return void this.backtrack(M);M.setElementaryStreamInfo(U.type,M.start,z,M.start,X,!0)}M.setElementaryStreamInfo(U.type,j,z,J,X),this.bufferFragmentData(U,M,F,x)}}else if(!1===E.independent)return void this.backtrack(M);if(W){var V=W.startPTS,Q=W.endPTS,q=W.startDTS,$=W.endDTS;F&&(F.elementaryStreams[s.ElementaryStreamTypes.AUDIO]={startPTS:V,endPTS:Q,startDTS:q,endDTS:$}),M.setElementaryStreamInfo(s.ElementaryStreamTypes.AUDIO,V,Q,q,$),this.bufferFragmentData(W,M,F,x)}null!=N&&null!==(h=N.samples)&&void 0!==h&&h.length&&O.trigger(C.Events.FRAG_PARSING_METADATA,{frag:M,id:L,samples:N.samples}),k&&O.trigger(C.Events.FRAG_PARSING_USERDATA,{frag:M,id:L,samples:k.samples})}},a._bufferInitSegment=function(l,h,L,O){var E=this;if(this.state===R.State.PARSING){this.audioOnly=!!h.audio&&!h.video,this.altAudio&&!this.audioOnly&&delete h.audio;var x=h.audio,D=h.video,M=h.audiovideo;if(x){var F=l.audioCodec,B=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(F&&(F=-1!==F.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==x.metadata.channelCount&&-1===B.indexOf("firefox")&&(F="mp4a.40.5")),-1!==B.indexOf("android")&&"audio/mpeg"!==x.container&&this.log("Android: force audio codec to "+(F="mp4a.40.2")),l.audioCodec&&l.audioCodec!==F&&this.log('Swapping manifest audio codec "'+l.audioCodec+'" for "'+F+'"'),x.levelCodec=F,x.id="main",this.log("Init audio buffer, container:"+x.container+", codecs[selected/level/parsed]=["+(F||"")+"/"+(l.audioCodec||"")+"/"+x.codec+"]")}D&&(D.levelCodec=l.videoCodec,D.id="main",this.log("Init video buffer, container:"+D.container+", codecs[level/parsed]=["+(l.videoCodec||"")+"/"+D.codec+"]")),M&&this.log("Init audiovideo buffer, container:"+M.container+", codecs[level/parsed]=["+(l.attrs.CODECS||"")+"/"+M.codec+"]"),this.hls.trigger(C.Events.BUFFER_CODECS,h),Object.keys(h).forEach(function(U){var N=h[U].initSegment;null!=N&&N.byteLength&&E.hls.trigger(C.Events.BUFFER_APPENDING,{type:U,data:N,frag:L,part:null,chunkMeta:O,parent:L.type})}),this.tick()}},a.backtrack=function(l){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(l);var h=this.fragmentTracker.backtrack(l);this.fragPrevious=null,this.nextLoadPosition=l.start,h?this.resetFragmentLoading(l):this.state=R.State.BACKTRACKING},a.checkFragmentChanged=function(){var l=this.media,h=null;if(l&&l.readyState>1&&!1===l.seeking){var L=l.currentTime;if(P.BufferHelper.isBuffered(l,L)?h=this.getAppendedFrag(L):P.BufferHelper.isBuffered(l,L+.1)&&(h=this.getAppendedFrag(L+.1)),h){var O=this.fragPlaying,E=h.level;(!O||h.sn!==O.sn||O.level!==E||h.urlId!==O.urlId)&&(this.hls.trigger(C.Events.FRAG_CHANGED,{frag:h}),(!O||O.level!==E)&&this.hls.trigger(C.Events.LEVEL_SWITCHED,{level:E}),this.fragPlaying=h)}}},function(n,u,a){u&&v(n.prototype,u),a&&v(n,a)}(u,[{key:"nextLevel",get:function(){var l=this.nextBufferedFrag;return l?l.level:-1}},{key:"currentLevel",get:function(){var l=this.media;if(l){var h=this.getAppendedFrag(l.currentTime);if(h)return h.level}return-1}},{key:"nextBufferedFrag",get:function(){var l=this.media;if(l){var h=this.getAppendedFrag(l.currentTime);return this.followingBufferedFrag(h)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),u}(R.default)},"./src/crypt/aes-crypto.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"default",function(){return b});var b=function(){function R(C,P){this.subtle=void 0,this.aesIV=void 0,this.subtle=C,this.aesIV=P}return R.prototype.decrypt=function(P,A){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},A,P)},R}()},"./src/crypt/aes-decryptor.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"removePadding",function(){return R}),p.d(I,"default",function(){return S});var b=p("./src/utils/typed-array.ts");function R(C){var P=C.byteLength,A=P&&new DataView(C.buffer).getUint8(P-1);return A?Object(b.sliceUint8)(C,0,P-A):C}var S=function(){function C(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var P=C.prototype;return P.uint8ArrayToUint32Array_=function(m){for(var s=new DataView(m),f=new Uint32Array(4),c=0;c<4;c++)f[c]=s.getUint32(4*c);return f},P.initTable=function(){var m=this.sBox,s=this.invSBox,f=this.subMix,c=f[0],T=f[1],y=f[2],g=f[3],v=this.invSubMix,r=v[0],t=v[1],e=v[2],d=v[3],i=new Uint32Array(256),n=0,u=0,a=0;for(a=0;a<256;a++)i[a]=a<128?a<<1:a<<1^283;for(a=0;a<256;a++){var o=u^u<<1^u<<2^u<<3^u<<4;m[n]=o=o>>>8^255&o^99,s[o]=n;var l=i[n],h=i[l],L=i[h],O=257*i[o]^16843008*o;c[n]=O<<24|O>>>8,T[n]=O<<16|O>>>16,y[n]=O<<8|O>>>24,g[n]=O,r[o]=(O=16843009*L^65537*h^257*l^16843008*n)<<24|O>>>8,t[o]=O<<16|O>>>16,e[o]=O<<8|O>>>24,d[o]=O,n?(n=l^i[i[i[L^l]]],u^=i[i[u]]):n=u=1}},P.expandKey=function(m){for(var s=this.uint8ArrayToUint32Array_(m),f=!0,c=0;c<s.length&&f;)f=s[c]===this.key[c],c++;if(!f){this.key=s;var T=this.keySize=s.length;if(4!==T&&6!==T&&8!==T)throw new Error("Invalid aes key size="+T);var g,v,l,h,y=this.ksRows=4*(T+6+1),r=this.keySchedule=new Uint32Array(y),t=this.invKeySchedule=new Uint32Array(y),e=this.sBox,d=this.rcon,i=this.invSubMix,n=i[0],u=i[1],a=i[2],o=i[3];for(g=0;g<y;g++)g<T?l=r[g]=s[g]:(h=l,g%T==0?(h=e[(h=h<<8|h>>>24)>>>24]<<24|e[h>>>16&255]<<16|e[h>>>8&255]<<8|e[255&h],h^=d[g/T|0]<<24):T>6&&g%T==4&&(h=e[h>>>24]<<24|e[h>>>16&255]<<16|e[h>>>8&255]<<8|e[255&h]),r[g]=l=(r[g-T]^h)>>>0);for(v=0;v<y;v++)g=y-v,h=3&v?r[g]:r[g-4],t[v]=v<4||g<=4?h:n[e[h>>>24]]^u[e[h>>>16&255]]^a[e[h>>>8&255]]^o[e[255&h]],t[v]=t[v]>>>0}},P.networkToHostOrderSwap=function(m){return m<<24|(65280&m)<<8|(16711680&m)>>8|m>>>24},P.decrypt=function(m,s,f){for(var L,O,E,x,D,M,F,B,U,k,N,K,W,c=this.keySize+6,T=this.invKeySchedule,y=this.invSBox,g=this.invSubMix,v=g[0],r=g[1],t=g[2],e=g[3],d=this.uint8ArrayToUint32Array_(f),i=d[0],n=d[1],u=d[2],a=d[3],o=new Int32Array(m),l=new Int32Array(o.length),w=this.networkToHostOrderSwap;s<o.length;){for(B=w(o[s]),U=w(o[s+1]),k=w(o[s+2]),N=w(o[s+3]),x=B^T[0],D=N^T[1],M=k^T[2],F=U^T[3],K=4,W=1;W<c;W++)L=v[D>>>24]^r[M>>16&255]^t[F>>8&255]^e[255&x]^T[K+1],O=v[M>>>24]^r[F>>16&255]^t[x>>8&255]^e[255&D]^T[K+2],E=v[F>>>24]^r[x>>16&255]^t[D>>8&255]^e[255&M]^T[K+3],x=v[x>>>24]^r[D>>16&255]^t[M>>8&255]^e[255&F]^T[K],D=L,M=O,F=E,K+=4;L=y[D>>>24]<<24^y[M>>16&255]<<16^y[F>>8&255]<<8^y[255&x]^T[K+1],O=y[M>>>24]<<24^y[F>>16&255]<<16^y[x>>8&255]<<8^y[255&D]^T[K+2],E=y[F>>>24]<<24^y[x>>16&255]<<16^y[D>>8&255]<<8^y[255&M]^T[K+3],l[s]=w(y[x>>>24]<<24^y[D>>16&255]<<16^y[M>>8&255]<<8^y[255&F]^T[K]^i),l[s+1]=w(E^n),l[s+2]=w(O^u),l[s+3]=w(L^a),i=B,n=U,u=k,a=N,s+=4}return l.buffer},C}()},"./src/crypt/decrypter.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"default",function(){return s});var b=p("./src/crypt/aes-crypto.ts"),R=p("./src/crypt/fast-aes-key.ts"),S=p("./src/crypt/aes-decryptor.ts"),C=p("./src/utils/logger.ts"),P=p("./src/utils/mp4-tools.ts"),A=p("./src/utils/typed-array.ts"),s=function(){function f(T,y,g){var r=(void 0===g?{}:g).removePKCS7Padding,t=void 0===r||r;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=T,this.config=y,this.removePKCS7Padding=t,t)try{var e=self.crypto;e&&(this.subtle=e.subtle||e.webkitSubtle)}catch(d){}null===this.subtle&&(this.config.enableSoftwareAES=!0)}var c=f.prototype;return c.destroy=function(){this.observer=null},c.isSync=function(){return this.config.enableSoftwareAES},c.flush=function(){var y=this.currentResult;if(y){var g=new Uint8Array(y);return this.reset(),this.removePKCS7Padding?Object(S.removePadding)(g):g}this.reset()},c.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},c.decrypt=function(y,g,v,r){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(y),g,v);var t=this.flush();t&&r(t.buffer)}else this.webCryptoDecrypt(new Uint8Array(y),g,v).then(r)},c.softwareDecrypt=function(y,g,v){var r=this.currentIV,t=this.currentResult,e=this.remainderData;this.logOnce("JS AES decrypt"),e&&(y=Object(P.appendUint8Array)(e,y),this.remainderData=null);var d=this.getValidChunk(y);if(!d.length)return null;r&&(v=r);var i=this.softwareDecrypter;i||(i=this.softwareDecrypter=new S.default),i.expandKey(g);var n=t;return this.currentResult=i.decrypt(d.buffer,0,v),this.currentIV=Object(A.sliceUint8)(d,-16).buffer,n||null},c.webCryptoDecrypt=function(y,g,v){var r=this,t=this.subtle;return(this.key!==g||!this.fastAesKey)&&(this.key=g,this.fastAesKey=new R.default(t,g)),this.fastAesKey.expandKey().then(function(e){return t?new b.default(t,v).decrypt(y.buffer,e):Promise.reject(new Error("web crypto not initialized"))}).catch(function(e){return r.onWebCryptoError(e,y,g,v)})},c.onWebCryptoError=function(y,g,v,r){return C.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",y),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(g,v,r)},c.getValidChunk=function(y){var g=y,v=y.length-y.length%16;return v!==y.length&&(g=Object(A.sliceUint8)(y,0,v),this.remainderData=Object(A.sliceUint8)(y,v)),g},c.logOnce=function(y){!this.logEnabled||(C.logger.log("[decrypter.ts]: "+y),this.logEnabled=!1)},f}()},"./src/crypt/fast-aes-key.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"default",function(){return b});var b=function(){function R(C,P){this.subtle=void 0,this.key=void 0,this.subtle=C,this.key=P}return R.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},R}()},"./src/demux/aacdemuxer.ts":function(G,I,p){"use strict";p.r(I);var b=p("./src/demux/base-audio-demuxer.ts"),R=p("./src/demux/adts.ts"),S=p("./src/utils/logger.ts"),C=p("./src/demux/id3.ts");function P(s,f){s.prototype=Object.create(f.prototype),s.prototype.constructor=s,A(s,f)}function A(s,f){return(A=Object.setPrototypeOf||function(T,y){return T.__proto__=y,T})(s,f)}var m=function(s){function f(T,y){var g;return(g=s.call(this)||this).observer=void 0,g.config=void 0,g.observer=T,g.config=y,g}P(f,s);var c=f.prototype;return c.resetInitSegment=function(y,g,v){s.prototype.resetInitSegment.call(this,y,g,v),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:y,duration:v,inputTimeScale:9e4,dropped:0}},f.probe=function(y){if(!y)return!1;for(var v=(C.getID3Data(y,0)||[]).length,r=y.length;v<r;v++)if(R.probe(y,v))return S.logger.log("ADTS sync word found !"),!0;return!1},c.canParse=function(y,g){return R.canParse(y,g)},c.appendFrame=function(y,g,v){R.initTrackConfig(y,this.observer,g,v,y.manifestCodec);var r=R.appendFrame(y,g,v,this.initPTS,this.frameIndex);if(r&&0===r.missing)return r},f}(b.default);m.minProbeByteLength=9,I.default=m},"./src/demux/adts.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"getAudioConfig",function(){return C}),p.d(I,"isHeaderPattern",function(){return P}),p.d(I,"getHeaderLength",function(){return A}),p.d(I,"getFullFrameLength",function(){return m}),p.d(I,"canGetFrameLength",function(){return s}),p.d(I,"isHeader",function(){return f}),p.d(I,"canParse",function(){return c}),p.d(I,"probe",function(){return T}),p.d(I,"initTrackConfig",function(){return y}),p.d(I,"getFrameDuration",function(){return g}),p.d(I,"parseFrameHeader",function(){return v}),p.d(I,"appendFrame",function(){return r});var b=p("./src/utils/logger.ts"),R=p("./src/errors.ts"),S=p("./src/events.ts");function C(t,e,d,i){var n,u,a,o,l=navigator.userAgent.toLowerCase(),h=i,L=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];n=1+((192&e[d+2])>>>6);var O=(60&e[d+2])>>>2;if(!(O>L.length-1))return a=(1&e[d+2])<<2,a|=(192&e[d+3])>>>6,b.logger.log("manifest codec:"+i+", ADTS type:"+n+", samplingIndex:"+O),/firefox/i.test(l)?O>=6?(n=5,o=new Array(4),u=O-3):(n=2,o=new Array(2),u=O):-1!==l.indexOf("android")?(n=2,o=new Array(2),u=O):(n=5,o=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&O>=6?u=O-3:((i&&-1!==i.indexOf("mp4a.40.2")&&(O>=6&&1===a||/vivaldi/i.test(l))||!i&&1===a)&&(n=2,o=new Array(2)),u=O)),o[0]=n<<3,o[0]|=(14&O)>>1,o[1]|=(1&O)<<7,o[1]|=a<<3,5===n&&(o[1]|=(14&u)>>1,o[2]=(1&u)<<7,o[2]|=8,o[3]=0),{config:o,samplerate:L[O],channelCount:a,codec:"mp4a.40."+n,manifestCodec:h};t.trigger(S.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+O})}function P(t,e){return 255===t[e]&&240==(246&t[e+1])}function A(t,e){return 1&t[e+1]?7:9}function m(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function s(t,e){return e+5<t.length}function f(t,e){return e+1<t.length&&P(t,e)}function c(t,e){return s(t,e)&&P(t,e)&&m(t,e)<=t.length-e}function T(t,e){if(f(t,e)){var d=A(t,e);if(e+d>=t.length)return!1;var i=m(t,e);if(i<=d)return!1;var n=e+i;return n===t.length||f(t,n)}return!1}function y(t,e,d,i,n){if(!t.samplerate){var u=C(e,d,i,n);if(!u)return;t.config=u.config,t.samplerate=u.samplerate,t.channelCount=u.channelCount,t.codec=u.codec,t.manifestCodec=u.manifestCodec,b.logger.log("parsed codec:"+t.codec+", rate:"+u.samplerate+", channels:"+u.channelCount)}}function g(t){return 9216e4/t}function v(t,e,d,i,n){var u=A(t,e),a=m(t,e);if((a-=u)>0)return{headerLength:u,frameLength:a,stamp:d+i*n}}function r(t,e,d,i,n){var a=v(e,d,i,n,g(t.samplerate));if(a){var E,l=a.headerLength,h=a.stamp,L=l+a.frameLength,O=Math.max(0,d+L-e.length);O?(E=new Uint8Array(L-l)).set(e.subarray(d+l,e.length),0):E=e.subarray(d+l,d+L);var x={unit:E,pts:h};return O||t.samples.push(x),{sample:x,length:L,missing:O}}}},"./src/demux/base-audio-demuxer.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"initPTSFn",function(){return m});var b=p("./src/polyfills/number.ts"),R=p("./src/demux/id3.ts"),S=p("./src/demux/dummy-demuxed-track.ts"),C=p("./src/utils/mp4-tools.ts"),P=p("./src/utils/typed-array.ts"),A=function(){function s(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var f=s.prototype;return f.resetInitSegment=function(T,y,g){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},f.resetTimeStamp=function(){},f.resetContiguity=function(){},f.canParse=function(T,y){return!1},f.appendFrame=function(T,y,g){},f.demux=function(T,y){this.cachedData&&(T=Object(C.appendUint8Array)(this.cachedData,T),this.cachedData=null);var r,t,g=R.getID3Data(T,0),v=g?g.length:0,e=this._audioTrack,d=this._id3Track,i=g?R.getTimeStamp(g):void 0,n=T.length;for((0===this.frameIndex||null===this.initPTS)&&(this.initPTS=m(i,y)),g&&g.length>0&&d.samples.push({pts:this.initPTS,dts:this.initPTS,data:g}),t=this.initPTS;v<n;){if(this.canParse(T,v)){var u=this.appendFrame(e,T,v);u?(this.frameIndex++,t=u.sample.pts,r=v+=u.length):v=n}else R.canParse(T,v)?(g=R.getID3Data(T,v),d.samples.push({pts:t,dts:t,data:g}),r=v+=g.length):v++;if(v===n&&r!==n){var a=Object(P.sliceUint8)(T,r);this.cachedData=this.cachedData?Object(C.appendUint8Array)(this.cachedData,a):a}}return{audioTrack:e,avcTrack:Object(S.dummyTrack)(),id3Track:d,textTrack:Object(S.dummyTrack)()}},f.demuxSampleAes=function(T,y,g){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},f.flush=function(T){var y=this.cachedData;return y&&(this.cachedData=null,this.demux(y,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(S.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(S.dummyTrack)()}},f.destroy=function(){},s}(),m=function(f,c){return Object(b.isFiniteNumber)(f)?90*f:9e4*c};I.default=A},"./src/demux/chunk-cache.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"default",function(){return b});var b=function(){function S(){this.chunks=[],this.dataLength=0}var C=S.prototype;return C.push=function(A){this.chunks.push(A),this.dataLength+=A.length},C.flush=function(){var s,A=this.chunks;return A.length?(s=1===A.length?A[0]:function(S,C){for(var P=new Uint8Array(C),A=0,m=0;m<S.length;m++){var s=S[m];P.set(s,A),A+=s.length}return P}(A,this.dataLength),this.reset(),s):new Uint8Array(0)},C.reset=function(){this.chunks.length=0,this.dataLength=0},S}()},"./src/demux/dummy-demuxed-track.ts":function(G,I,p){"use strict";function b(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}p.r(I),p.d(I,"dummyTrack",function(){return b})},"./src/demux/exp-golomb.ts":function(G,I,p){"use strict";p.r(I);var b=p("./src/utils/logger.ts");I.default=function(){function S(P){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=P,this.bytesAvailable=P.byteLength,this.word=0,this.bitsAvailable=0}var C=S.prototype;return C.loadWord=function(){var A=this.data,m=this.bytesAvailable,s=A.byteLength-m,f=new Uint8Array(4),c=Math.min(4,m);if(0===c)throw new Error("no bytes available");f.set(A.subarray(s,s+c)),this.word=new DataView(f.buffer).getUint32(0),this.bitsAvailable=8*c,this.bytesAvailable-=c},C.skipBits=function(A){var m;this.bitsAvailable>A?(this.word<<=A,this.bitsAvailable-=A):(A-=this.bitsAvailable,A-=(m=A>>3)>>3,this.bytesAvailable-=m,this.loadWord(),this.word<<=A,this.bitsAvailable-=A)},C.readBits=function(A){var m=Math.min(this.bitsAvailable,A),s=this.word>>>32-m;return A>32&&b.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=m,this.bitsAvailable>0?this.word<<=m:this.bytesAvailable>0&&this.loadWord(),(m=A-m)>0&&this.bitsAvailable?s<<m|this.readBits(m):s},C.skipLZ=function(){var A;for(A=0;A<this.bitsAvailable;++A)if(0!=(this.word&2147483648>>>A))return this.word<<=A,this.bitsAvailable-=A,A;return this.loadWord(),A+this.skipLZ()},C.skipUEG=function(){this.skipBits(1+this.skipLZ())},C.skipEG=function(){this.skipBits(1+this.skipLZ())},C.readUEG=function(){var A=this.skipLZ();return this.readBits(A+1)-1},C.readEG=function(){var A=this.readUEG();return 1&A?1+A>>>1:-1*(A>>>1)},C.readBoolean=function(){return 1===this.readBits(1)},C.readUByte=function(){return this.readBits(8)},C.readUShort=function(){return this.readBits(16)},C.readUInt=function(){return this.readBits(32)},C.skipScalingList=function(A){for(var m=8,s=8,c=0;c<A;c++)0!==s&&(s=(m+this.readEG()+256)%256),m=0===s?m:s},C.readSPS=function(){var c,T,y,A=0,m=0,s=0,f=0,g=this.readUByte.bind(this),v=this.readBits.bind(this),r=this.readUEG.bind(this),t=this.readBoolean.bind(this),e=this.skipBits.bind(this),d=this.skipEG.bind(this),i=this.skipUEG.bind(this),n=this.skipScalingList.bind(this);g();var u=g();if(v(5),e(3),g(),i(),100===u||110===u||122===u||244===u||44===u||83===u||86===u||118===u||128===u){var a=r();if(3===a&&e(1),i(),i(),e(1),t())for(T=3!==a?8:12,y=0;y<T;y++)t()&&n(y<6?16:64)}i();var o=r();if(0===o)r();else if(1===o)for(e(1),d(),d(),c=r(),y=0;y<c;y++)d();i(),e(1);var l=r(),h=r(),L=v(1);0===L&&e(1),e(1),t()&&(A=r(),m=r(),s=r(),f=r());var O=[1,1];if(t()&&t())switch(g()){case 1:O=[1,1];break;case 2:O=[12,11];break;case 3:O=[10,11];break;case 4:O=[16,11];break;case 5:O=[40,33];break;case 6:O=[24,11];break;case 7:O=[20,11];break;case 8:O=[32,11];break;case 9:O=[80,33];break;case 10:O=[18,11];break;case 11:O=[15,11];break;case 12:O=[64,33];break;case 13:O=[160,99];break;case 14:O=[4,3];break;case 15:O=[3,2];break;case 16:O=[2,1];break;case 255:O=[g()<<8|g(),g()<<8|g()]}return{width:Math.ceil(16*(l+1)-2*A-2*m),height:(2-L)*(h+1)*16-(L?2:4)*(s+f),pixelRatio:O}},C.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},S}()},"./src/demux/id3.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"isHeader",function(){return b}),p.d(I,"isFooter",function(){return R}),p.d(I,"getID3Data",function(){return S}),p.d(I,"canParse",function(){return P}),p.d(I,"getTimeStamp",function(){return A}),p.d(I,"isTimeStampFrame",function(){return m}),p.d(I,"getID3Frames",function(){return f}),p.d(I,"decodeFrame",function(){return c}),p.d(I,"utf8ArrayToStr",function(){return r}),p.d(I,"testables",function(){return t});var e,b=function(n,u){return u+10<=n.length&&73===n[u]&&68===n[u+1]&&51===n[u+2]&&n[u+3]<255&&n[u+4]<255&&n[u+6]<128&&n[u+7]<128&&n[u+8]<128&&n[u+9]<128},R=function(n,u){return u+10<=n.length&&51===n[u]&&68===n[u+1]&&73===n[u+2]&&n[u+3]<255&&n[u+4]<255&&n[u+6]<128&&n[u+7]<128&&n[u+8]<128&&n[u+9]<128},S=function(n,u){for(var a=u,o=0;b(n,u);)o+=10,o+=C(n,u+6),R(n,u+10)&&(o+=10),u+=o;if(o>0)return n.subarray(a,a+o)},C=function(n,u){var a=0;return a=(127&n[u])<<21,a|=(127&n[u+1])<<14,(a|=(127&n[u+2])<<7)|127&n[u+3]},P=function(n,u){return b(n,u)&&C(n,u+6)+10<=n.length-u},A=function(n){for(var u=f(n),a=0;a<u.length;a++){var o=u[a];if(m(o))return v(o)}},m=function(n){return n&&"PRIV"===n.key&&"com.apple.streaming.transportStreamTimestamp"===n.info},s=function(n){var u=String.fromCharCode(n[0],n[1],n[2],n[3]),a=C(n,4);return{type:u,size:a,data:n.subarray(10,10+a)}},f=function(n){for(var u=0,a=[];b(n,u);){for(var o=C(n,u+6),l=(u+=10)+o;u+8<l;){var h=s(n.subarray(u)),L=c(h);L&&a.push(L),u+=h.size+10}R(n,u)&&(u+=10)}return a},c=function(n){return"PRIV"===n.type?T(n):"W"===n.type[0]?g(n):y(n)},T=function(n){if(!(n.size<2)){var u=r(n.data,!0),a=new Uint8Array(n.data.subarray(u.length+1));return{key:n.type,info:u,data:a.buffer}}},y=function(n){if(!(n.size<2)){if("TXXX"===n.type){var u=1,a=r(n.data.subarray(u),!0),o=r(n.data.subarray(u+=a.length+1));return{key:n.type,info:a,data:o}}var l=r(n.data.subarray(1));return{key:n.type,data:l}}},g=function(n){if("WXXX"===n.type){if(n.size<2)return;var u=1,a=r(n.data.subarray(u),!0),o=r(n.data.subarray(u+=a.length+1));return{key:n.type,info:a,data:o}}var l=r(n.data);return{key:n.type,data:l}},v=function(n){if(8===n.data.byteLength){var u=new Uint8Array(n.data),o=(u[4]<<23)+(u[5]<<15)+(u[6]<<7)+u[7];return o/=45,1&u[3]&&(o+=47721858.84),Math.round(o)}},r=function(n,u){void 0===u&&(u=!1);var a=(!e&&void 0!==self.TextDecoder&&(e=new self.TextDecoder("utf-8")),e);if(a){var o=a.decode(n);if(u){var l=o.indexOf("\0");return-1!==l?o.substring(0,l):o}return o.replace(/\0/g,"")}for(var L,O,E,h=n.length,x="",D=0;D<h;){if(0===(L=n[D++])&&u)return x;if(0!==L&&3!==L)switch(L>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:x+=String.fromCharCode(L);break;case 12:case 13:O=n[D++],x+=String.fromCharCode((31&L)<<6|63&O);break;case 14:O=n[D++],E=n[D++],x+=String.fromCharCode((15&L)<<12|(63&O)<<6|(63&E)<<0)}}return x},t={decodeTextFrame:y}},"./src/demux/mp3demuxer.ts":function(G,I,p){"use strict";p.r(I);var b=p("./src/demux/base-audio-demuxer.ts"),R=p("./src/demux/id3.ts"),S=p("./src/utils/logger.ts"),C=p("./src/demux/mpegaudio.ts");function P(s,f){s.prototype=Object.create(f.prototype),s.prototype.constructor=s,A(s,f)}function A(s,f){return(A=Object.setPrototypeOf||function(T,y){return T.__proto__=y,T})(s,f)}var m=function(s){function f(){return s.apply(this,arguments)||this}P(f,s);var c=f.prototype;return c.resetInitSegment=function(y,g,v){s.prototype.resetInitSegment.call(this,y,g,v),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:y,duration:v,inputTimeScale:9e4,dropped:0}},f.probe=function(y){if(!y)return!1;for(var v=(R.getID3Data(y,0)||[]).length,r=y.length;v<r;v++)if(C.probe(y,v))return S.logger.log("MPEG Audio sync word found !"),!0;return!1},c.canParse=function(y,g){return C.canParse(y,g)},c.appendFrame=function(y,g,v){if(null!==this.initPTS)return C.appendFrame(y,g,v,this.initPTS,this.frameIndex)},f}(b.default);m.minProbeByteLength=4,I.default=m},"./src/demux/mp4demuxer.ts":function(G,I,p){"use strict";p.r(I);var b=p("./src/utils/mp4-tools.ts"),R=p("./src/demux/dummy-demuxed-track.ts"),S=function(){function C(A,m){this.remainderData=null,this.config=void 0,this.config=m}var P=C.prototype;return P.resetTimeStamp=function(){},P.resetInitSegment=function(){},P.resetContiguity=function(){},C.probe=function(m){return Object(b.findBox)({data:m,start:0,end:Math.min(m.length,16384)},["moof"]).length>0},P.demux=function(m){var s=m,f=Object(R.dummyTrack)();if(this.config.progressive){this.remainderData&&(s=Object(b.appendUint8Array)(this.remainderData,m));var c=Object(b.segmentValidRange)(s);this.remainderData=c.remainder,f.samples=c.valid||new Uint8Array}else f.samples=s;return{audioTrack:Object(R.dummyTrack)(),avcTrack:f,id3Track:Object(R.dummyTrack)(),textTrack:Object(R.dummyTrack)()}},P.flush=function(){var m=Object(R.dummyTrack)();return m.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(R.dummyTrack)(),avcTrack:m,id3Track:Object(R.dummyTrack)(),textTrack:Object(R.dummyTrack)()}},P.demuxSampleAes=function(m,s,f){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},P.destroy=function(){},C}();S.minProbeByteLength=1024,I.default=S},"./src/demux/mpegaudio.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"appendFrame",function(){return A}),p.d(I,"parseHeader",function(){return m}),p.d(I,"isHeaderPattern",function(){return s}),p.d(I,"isHeader",function(){return f}),p.d(I,"canParse",function(){return c}),p.d(I,"probe",function(){return T});var b=null,R=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],S=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],C=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],P=[0,1,1,4];function A(y,g,v,r,t){if(!(v+24>g.length)){var e=m(g,v);if(e&&v+e.frameLength<=g.length){var i=r+t*(9e4*e.samplesPerFrame/e.sampleRate),n={unit:g.subarray(v,v+e.frameLength),pts:i,dts:i};return y.config=[],y.channelCount=e.channelCount,y.samplerate=e.sampleRate,y.samples.push(n),{sample:n,length:e.frameLength,missing:0}}}}function m(y,g){var v=y[g+1]>>3&3,r=y[g+1]>>1&3,t=y[g+2]>>4&15,e=y[g+2]>>2&3;if(1!==v&&0!==t&&15!==t&&3!==e){var i=y[g+3]>>6,u=1e3*R[14*(3===v?3-r:3===r?3:4)+t-1],o=S[3*(3===v?0:2===v?1:2)+e],l=3===i?1:2,h=C[v][r],L=P[r],O=8*h*L,E=Math.floor(h*u/o+(y[g+2]>>1&1))*L;if(null===b){var D=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);b=D?parseInt(D[1]):0}return!!b&&b<=87&&2===r&&u>=224e3&&0===i&&(y[g+3]=128|y[g+3]),{sampleRate:o,channelCount:l,frameLength:E,samplesPerFrame:O}}}function s(y,g){return 255===y[g]&&224==(224&y[g+1])&&0!=(6&y[g+1])}function f(y,g){return g+1<y.length&&s(y,g)}function c(y,g){return s(y,g)&&4<=y.length-g}function T(y,g){if(g+1<y.length&&s(y,g)){var r=m(y,g),t=4;null!=r&&r.frameLength&&(t=r.frameLength);var e=g+t;return e===y.length||f(y,e)}return!1}},"./src/demux/sample-aes.ts":function(G,I,p){"use strict";p.r(I);var b=p("./src/crypt/decrypter.ts"),R=p("./src/demux/tsdemuxer.ts");I.default=function(){function C(A,m,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new b.default(A,m,{removePKCS7Padding:!1})}var P=C.prototype;return P.decryptBuffer=function(m,s){this.decrypter.decrypt(m,this.keyData.key.buffer,this.keyData.iv.buffer,s)},P.decryptAacSample=function(m,s,f,c){var T=m[s].unit,y=T.subarray(16,T.length-T.length%16),g=y.buffer.slice(y.byteOffset,y.byteOffset+y.length),v=this;this.decryptBuffer(g,function(r){var t=new Uint8Array(r);T.set(t,16),c||v.decryptAacSamples(m,s+1,f)})},P.decryptAacSamples=function(m,s,f){for(;;s++){if(s>=m.length)return void f();if(!(m[s].unit.length<32)){var c=this.decrypter.isSync();if(this.decryptAacSample(m,s,f,c),!c)return}}},P.getAvcEncryptedData=function(m){for(var s=16*Math.floor((m.length-48)/160)+16,f=new Int8Array(s),c=0,T=32;T<=m.length-16;T+=160,c+=16)f.set(m.subarray(T,T+16),c);return f},P.getAvcDecryptedUnit=function(m,s){for(var f=new Uint8Array(s),c=0,T=32;T<=m.length-16;T+=160,c+=16)m.set(f.subarray(c,c+16),T);return m},P.decryptAvcSample=function(m,s,f,c,T,y){var g=Object(R.discardEPB)(T.data),v=this.getAvcEncryptedData(g),r=this;this.decryptBuffer(v.buffer,function(t){T.data=r.getAvcDecryptedUnit(g,t),y||r.decryptAvcSamples(m,s,f+1,c)})},P.decryptAvcSamples=function(m,s,f,c){if(m instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;s++,f=0){if(s>=m.length)return void c();for(var T=m[s].units;!(f>=T.length);f++){var y=T[f];if(!(y.data.length<=48||1!==y.type&&5!==y.type)){var g=this.decrypter.isSync();if(this.decryptAvcSample(m,s,f,c,y,g),!g)return}}}},C}()},"./src/demux/transmuxer-interface.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"default",function(){return T});var b=p("./node_modules/webworkify-webpack/index.js"),S=p("./src/events.ts"),C=p("./src/demux/transmuxer.ts"),P=p("./src/utils/logger.ts"),A=p("./src/errors.ts"),m=p("./src/utils/mediasource-helper.ts"),s=p("./node_modules/eventemitter3/index.js"),c=Object(m.getMediaSource)()||{isTypeSupported:function(){return!1}},T=function(){function y(v,r,t,e){var d=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=v,this.id=r,this.onTransmuxComplete=t,this.onFlush=e;var i=v.config,n=function(h,L){(L=L||{}).frag=d.frag,L.id=d.id,v.trigger(h,L)};this.observer=new s.EventEmitter,this.observer.on(S.Events.FRAG_DECRYPTED,n),this.observer.on(S.Events.ERROR,n);var u={mp4:c.isTypeSupported("video/mp4"),mpeg:c.isTypeSupported("audio/mpeg"),mp3:c.isTypeSupported('audio/mp4; codecs="mp3"')},a=navigator.vendor;if(i.enableWorker&&"undefined"!=typeof Worker){var o;P.logger.log("demuxing in webworker");try{o=this.worker=b("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),o.addEventListener("message",this.onwmsg),o.onerror=function(l){v.trigger(S.Events.ERROR,{type:A.ErrorTypes.OTHER_ERROR,details:A.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(l.message+"  ("+l.filename+":"+l.lineno+")")})},o.postMessage({cmd:"init",typeSupported:u,vendor:a,id:r,config:JSON.stringify(i)})}catch(l){P.logger.warn("Error in worker:",l),P.logger.error("Error while initializing DemuxerWorker, fallback to inline"),o&&self.URL.revokeObjectURL(o.objectURL),this.transmuxer=new C.default(this.observer,u,i,a,r),this.worker=null}}else this.transmuxer=new C.default(this.observer,u,i,a,r)}var g=y.prototype;return g.destroy=function(){var r=this.worker;if(r)r.removeEventListener("message",this.onwmsg),r.terminate(),this.worker=null;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.observer=null},g.push=function(r,t,e,d,i,n,u,a,o,l){var h=this;o.transmuxing.start=self.performance.now();var L=this.transmuxer,O=this.worker,E=n?n.start:i.start,x=i.decryptdata,D=this.frag,M=!(D&&i.cc===D.cc),F=!(D&&o.level===D.level),B=D?o.sn-D.sn:-1,U=this.part?o.part-this.part.index:1,k=!F&&(1===B||0===B&&1===U),N=self.performance.now();(F||B||0===i.stats.parsing.start)&&(i.stats.parsing.start=N),n&&(U||!k)&&(n.stats.parsing.start=N);var K=new C.TransmuxState(M,k,a,F,E);if(!k||M){P.logger.log("[transmuxer-interface, "+i.type+"]: Starting new transmux session for sn: "+o.sn+" p: "+o.part+" level: "+o.level+" id: "+o.id+"\n        discontinuity: "+M+"\n        trackSwitch: "+F+"\n        contiguous: "+k+"\n        accurateTimeOffset: "+a+"\n        timeOffset: "+E);var W=new C.TransmuxConfig(e,d,t,u,l);this.configureTransmuxer(W)}if(this.frag=i,this.part=n,O)O.postMessage({cmd:"demux",data:r,decryptdata:x,chunkMeta:o,state:K},r instanceof ArrayBuffer?[r]:[]);else if(L){var w=L.push(r,x,o,K);Object(C.isPromise)(w)?w.then(function(H){h.handleTransmuxComplete(H)}):this.handleTransmuxComplete(w)}},g.flush=function(r){var t=this;r.transmuxing.start=self.performance.now();var e=this.transmuxer,d=this.worker;if(d)d.postMessage({cmd:"flush",chunkMeta:r});else if(e){var i=e.flush(r);Object(C.isPromise)(i)?i.then(function(n){t.handleFlushResult(n,r)}):this.handleFlushResult(i,r)}},g.handleFlushResult=function(r,t){var e=this;r.forEach(function(d){e.handleTransmuxComplete(d)}),this.onFlush(t)},g.onWorkerMessage=function(r){var t=r.data,e=this.hls;switch(t.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,e.trigger(t.event,t.data)}},g.configureTransmuxer=function(r){var t=this.worker,e=this.transmuxer;t?t.postMessage({cmd:"configure",config:r}):e&&e.configure(r)},g.handleTransmuxComplete=function(r){r.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(r)},y}()},"./src/demux/transmuxer-worker.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"default",function(){return A});var b=p("./src/demux/transmuxer.ts"),R=p("./src/events.ts"),S=p("./src/utils/logger.ts"),C=p("./node_modules/eventemitter3/index.js");function A(T){var y=new C.EventEmitter,g=function(r,t){T.postMessage({event:r,data:t})};y.on(R.Events.FRAG_DECRYPTED,g),y.on(R.Events.ERROR,g),T.addEventListener("message",function(v){var r=v.data;switch(r.cmd){case"init":var t=JSON.parse(r.config);T.transmuxer=new b.default(y,r.typeSupported,t,r.vendor,r.id),Object(S.enableLogs)(t.debug),g("init",null);break;case"configure":T.transmuxer.configure(r.config);break;case"demux":var e=T.transmuxer.push(r.data,r.decryptdata,r.chunkMeta,r.state);Object(b.isPromise)(e)?e.then(function(n){m(T,n)}):m(T,e);break;case"flush":var d=r.chunkMeta,i=T.transmuxer.flush(d);Object(b.isPromise)(i)?i.then(function(n){f(T,n,d)}):f(T,i,d)}})}function m(T,y){if(!function(T){return!(T.audio||T.video||T.text||T.id3||T.initSegment)}(y.remuxResult)){var g=[],v=y.remuxResult,r=v.audio,t=v.video;r&&s(g,r),t&&s(g,t),T.postMessage({event:"transmuxComplete",data:y},g)}}function s(T,y){y.data1&&T.push(y.data1.buffer),y.data2&&T.push(y.data2.buffer)}function f(T,y,g){y.forEach(function(v){m(T,v)}),T.postMessage({event:"flush",data:g})}},"./src/demux/transmuxer.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"default",function(){return t}),p.d(I,"isPromise",function(){return i}),p.d(I,"TransmuxConfig",function(){return n}),p.d(I,"TransmuxState",function(){return u});var g,b=p("./src/events.ts"),R=p("./src/errors.ts"),S=p("./src/crypt/decrypter.ts"),C=p("./src/demux/aacdemuxer.ts"),P=p("./src/demux/mp4demuxer.ts"),A=p("./src/demux/tsdemuxer.ts"),m=p("./src/demux/mp3demuxer.ts"),s=p("./src/remux/mp4-remuxer.ts"),f=p("./src/remux/passthrough-remuxer.ts"),c=p("./src/demux/chunk-cache.ts"),T=p("./src/utils/mp4-tools.ts"),y=p("./src/utils/logger.ts");try{g=self.performance.now.bind(self.performance)}catch(a){y.logger.debug("Unable to use Performance API on this environment"),g=self.Date.now}var v=[{demux:A.default,remux:s.default},{demux:P.default,remux:f.default},{demux:C.default,remux:s.default},{demux:m.default,remux:s.default}],r=1024;v.forEach(function(a){r=Math.max(r,a.demux.minProbeByteLength)});var t=function(){function a(l,h,L,O,E){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new c.default,this.observer=l,this.typeSupported=h,this.config=L,this.vendor=O,this.id=E}var o=a.prototype;return o.configure=function(h){this.transmuxConfig=h,this.decrypter&&this.decrypter.reset()},o.push=function(h,L,O,E){var x=this,D=O.transmuxing;D.executeStart=g();var M=new Uint8Array(h),F=this.cache,B=this.config,U=this.currentTransmuxState,k=this.transmuxConfig;E&&(this.currentTransmuxState=E);var N=function(a,o){var l=null;return a.byteLength>0&&null!=o&&null!=o.key&&null!==o.iv&&null!=o.method&&(l=o),l}(M,L);if(N&&"AES-128"===N.method){var K=this.getDecrypter();if(!B.enableSoftwareAES)return this.decryptionPromise=K.webCryptoDecrypt(M,N.key.buffer,N.iv.buffer).then(function(rt){var at=x.push(rt,null,O);return x.decryptionPromise=null,at}),this.decryptionPromise;var W=K.softwareDecrypt(M,N.key.buffer,N.iv.buffer);if(!W)return D.executeEnd=g(),d(O);M=new Uint8Array(W)}var w=E||U,H=w.contiguous,j=w.discontinuity,z=w.trackSwitch,J=w.accurateTimeOffset,X=w.timeOffset,Q=k.defaultInitPts;if((j||z)&&this.resetInitSegment(k.initSegmentData,k.audioCodec,k.videoCodec,k.duration),j&&this.resetInitialTimestamp(Q),H||this.resetContiguity(),this.needsProbing(M,j,z)){if(F.dataLength){var et=F.flush();M=Object(T.appendUint8Array)(et,M)}this.configureTransmuxer(M,k)}var Z=this.transmux(M,N,X,J,O),tt=this.currentTransmuxState;return tt.contiguous=!0,tt.discontinuity=!1,tt.trackSwitch=!1,D.executeEnd=g(),Z},o.flush=function(h){var L=this,O=h.transmuxing;O.executeStart=g();var E=this.decrypter,x=this.cache,D=this.currentTransmuxState,M=this.decryptionPromise;if(M)return M.then(function(){return L.flush(h)});var F=[],B=D.timeOffset;if(E){var U=E.flush();U&&F.push(this.push(U,null,h))}var k=x.dataLength;x.reset();var N=this.demuxer;if(!N||!this.remuxer)return k>=r&&this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),O.executeEnd=g(),[d(h)];var W=N.flush(B);return i(W)?W.then(function(w){return L.flushRemux(F,w,h),F}):(this.flushRemux(F,W,h),F)},o.flushRemux=function(h,L,O){var E=L.audioTrack,x=L.avcTrack,D=L.id3Track,M=L.textTrack,F=this.currentTransmuxState,B=F.accurateTimeOffset,U=F.timeOffset;y.logger.log("[transmuxer.ts]: Flushed fragment "+O.sn+(O.part>-1?" p: "+O.part:"")+" of level "+O.level);var k=this.remuxer.remux(E,x,D,M,U,B,!0,this.id);h.push({remuxResult:k,chunkMeta:O}),O.transmuxing.executeEnd=g()},o.resetInitialTimestamp=function(h){var L=this.demuxer,O=this.remuxer;!L||!O||(L.resetTimeStamp(h),O.resetTimeStamp(h))},o.resetContiguity=function(){var h=this.demuxer,L=this.remuxer;!h||!L||(h.resetContiguity(),L.resetNextTimestamp())},o.resetInitSegment=function(h,L,O,E){var x=this.demuxer,D=this.remuxer;!x||!D||(x.resetInitSegment(L,O,E),D.resetInitSegment(h,L,O))},o.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},o.transmux=function(h,L,O,E,x){return L&&"SAMPLE-AES"===L.method?this.transmuxSampleAes(h,L,O,E,x):this.transmuxUnencrypted(h,O,E,x)},o.transmuxUnencrypted=function(h,L,O,E){var x=this.demuxer.demux(h,L,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(x.audioTrack,x.avcTrack,x.id3Track,x.textTrack,L,O,!1,this.id),chunkMeta:E}},o.transmuxSampleAes=function(h,L,O,E,x){var D=this;return this.demuxer.demuxSampleAes(h,L,O).then(function(M){return{remuxResult:D.remuxer.remux(M.audioTrack,M.avcTrack,M.id3Track,M.textTrack,O,E,!1,D.id),chunkMeta:x}})},o.configureTransmuxer=function(h,L){for(var N,O=this.config,E=this.observer,x=this.typeSupported,D=this.vendor,M=L.audioCodec,F=L.defaultInitPts,B=L.duration,U=L.initSegmentData,k=L.videoCodec,K=0,W=v.length;K<W;K++)if(v[K].demux.probe(h)){N=v[K];break}N||(y.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),N={demux:P.default,remux:f.default});var w=this.demuxer,H=this.remuxer,j=N.remux,z=N.demux;(!H||!(H instanceof j))&&(this.remuxer=new j(E,O,x,D)),(!w||!(w instanceof z))&&(this.demuxer=new z(E,O,x),this.probe=z.probe),this.resetInitSegment(U,M,k,B),this.resetInitialTimestamp(F)},o.needsProbing=function(h,L,O){return!this.demuxer||!this.remuxer||L||O},o.getDecrypter=function(){var h=this.decrypter;return h||(h=this.decrypter=new S.default(this.observer,this.config)),h},a}();var d=function(o){return{remuxResult:{},chunkMeta:o}};function i(a){return"then"in a&&a.then instanceof Function}var n=function(o,l,h,L,O){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=o,this.videoCodec=l,this.initSegmentData=h,this.duration=L,this.defaultInitPts=O},u=function(o,l,h,L,O){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=o,this.contiguous=l,this.accurateTimeOffset=h,this.trackSwitch=L,this.timeOffset=O}},"./src/demux/tsdemuxer.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"discardEPB",function(){return d});var b=p("./src/demux/adts.ts"),R=p("./src/demux/mpegaudio.ts"),S=p("./src/demux/exp-golomb.ts"),C=p("./src/demux/id3.ts"),P=p("./src/demux/sample-aes.ts"),A=p("./src/events.ts"),m=p("./src/utils/mp4-tools.ts"),s=p("./src/utils/logger.ts"),f=p("./src/errors.ts"),c={video:1,audio:2,id3:3,text:4},T=function(){function i(u,a,o){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=u,this.config=a,this.typeSupported=o}i.probe=function(a){var o=i.syncOffset(a);return!(o<0||(o&&s.logger.warn("MPEG2-TS detected but first sync word found @ offset "+o+", junk ahead ?"),0))},i.syncOffset=function(a){for(var o=Math.min(1e3,a.length-564),l=0;l<o;){if(71===a[l]&&71===a[l+188]&&71===a[l+376])return l;l++}return-1},i.createTrack=function(a,o){return{container:"video"===a||"audio"===a?"video/mp2t":void 0,type:a,id:c[a],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===a?o:void 0}};var n=i.prototype;return n.resetInitSegment=function(a,o,l){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=i.createTrack("video",l),this._audioTrack=i.createTrack("audio",l),this._id3Track=i.createTrack("id3",l),this._txtTrack=i.createTrack("text",l),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=a,this.videoCodec=o,this._duration=l},n.resetTimeStamp=function(){},n.resetContiguity=function(){var a=this._audioTrack,o=this._avcTrack,l=this._id3Track;a&&(a.pesData=null),o&&(o.pesData=null),l&&(l.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},n.demux=function(a,o,l,h){void 0===l&&(l=!1),void 0===h&&(h=!1),l||(this.sampleAes=null);var L,O=this._avcTrack,E=this._audioTrack,x=this._id3Track,D=O.pid,M=O.pesData,F=E.pid,B=x.pid,U=E.pesData,k=x.pesData,N=!1,K=this.pmtParsed,W=this._pmtId,w=a.length;if(this.remainderData&&(w=(a=Object(m.appendUint8Array)(this.remainderData,a)).length,this.remainderData=null),w<188&&!h)return this.remainderData=a,{audioTrack:E,avcTrack:O,id3Track:x,textTrack:this._txtTrack};var H=Math.max(0,i.syncOffset(a));(w-=(w+H)%188)<a.byteLength&&!h&&(this.remainderData=new Uint8Array(a.buffer,w,a.buffer.byteLength-w));for(var j=H;j<w;j+=188)if(71===a[j]){var z=!!(64&a[j+1]),J=((31&a[j+1])<<8)+a[j+2],Y=void 0;if((48&a[j+3])>>4>1){if((Y=j+5+a[j+4])===j+188)continue}else Y=j+4;switch(J){case D:z&&(M&&(L=r(M))&&this.parseAVCPES(L,!1),M={data:[],size:0}),M&&(M.data.push(a.subarray(Y,j+188)),M.size+=j+188-Y);break;case F:z&&(U&&(L=r(U))&&(E.isAAC?this.parseAACPES(L):this.parseMPEGPES(L)),U={data:[],size:0}),U&&(U.data.push(a.subarray(Y,j+188)),U.size+=j+188-Y);break;case B:z&&(k&&(L=r(k))&&this.parseID3PES(L),k={data:[],size:0}),k&&(k.data.push(a.subarray(Y,j+188)),k.size+=j+188-Y);break;case 0:z&&(Y+=a[Y]+1),W=this._pmtId=g(a,Y);break;case W:z&&(Y+=a[Y]+1);var V=v(a,Y,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,l);(D=V.avc)>0&&(O.pid=D),(F=V.audio)>0&&(E.pid=F,E.isAAC=V.isAAC),(B=V.id3)>0&&(x.pid=B),N&&!K&&(s.logger.log("reparse from beginning"),N=!1,j=H-188),K=this.pmtParsed=!0;break;case 17:case 8191:break;default:N=!0}}else this.observer.emit(A.Events.ERROR,A.Events.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});O.pesData=M,E.pesData=U,x.pesData=k;var Q={audioTrack:E,avcTrack:O,id3Track:x,textTrack:this._txtTrack};return h&&this.extractRemainingSamples(Q),Q},n.flush=function(){var o,a=this.remainderData;return this.remainderData=null,o=a?this.demux(a,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(o),this.sampleAes?this.decrypt(o,this.sampleAes):o},n.extractRemainingSamples=function(a){var x,o=a.audioTrack,l=a.avcTrack,h=a.id3Track,L=l.pesData,O=o.pesData,E=h.pesData;L&&(x=r(L))?(this.parseAVCPES(x,!0),l.pesData=null):l.pesData=L,O&&(x=r(O))?(o.isAAC?this.parseAACPES(x):this.parseMPEGPES(x),o.pesData=null):(null!=O&&O.size&&s.logger.log("last AAC PES packet truncated,might overlap between fragments"),o.pesData=O),E&&(x=r(E))?(this.parseID3PES(x),h.pesData=null):h.pesData=E},n.demuxSampleAes=function(a,o,l){var h=this.demux(a,l,!0,!this.config.progressive),L=this.sampleAes=new P.default(this.observer,this.config,o);return this.decrypt(h,L)},n.decrypt=function(a,o){return new Promise(function(l){var h=a.audioTrack,L=a.avcTrack;h.samples&&h.isAAC?o.decryptAacSamples(h.samples,0,function(){L.samples?o.decryptAvcSamples(L.samples,0,0,function(){l(a)}):l(a)}):L.samples&&o.decryptAvcSamples(L.samples,0,0,function(){l(a)})})},n.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},n.parseAVCPES=function(a,o){var x,l=this,h=this._avcTrack,L=this.parseAVCNALu(a.data),E=this.avcSample,D=!1;a.data=null,E&&L.length&&!h.audFound&&(t(E,h),E=this.avcSample=y(!1,a.pts,a.dts,"")),L.forEach(function(M){switch(M.type){case 1:x=!0,E||(E=l.avcSample=y(!0,a.pts,a.dts,"")),E.frame=!0;var F=M.data;if(D&&F.length>4){var B=new S.default(F).readSliceType();(2===B||4===B||7===B||9===B)&&(E.key=!0)}break;case 5:x=!0,E||(E=l.avcSample=y(!0,a.pts,a.dts,"")),E.key=!0,E.frame=!0;break;case 6:x=!0;var U=new S.default(d(M.data));U.readUByte();for(var k=0,N=0,K=!1,W=0;!K&&U.bytesAvailable>1;){k=0;do{k+=W=U.readUByte()}while(255===W);N=0;do{N+=W=U.readUByte()}while(255===W);if(4===k&&0!==U.bytesAvailable){if(K=!0,181===U.readUByte()&&49===U.readUShort()&&1195456820===U.readUInt()&&3===U.readUByte()){for(var J=U.readUByte(),Y=31&J,V=[J,U.readUByte()],Q=0;Q<Y;Q++)V.push(U.readUByte()),V.push(U.readUByte()),V.push(U.readUByte());e(l._txtTrack.samples,{type:3,pts:a.pts,bytes:V})}}else if(5===k&&0!==U.bytesAvailable){if(K=!0,N>16){for(var q=[],$=0;$<16;$++)q.push(U.readUByte().toString(16)),(3===$||5===$||7===$||9===$)&&q.push("-");for(var et=N-16,Z=new Uint8Array(et),tt=0;tt<et;tt++)Z[tt]=U.readUByte();e(l._txtTrack.samples,{pts:a.pts,payloadType:k,uuid:q.join(""),userData:Object(C.utf8ArrayToStr)(Z),userDataBytes:Z})}}else if(N<U.bytesAvailable)for(var rt=0;rt<N;rt++)U.readUByte()}break;case 7:if(x=!0,D=!0,!h.sps){var nt=new S.default(M.data).readSPS();h.width=nt.width,h.height=nt.height,h.pixelRatio=nt.pixelRatio,h.sps=[M.data],h.duration=l._duration;for(var st=M.data.subarray(1,4),ut="avc1.",_=0;_<3;_++){var ot=st[_].toString(16);ot.length<2&&(ot="0"+ot),ut+=ot}h.codec=ut}break;case 8:x=!0,h.pps||(h.pps=[M.data]);break;case 9:x=!1,h.audFound=!0,E&&t(E,h),E=l.avcSample=y(!1,a.pts,a.dts,"");break;case 12:x=!1;break;default:x=!1,E&&(E.debug+="unknown NAL "+M.type+" ")}E&&x&&E.units.push(M)}),o&&E&&(t(E,h),this.avcSample=null)},n.getLastNalUnit=function(){var a,l,o=this.avcSample;if(!o||0===o.units.length){var h=this._avcTrack.samples;o=h[h.length-1]}if(null!==(a=o)&&void 0!==a&&a.units){var L=o.units;l=L[L.length-1]}return l},n.parseAVCNALu=function(a){var x,D,o=a.byteLength,l=this._avcTrack,h=l.naluState||0,L=h,O=[],E=0,F=-1,B=0;for(-1===h&&(F=0,B=31&a[0],h=0,E=1);E<o;)if(x=a[E++],h)if(1!==h)if(x)if(1===x){if(F>=0){var U={data:a.subarray(F,E-h-1),type:B};O.push(U)}else{var k=this.getLastNalUnit();if(k&&(L&&E<=4-L&&k.state&&(k.data=k.data.subarray(0,k.data.byteLength-L)),(D=E-h-1)>0)){var N=new Uint8Array(k.data.byteLength+D);N.set(k.data,0),N.set(a.subarray(0,D),k.data.byteLength),k.data=N}}E<o?(F=E,B=31&a[E],h=0):h=-1}else h=0;else h=3;else h=x?0:2;else h=x?0:1;if(F>=0&&h>=0){var K={data:a.subarray(F,o),type:B,state:h};O.push(K)}if(0===O.length){var W=this.getLastNalUnit();if(W){var w=new Uint8Array(W.data.byteLength+a.byteLength);w.set(W.data,0),w.set(a,W.data.byteLength),W.data=w}}return l.naluState=h,O},n.parseAACPES=function(a){var D,M,F,B,U,o=0,l=this._audioTrack,h=this.aacOverFlow,L=a.data;if(h){this.aacOverFlow=null;var O=h.sample.unit.byteLength,E=Math.min(h.missing,O),x=O-E;h.sample.unit.set(L.subarray(0,E),x),l.samples.push(h.sample),o=h.missing}for(D=o,M=L.length;D<M-1&&!b.isHeader(L,D);D++);if(D===o||(D<M-1?(F="AAC PES did not start with ADTS header,offset:"+D,B=!1):(F="no ADTS header found in AAC PES",B=!0),s.logger.warn("parsing error:"+F),this.observer.emit(A.Events.ERROR,A.Events.ERROR,{type:f.ErrorTypes.MEDIA_ERROR,details:f.ErrorDetails.FRAG_PARSING_ERROR,fatal:B,reason:F}),!B)){if(b.initTrackConfig(l,this.observer,L,D,this.audioCodec),void 0!==a.pts)U=a.pts;else{if(!h)return void s.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var k=b.getFrameDuration(l.samplerate);U=h.sample.pts+k}for(var N=0;D<M;){if(b.isHeader(L,D)){if(D+5<M){var K=b.appendFrame(l,L,D,U,N);if(K){if(!K.missing){D+=K.length,N++;continue}this.aacOverFlow=K}}break}D++}}},n.parseMPEGPES=function(a){var o=a.data,l=o.length,h=0,L=0,O=a.pts;if(void 0!==O)for(;L<l;)if(R.isHeader(o,L)){var E=R.appendFrame(this._audioTrack,o,L,O,h);if(!E)break;L+=E.length,h++}else L++;else s.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},n.parseID3PES=function(a){void 0!==a.pts?this._id3Track.samples.push(a):s.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},i}();function y(i,n,u,a){return{key:i,frame:!1,pts:n,dts:u,units:[],debug:a,length:0}}function g(i,n){return(31&i[n+10])<<8|i[n+11]}function v(i,n,u,a){var o={audio:-1,avc:-1,id3:-1,isAAC:!0},h=n+3+((15&i[n+1])<<8|i[n+2])-4;for(n+=12+((15&i[n+10])<<8|i[n+11]);n<h;){var O=(31&i[n+1])<<8|i[n+2];switch(i[n]){case 207:if(!a){s.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===o.audio&&(o.audio=O);break;case 21:-1===o.id3&&(o.id3=O);break;case 219:if(!a){s.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===o.avc&&(o.avc=O);break;case 3:case 4:u?-1===o.audio&&(o.audio=O,o.isAAC=!1):s.logger.log("MPEG audio found, not supported in this browser");break;case 36:s.logger.warn("Unsupported HEVC stream type found")}n+=5+((15&i[n+3])<<8|i[n+4])}return o}function r(i){var u,a,o,l,h,n=0,L=i.data;if(!i||0===i.size)return null;for(;L[0].length<19&&L.length>1;){var O=new Uint8Array(L[0].length+L[1].length);O.set(L[0]),O.set(L[1],L[0].length),L[0]=O,L.splice(1,1)}if(1===((u=L[0])[0]<<16)+(u[1]<<8)+u[2]){if((a=(u[4]<<8)+u[5])&&a>i.size-6)return null;var x=u[7];192&x&&(l=536870912*(14&u[9])+4194304*(255&u[10])+16384*(254&u[11])+128*(255&u[12])+(254&u[13])/2,64&x?l-(h=536870912*(14&u[14])+4194304*(255&u[15])+16384*(254&u[16])+128*(255&u[17])+(254&u[18])/2)>54e5&&(s.logger.warn(Math.round((l-h)/9e4)+"s delta between PTS and DTS, align them"),l=h):h=l);var D=(o=u[8])+9;if(i.size<=D)return null;i.size-=D;for(var M=new Uint8Array(i.size),F=0,B=L.length;F<B;F++){var U=(u=L[F]).byteLength;if(D){if(D>U){D-=U;continue}u=u.subarray(D),U-=D,D=0}M.set(u,n),n+=U}return a&&(a-=o+3),{data:M,pts:l,dts:h,len:a}}return null}function t(i,n){if(i.units.length&&i.frame){if(void 0===i.pts){var u=n.samples,a=u.length;if(!a)return void n.dropped++;var o=u[a-1];i.pts=o.pts,i.dts=o.dts}n.samples.push(i)}i.debug.length&&s.logger.log(i.pts+"/"+i.dts+":"+i.debug)}function e(i,n){var u=i.length;if(u>0){if(n.pts>=i[u-1].pts)i.push(n);else for(var a=u-1;a>=0;a--)if(n.pts<i[a].pts){i.splice(a,0,n);break}}else i.push(n)}function d(i){for(var n=i.byteLength,u=[],a=1;a<n-2;)0===i[a]&&0===i[a+1]&&3===i[a+2]?(u.push(a+2),a+=2):a++;if(0===u.length)return i;var o=n-u.length,l=new Uint8Array(o),h=0;for(a=0;a<o;h++,a++)h===u[0]&&(h++,u.shift()),l[a]=i[h];return l}T.minProbeByteLength=188,I.default=T},"./src/empty.js":function(G,I){G.exports=void 0},"./src/errors.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"ErrorTypes",function(){return b}),p.d(I,"ErrorDetails",function(){return R});var b=(()=>{return(S=b||(b={})).NETWORK_ERROR="networkError",S.MEDIA_ERROR="mediaError",S.KEY_SYSTEM_ERROR="keySystemError",S.MUX_ERROR="muxError",S.OTHER_ERROR="otherError",b;var S})(),R=(()=>{return(S=R||(R={})).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",S.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",S.KEY_SYSTEM_NO_SESSION="keySystemNoSession",S.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",S.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",S.MANIFEST_LOAD_ERROR="manifestLoadError",S.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",S.MANIFEST_PARSING_ERROR="manifestParsingError",S.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",S.LEVEL_EMPTY_ERROR="levelEmptyError",S.LEVEL_LOAD_ERROR="levelLoadError",S.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",S.LEVEL_SWITCH_ERROR="levelSwitchError",S.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",S.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",S.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",S.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",S.FRAG_LOAD_ERROR="fragLoadError",S.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",S.FRAG_DECRYPT_ERROR="fragDecryptError",S.FRAG_PARSING_ERROR="fragParsingError",S.REMUX_ALLOC_ERROR="remuxAllocError",S.KEY_LOAD_ERROR="keyLoadError",S.KEY_LOAD_TIMEOUT="keyLoadTimeOut",S.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",S.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",S.BUFFER_APPEND_ERROR="bufferAppendError",S.BUFFER_APPENDING_ERROR="bufferAppendingError",S.BUFFER_STALLED_ERROR="bufferStalledError",S.BUFFER_FULL_ERROR="bufferFullError",S.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",S.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",S.INTERNAL_EXCEPTION="internalException",S.INTERNAL_ABORTED="aborted",S.UNKNOWN="unknown",R;var S})()},"./src/events.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"Events",function(){return b});var b=(()=>{return(R=b||(b={})).MEDIA_ATTACHING="hlsMediaAttaching",R.MEDIA_ATTACHED="hlsMediaAttached",R.MEDIA_DETACHING="hlsMediaDetaching",R.MEDIA_DETACHED="hlsMediaDetached",R.BUFFER_RESET="hlsBufferReset",R.BUFFER_CODECS="hlsBufferCodecs",R.BUFFER_CREATED="hlsBufferCreated",R.BUFFER_APPENDING="hlsBufferAppending",R.BUFFER_APPENDED="hlsBufferAppended",R.BUFFER_EOS="hlsBufferEos",R.BUFFER_FLUSHING="hlsBufferFlushing",R.BUFFER_FLUSHED="hlsBufferFlushed",R.MANIFEST_LOADING="hlsManifestLoading",R.MANIFEST_LOADED="hlsManifestLoaded",R.MANIFEST_PARSED="hlsManifestParsed",R.LEVEL_SWITCHING="hlsLevelSwitching",R.LEVEL_SWITCHED="hlsLevelSwitched",R.LEVEL_LOADING="hlsLevelLoading",R.LEVEL_LOADED="hlsLevelLoaded",R.LEVEL_UPDATED="hlsLevelUpdated",R.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",R.LEVELS_UPDATED="hlsLevelsUpdated",R.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",R.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",R.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",R.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",R.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",R.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",R.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",R.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",R.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",R.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",R.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",R.CUES_PARSED="hlsCuesParsed",R.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",R.INIT_PTS_FOUND="hlsInitPtsFound",R.FRAG_LOADING="hlsFragLoading",R.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",R.FRAG_LOADED="hlsFragLoaded",R.FRAG_DECRYPTED="hlsFragDecrypted",R.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",R.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",R.FRAG_PARSING_METADATA="hlsFragParsingMetadata",R.FRAG_PARSED="hlsFragParsed",R.FRAG_BUFFERED="hlsFragBuffered",R.FRAG_CHANGED="hlsFragChanged",R.FPS_DROP="hlsFpsDrop",R.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",R.ERROR="hlsError",R.DESTROYING="hlsDestroying",R.KEY_LOADING="hlsKeyLoading",R.KEY_LOADED="hlsKeyLoaded",R.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",R.BACK_BUFFER_REACHED="hlsBackBufferReached",b;var R})()},"./src/hls.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"default",function(){return i});var b=p("./node_modules/url-toolkit/src/url-toolkit.js"),S=p("./src/loader/playlist-loader.ts"),C=p("./src/loader/key-loader.ts"),P=p("./src/controller/id3-track-controller.ts"),A=p("./src/controller/latency-controller.ts"),m=p("./src/controller/level-controller.ts"),s=p("./src/controller/fragment-tracker.ts"),f=p("./src/controller/stream-controller.ts"),c=p("./src/is-supported.ts"),T=p("./src/utils/logger.ts"),y=p("./src/config.ts"),g=p("./node_modules/eventemitter3/index.js"),r=p("./src/events.ts"),t=p("./src/errors.ts");function e(n,u){for(var a=0;a<u.length;a++){var o=u[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}var i=function(){function n(a){void 0===a&&(a={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new g.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var o=this.config=Object(y.mergeConfig)(n.DefaultConfig,a);this.userConfig=a,Object(T.enableLogs)(o.debug),this._autoLevelCapping=-1,o.progressive&&Object(y.enableStreamingMode)(o);var h=o.bufferController,L=o.capLevelController,O=o.fpsController,E=this.abrController=new(0,o.abrController)(this),x=this.bufferController=new h(this),D=this.capLevelController=new L(this),M=new O(this),F=new S.default(this),B=new C.default(this),U=new P.default(this),k=this.levelController=new m.default(this),N=new s.FragmentTracker(this),K=this.streamController=new f.default(this,N);D.setStreamController(K),M.setStreamController(K);var W=[k,K];this.networkControllers=W;var w=[F,B,E,x,D,M,U,N];this.audioTrackController=this.createController(o.audioTrackController,null,W),this.createController(o.audioStreamController,N,W),this.subtitleTrackController=this.createController(o.subtitleTrackController,null,W),this.createController(o.subtitleStreamController,N,W),this.createController(o.timelineController,null,w),this.emeController=this.createController(o.emeController,null,w),this.latencyController=this.createController(A.default,null,w),this.coreComponents=w}n.isSupported=function(){return Object(c.isSupported)()};var u=n.prototype;return u.createController=function(o,l,h){if(o){var L=l?new o(this,l):new o(this);return h&&h.push(L),L}return null},u.on=function(o,l,h){void 0===h&&(h=this),this._emitter.on(o,l,h)},u.once=function(o,l,h){void 0===h&&(h=this),this._emitter.once(o,l,h)},u.removeAllListeners=function(o){this._emitter.removeAllListeners(o)},u.off=function(o,l,h,L){void 0===h&&(h=this),this._emitter.off(o,l,h,L)},u.listeners=function(o){return this._emitter.listeners(o)},u.emit=function(o,l,h){return this._emitter.emit(o,l,h)},u.trigger=function(o,l){if(this.config.debug)return this.emit(o,o,l);try{return this.emit(o,o,l)}catch(h){T.logger.error("An internal error happened while handling event "+o+'. Error message: "'+h.message+'". Here is a stacktrace:',h),this.trigger(r.Events.ERROR,{type:t.ErrorTypes.OTHER_ERROR,details:t.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:o,error:h})}return!1},u.listenerCount=function(o){return this._emitter.listenerCount(o)},u.destroy=function(){T.logger.log("destroy"),this.trigger(r.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(o){return o.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(o){return o.destroy()}),this.coreComponents.length=0},u.attachMedia=function(o){T.logger.log("attachMedia"),this._media=o,this.trigger(r.Events.MEDIA_ATTACHING,{media:o})},u.detachMedia=function(){T.logger.log("detachMedia"),this.trigger(r.Events.MEDIA_DETACHING,void 0),this._media=null},u.loadSource=function(o){this.stopLoad();var l=this.media,h=this.url,L=this.url=b.buildAbsoluteURL(self.location.href,o,{alwaysNormalize:!0});T.logger.log("loadSource:"+L),l&&h&&h!==L&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(l)),this.trigger(r.Events.MANIFEST_LOADING,{url:o})},u.startLoad=function(o){void 0===o&&(o=-1),T.logger.log("startLoad("+o+")"),this.networkControllers.forEach(function(l){l.startLoad(o)})},u.stopLoad=function(){T.logger.log("stopLoad"),this.networkControllers.forEach(function(o){o.stopLoad()})},u.swapAudioCodec=function(){T.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},u.recoverMediaError=function(){T.logger.log("recoverMediaError");var o=this._media;this.detachMedia(),o&&this.attachMedia(o)},u.removeLevel=function(o,l){void 0===l&&(l=0),this.levelController.removeLevel(o,l)},function(n,u,a){u&&e(n.prototype,u),a&&e(n,a)}(n,[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(o){T.logger.log("set currentLevel:"+o),this.loadLevel=o,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(o){T.logger.log("set nextLevel:"+o),this.levelController.manualLevel=o,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(o){T.logger.log("set loadLevel:"+o),this.levelController.manualLevel=o}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(o){this.levelController.nextLoadLevel=o}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(o){T.logger.log("set firstLevel:"+o),this.levelController.firstLevel=o}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(o){T.logger.log("set startLevel:"+o),-1!==o&&(o=Math.max(o,this.minAutoLevel)),this.levelController.startLevel=o}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(o){var l=!!o;l!==this.config.capLevelToPlayerSize&&(l?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=l)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(o){this._autoLevelCapping!==o&&(T.logger.log("set autoLevelCapping:"+o),this._autoLevelCapping=o)}},{key:"bandwidthEstimate",get:function(){var o=this.abrController.bwEstimator;return o?o.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var o=this.levels,l=this.config.minAutoBitrate;if(!o)return 0;for(var h=o.length,L=0;L<h;L++)if(o[L].maxBitrate>l)return L;return 0}},{key:"maxAutoLevel",get:function(){var o=this.levels,l=this.autoLevelCapping;return-1===l&&o&&o.length?o.length-1:l}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(o){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,o)}},{key:"audioTracks",get:function(){var o=this.audioTrackController;return o?o.audioTracks:[]}},{key:"audioTrack",get:function(){var o=this.audioTrackController;return o?o.audioTrack:-1},set:function(o){var l=this.audioTrackController;l&&(l.audioTrack=o)}},{key:"subtitleTracks",get:function(){var o=this.subtitleTrackController;return o?o.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var o=this.subtitleTrackController;return o?o.subtitleTrack:-1},set:function(o){var l=this.subtitleTrackController;l&&(l.subtitleTrack=o)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var o=this.subtitleTrackController;return!!o&&o.subtitleDisplay},set:function(o){var l=this.subtitleTrackController;l&&(l.subtitleDisplay=o)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(o){this.config.lowLatencyMode=o}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.0.10"}},{key:"Events",get:function(){return r.Events}},{key:"ErrorTypes",get:function(){return t.ErrorTypes}},{key:"ErrorDetails",get:function(){return t.ErrorDetails}},{key:"DefaultConfig",get:function(){return n.defaultConfig?n.defaultConfig:y.hlsDefaultConfig},set:function(o){n.defaultConfig=o}}]),n}();i.defaultConfig=void 0},"./src/is-supported.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"isSupported",function(){return S}),p.d(I,"changeTypeSupported",function(){return C});var b=p("./src/utils/mediasource-helper.ts");function R(){return self.SourceBuffer||self.WebKitSourceBuffer}function S(){var P=Object(b.getMediaSource)();if(!P)return!1;var A=R();return!(!P||"function"!=typeof P.isTypeSupported||!P.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')||A&&(!A.prototype||"function"!=typeof A.prototype.appendBuffer||"function"!=typeof A.prototype.remove))}function C(){var P,A=R();return"function"==typeof(null==A||null===(P=A.prototype)||void 0===P?void 0:P.changeType)}},"./src/loader/fragment-loader.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"default",function(){return T}),p.d(I,"LoadError",function(){return g});var b=p("./src/polyfills/number.ts"),R=p("./src/errors.ts");function C(v){var r="function"==typeof Map?new Map:void 0;return(C=function(e){if(null===e||!function(v){return-1!==Function.toString.call(v).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==r){if(r.has(e))return r.get(e);r.set(e,d)}function d(){return P(e,arguments,f(this).constructor)}return d.prototype=Object.create(e.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),s(d,e)})(v)}function P(v,r,t){return(P=A()?Reflect.construct:function(d,i,n){var u=[null];u.push.apply(u,i);var o=new(Function.bind.apply(d,u));return n&&s(o,n.prototype),o}).apply(null,arguments)}function A(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(v){return!1}}function s(v,r){return(s=Object.setPrototypeOf||function(e,d){return e.__proto__=d,e})(v,r)}function f(v){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(v)}var c=Math.pow(2,17),T=function(){function v(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}var r=v.prototype;return r.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},r.abort=function(){this.loader&&this.loader.abort()},r.load=function(e,d){var i=this,n=e.url;if(!n)return Promise.reject(new g({type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,networkDetails:null},"Fragment does not have a "+(n?"part list":"url")));this.abort();var u=this.config,a=u.fLoader,o=u.loader;return new Promise(function(l,h){i.loader&&i.loader.destroy();var L=i.loader=e.loader=a?new a(u):new o(u),O=y(e),E={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:c};e.stats=L.stats,L.load(O,E,{onSuccess:function(D,M,F,B){i.resetLoader(e,L),l({frag:e,part:null,payload:D.data,networkDetails:B})},onError:function(D,M,F){i.resetLoader(e,L),h(new g({type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:D,networkDetails:F}))},onAbort:function(D,M,F){i.resetLoader(e,L),h(new g({type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,networkDetails:F}))},onTimeout:function(D,M,F){i.resetLoader(e,L),h(new g({type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,networkDetails:F}))},onProgress:function(D,M,F,B){d&&d({frag:e,part:null,payload:F,networkDetails:B})}})})},r.loadPart=function(e,d,i){var n=this;this.abort();var u=this.config,a=u.fLoader,o=u.loader;return new Promise(function(l,h){n.loader&&n.loader.destroy();var L=n.loader=e.loader=a?new a(u):new o(u),O=y(e,d),E={timeout:u.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:u.fragLoadingMaxRetryTimeout,highWaterMark:c};d.stats=L.stats,L.load(O,E,{onSuccess:function(D,M,F,B){n.resetLoader(e,L),n.updateStatsFromPart(e,d);var U={frag:e,part:d,payload:D.data,networkDetails:B};i(U),l(U)},onError:function(D,M,F){n.resetLoader(e,L),h(new g({type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:d,response:D,networkDetails:F}))},onAbort:function(D,M,F){e.stats.aborted=d.stats.aborted,n.resetLoader(e,L),h(new g({type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:e,part:d,networkDetails:F}))},onTimeout:function(D,M,F){n.resetLoader(e,L),h(new g({type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:d,networkDetails:F}))}})})},r.updateStatsFromPart=function(e,d){var i=e.stats,n=d.stats,u=n.total;if(i.loaded+=n.loaded,u){var a=Math.round(e.duration/d.duration),o=Math.min(Math.round(i.loaded/u),a),h=(a-o)*Math.round(i.loaded/o);i.total=i.loaded+h}else i.total=Math.max(i.loaded,i.total);var L=i.loading,O=n.loading;L.start?L.first+=O.first-O.start:(L.start=O.start,L.first=O.first),L.end=O.end},r.resetLoader=function(e,d){e.loader=null,this.loader===d&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),d.destroy()},v}();function y(v,r){void 0===r&&(r=null);var t=r||v,e={frag:v,part:r,responseType:"arraybuffer",url:t.url,rangeStart:0,rangeEnd:0},d=t.byteRangeStartOffset,i=t.byteRangeEndOffset;return Object(b.isFiniteNumber)(d)&&Object(b.isFiniteNumber)(i)&&(e.rangeStart=d,e.rangeEnd=i),e}var g=function(v){function r(t){for(var e,d=arguments.length,i=new Array(d>1?d-1:0),n=1;n<d;n++)i[n-1]=arguments[n];return(e=v.call.apply(v,[this].concat(i))||this).data=void 0,e.data=t,e}return function(v,r){v.prototype=Object.create(r.prototype),v.prototype.constructor=v,s(v,r)}(r,v),r}(C(Error))},"./src/loader/fragment.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"ElementaryStreamTypes",function(){return T}),p.d(I,"BaseSegment",function(){return y}),p.d(I,"Fragment",function(){return g}),p.d(I,"Part",function(){return v});var b=p("./src/polyfills/number.ts"),R=p("./node_modules/url-toolkit/src/url-toolkit.js"),C=p("./src/utils/logger.ts"),P=p("./src/loader/level-key.ts"),A=p("./src/loader/load-stats.ts");function m(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r,s(r,t)}function s(r,t){return(s=Object.setPrototypeOf||function(d,i){return d.__proto__=i,d})(r,t)}function f(r,t){for(var e=0;e<t.length;e++){var d=t[e];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(r,d.key,d)}}function c(r,t,e){return t&&f(r.prototype,t),e&&f(r,e),r}var T=(()=>{return(r=T||(T={})).AUDIO="audio",r.VIDEO="video",r.AUDIOVIDEO="audiovideo",T;var r})(),y=function(){function r(e){var d;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((d={})[T.AUDIO]=null,d[T.VIDEO]=null,d[T.AUDIOVIDEO]=null,d),this.baseurl=e}return r.prototype.setByteRange=function(d,i){var n=d.split("@",2),u=[];u[0]=1===n.length?i?i.byteRangeEndOffset:0:parseInt(n[1]),u[1]=parseInt(n[0])+u[0],this._byteRange=u},c(r,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(R.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(d){this._url=d}}]),r}(),g=function(r){function t(d,i){var n;return(n=r.call(this,i)||this)._decryptdata=null,n.rawProgramDateTime=null,n.programDateTime=null,n.tagList=[],n.duration=0,n.sn=0,n.levelkey=void 0,n.type=void 0,n.loader=null,n.level=-1,n.cc=0,n.startPTS=void 0,n.endPTS=void 0,n.appendedPTS=void 0,n.startDTS=void 0,n.endDTS=void 0,n.start=0,n.deltaPTS=void 0,n.maxStartPTS=void 0,n.minEndPTS=void 0,n.stats=new A.LoadStats,n.urlId=0,n.data=void 0,n.bitrateTest=!1,n.title=null,n.initSegment=null,n.type=d,n}m(t,r);var e=t.prototype;return e.createInitializationVector=function(i){for(var n=new Uint8Array(16),u=12;u<16;u++)n[u]=i>>8*(15-u)&255;return n},e.setDecryptDataFromLevelKey=function(i,n){var u=i;return"AES-128"===(null==i?void 0:i.method)&&i.uri&&!i.iv&&((u=P.LevelKey.fromURI(i.uri)).method=i.method,u.iv=this.createInitializationVector(n),u.keyFormat="identity"),u},e.setElementaryStreamInfo=function(i,n,u,a,o,l){void 0===l&&(l=!1);var h=this.elementaryStreams,L=h[i];L?(L.startPTS=Math.min(L.startPTS,n),L.endPTS=Math.max(L.endPTS,u),L.startDTS=Math.min(L.startDTS,a),L.endDTS=Math.max(L.endDTS,o)):h[i]={startPTS:n,endPTS:u,startDTS:a,endDTS:o,partial:l}},e.clearElementaryStreamInfo=function(){var i=this.elementaryStreams;i[T.AUDIO]=null,i[T.VIDEO]=null,i[T.AUDIOVIDEO]=null},c(t,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var i=this.sn;"number"!=typeof i&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&C.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),i=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,i)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime||!Object(b.isFiniteNumber)(this.programDateTime))return null;var i=Object(b.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*i}},{key:"encrypted",get:function(){var i;return!(null===(i=this.decryptdata)||void 0===i||!i.keyFormat||!this.decryptdata.uri)}}]),t}(y),v=function(r){function t(e,d,i,n,u){var a;(a=r.call(this,i)||this).fragOffset=0,a.duration=0,a.gap=!1,a.independent=!1,a.relurl=void 0,a.fragment=void 0,a.index=void 0,a.stats=new A.LoadStats,a.duration=e.decimalFloatingPoint("DURATION"),a.gap=e.bool("GAP"),a.independent=e.bool("INDEPENDENT"),a.relurl=e.enumeratedString("URI"),a.fragment=d,a.index=n;var o=e.enumeratedString("BYTERANGE");return o&&a.setByteRange(o,u),u&&(a.fragOffset=u.fragOffset+u.duration),a}return m(t,r),c(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var d=this.elementaryStreams;return!!(d.audio||d.video||d.audiovideo)}}]),t}(y)},"./src/loader/key-loader.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"default",function(){return C});var b=p("./src/events.ts"),R=p("./src/errors.ts"),S=p("./src/utils/logger.ts"),C=function(){function P(m){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=m,this._registerListeners()}var A=P.prototype;return A._registerListeners=function(){this.hls.on(b.Events.KEY_LOADING,this.onKeyLoading,this)},A._unregisterListeners=function(){this.hls.off(b.Events.KEY_LOADING,this.onKeyLoading)},A.destroy=function(){for(var s in this._unregisterListeners(),this.loaders){var f=this.loaders[s];f&&f.destroy()}this.loaders={}},A.onKeyLoading=function(s,f){var c=f.frag,T=c.type,y=this.loaders[T];if(c.decryptdata){var g=c.decryptdata.uri;if(g!==this.decrypturl||null===this.decryptkey){var v=this.hls.config;if(y&&(S.logger.warn("abort previous key loader for type:"+T),y.abort()),!g)return void S.logger.warn("key uri is falsy");var t=c.loader=this.loaders[T]=new(0,v.loader)(v);this.decrypturl=g,this.decryptkey=null;var e={url:g,frag:c,responseType:"arraybuffer"},d={timeout:v.fragLoadingTimeOut,maxRetry:0,retryDelay:v.fragLoadingRetryDelay,maxRetryDelay:v.fragLoadingMaxRetryTimeout,highWaterMark:0},i={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};t.load(e,d,i)}else this.decryptkey&&(c.decryptdata.key=this.decryptkey,this.hls.trigger(b.Events.KEY_LOADED,{frag:c}))}else S.logger.warn("Missing decryption data on fragment in onKeyLoading")},A.loadsuccess=function(s,f,c){var T=c.frag;T.decryptdata?(this.decryptkey=T.decryptdata.key=new Uint8Array(s.data),T.loader=null,delete this.loaders[T.type],this.hls.trigger(b.Events.KEY_LOADED,{frag:T})):S.logger.error("after key load, decryptdata unset")},A.loaderror=function(s,f){var c=f.frag,T=c.loader;T&&T.abort(),delete this.loaders[c.type],this.hls.trigger(b.Events.ERROR,{type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:c,response:s})},A.loadtimeout=function(s,f){var c=f.frag,T=c.loader;T&&T.abort(),delete this.loaders[c.type],this.hls.trigger(b.Events.ERROR,{type:R.ErrorTypes.NETWORK_ERROR,details:R.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:c})},P}()},"./src/loader/level-details.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"LevelDetails",function(){return P});var b=p("./src/polyfills/number.ts");function R(A,m){for(var s=0;s<m.length;s++){var f=m[s];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(A,f.key,f)}}var P=function(){function A(s){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=s}return A.prototype.reloaded=function(f){if(!f)return this.advanced=!0,void(this.updated=!0);var c=this.lastPartSn-f.lastPartSn,T=this.lastPartIndex-f.lastPartIndex;this.updated=this.endSN!==f.endSN||!!T||!!c,this.advanced=this.endSN>f.endSN||c>0||0===c&&T>0,this.misses=this.updated||this.advanced?Math.floor(.6*f.misses):f.misses+1,this.availabilityDelay=f.availabilityDelay},function(A,m,s){m&&R(A.prototype,m),s&&R(A,s)}(A,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(b.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var f=this.driftEndTime-this.driftStartTime;return f>0?1e3*(this.driftEnd-this.driftStart)/f:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var f;return null!==(f=this.partList)&&void 0!==f&&f.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var f;return null!==(f=this.fragments)&&void 0!==f&&f.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var f;return null!==(f=this.partList)&&void 0!==f&&f.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var f;return null!==(f=this.partList)&&void 0!==f&&f.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),A}()},"./src/loader/level-key.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"LevelKey",function(){return P});var b=p("./node_modules/url-toolkit/src/url-toolkit.js");function S(A,m){for(var s=0;s<m.length;s++){var f=m[s];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(A,f.key,f)}}var P=function(){function A(m,s){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=s?Object(b.buildAbsoluteURL)(m,s,{alwaysNormalize:!0}):m}return A.fromURL=function(s,f){return new A(s,f)},A.fromURI=function(s){return new A(s)},function(A,m,s){m&&S(A.prototype,m),s&&S(A,s)}(A,[{key:"uri",get:function(){return this._uri}}]),A}()},"./src/loader/load-stats.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"LoadStats",function(){return b});var b=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"default",function(){return t});var b=p("./src/polyfills/number.ts"),R=p("./node_modules/url-toolkit/src/url-toolkit.js"),C=p("./src/loader/fragment.ts"),P=p("./src/loader/level-details.ts"),A=p("./src/loader/level-key.ts"),m=p("./src/utils/attr-list.ts"),s=p("./src/utils/logger.ts"),f=p("./src/utils/codecs.ts"),c=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,T=/#EXT-X-MEDIA:(.*)/g,y=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),g=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),v=/\.(mp4|m4s|m4v|m4a)$/i;var t=function(){function u(){}return u.findGroup=function(o,l){for(var h=0;h<o.length;h++){var L=o[h];if(L.id===l)return L}},u.convertAVC1ToAVCOTI=function(o){var l=o.split(".");if(l.length>2){var h=l.shift()+".";return(h+=parseInt(l.shift()).toString(16))+("000"+parseInt(l.shift()).toString(16)).substr(-4)}return o},u.resolve=function(o,l){return R.buildAbsoluteURL(l,o,{alwaysNormalize:!0})},u.parseMasterPlaylist=function(o,l){var E,h=[],L={},O=!1;for(c.lastIndex=0;null!=(E=c.exec(o));)if(E[1]){var x=new m.AttrList(E[1]),D={attrs:x,bitrate:x.decimalInteger("AVERAGE-BANDWIDTH")||x.decimalInteger("BANDWIDTH"),name:x.NAME,url:u.resolve(E[2],l)},M=x.decimalResolution("RESOLUTION");M&&(D.width=M.width,D.height=M.height),e((x.CODECS||"").split(/[ ,]+/).filter(function(B){return B}),D),D.videoCodec&&-1!==D.videoCodec.indexOf("avc1")&&(D.videoCodec=u.convertAVC1ToAVCOTI(D.videoCodec)),h.push(D)}else if(E[3]){var F=new m.AttrList(E[3]);F["DATA-ID"]&&(O=!0,L[F["DATA-ID"]]=F)}return{levels:h,sessionData:O?L:null}},u.parseMasterPlaylistMedia=function(o,l,h,L){void 0===L&&(L=[]);var O,E=[],x=0;for(T.lastIndex=0;null!==(O=T.exec(o));){var D=new m.AttrList(O[1]);if(D.TYPE===h){var M={attrs:D,bitrate:0,id:x++,groupId:D["GROUP-ID"],instreamId:D["INSTREAM-ID"],name:D.NAME||D.LANGUAGE||"",type:h,default:D.bool("DEFAULT"),autoselect:D.bool("AUTOSELECT"),forced:D.bool("FORCED"),lang:D.LANGUAGE,url:D.URI?u.resolve(D.URI,l):""};if(L.length){var F=u.findGroup(L,M.groupId)||L[0];d(M,F,"audioCodec"),d(M,F,"textCodec")}E.push(M)}}return E},u.parseLevelPlaylist=function(o,l,h,L,O){var K,W,w,E=new P.LevelDetails(l),x=E.fragments,D=null,M=0,F=0,B=0,U=0,k=null,N=new C.Fragment(L,l),H=-1,j=!1;for(y.lastIndex=0,E.m3u8=o;null!==(K=y.exec(o));){j&&(j=!1,(N=new C.Fragment(L,l)).start=B,N.sn=M,N.cc=U,N.level=h,D&&(N.initSegment=D,N.rawProgramDateTime=D.rawProgramDateTime));var z=K[1];if(z){N.duration=parseFloat(z);var J=(" "+K[2]).slice(1);N.title=J||null,N.tagList.push(J?["INF",z,J]:["INF",z])}else if(K[3])Object(b.isFiniteNumber)(N.duration)&&(N.start=B,w&&(N.levelkey=w),N.sn=M,N.level=h,N.cc=U,N.urlId=O,x.push(N),N.relurl=(" "+K[3]).slice(1),n(N,k),k=N,B+=N.duration,M++,F=0,j=!0);else if(K[4]){var X=(" "+K[4]).slice(1);k?N.setByteRange(X,k):N.setByteRange(X)}else if(K[5])N.rawProgramDateTime=(" "+K[5]).slice(1),N.tagList.push(["PROGRAM-DATE-TIME",N.rawProgramDateTime]),-1===H&&(H=x.length);else{if(!(K=K[0].match(g))){s.logger.warn("No matches on slow regex match for level playlist!");continue}for(W=1;W<K.length&&void 0===K[W];W++);var Y=(" "+K[W]).slice(1),V=(" "+K[W+1]).slice(1),Q=K[W+2]?(" "+K[W+2]).slice(1):"";switch(Y){case"PLAYLIST-TYPE":E.type=V.toUpperCase();break;case"MEDIA-SEQUENCE":M=E.startSN=parseInt(V);break;case"SKIP":var q=new m.AttrList(V),$=q.decimalInteger("SKIPPED-SEGMENTS");if(Object(b.isFiniteNumber)($)){E.skippedSegments=$;for(var et=$;et--;)x.unshift(null);M+=$}var Z=q.enumeratedString("RECENTLY-REMOVED-DATERANGES");Z&&(E.recentlyRemovedDateranges=Z.split("\t"));break;case"TARGETDURATION":E.targetduration=parseFloat(V);break;case"VERSION":E.version=parseInt(V);break;case"EXTM3U":break;case"ENDLIST":E.live=!1;break;case"#":(V||Q)&&N.tagList.push(Q?[V,Q]:[V]);break;case"DIS":U++;case"GAP":N.tagList.push([Y]);break;case"BITRATE":N.tagList.push([Y,V]);break;case"DISCONTINUITY-SEQ":U=parseInt(V);break;case"KEY":var tt,rt=new m.AttrList(V),at=rt.enumeratedString("METHOD"),nt=rt.URI,st=rt.hexadecimalInteger("IV"),ut=rt.enumeratedString("KEYFORMATVERSIONS"),_=rt.enumeratedString("KEYID"),ot=null!=(tt=rt.enumeratedString("KEYFORMAT"))?tt:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(ot)>-1){s.logger.warn("Keyformat "+ot+" is not supported from the manifest");continue}if("identity"!==ot)continue;at&&(w=A.LevelKey.fromURL(l,nt),nt&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(at)>=0&&(w.method=at,w.keyFormat=ot,_&&(w.keyID=_),ut&&(w.keyFormatVersions=ut),w.iv=st));break;case"START":var dt=new m.AttrList(V).decimalFloatingPoint("TIME-OFFSET");Object(b.isFiniteNumber)(dt)&&(E.startTimeOffset=dt);break;case"MAP":var ct=new m.AttrList(V);N.relurl=ct.URI,ct.BYTERANGE&&N.setByteRange(ct.BYTERANGE),N.level=h,N.sn="initSegment",w&&(N.levelkey=w),N.initSegment=null,D=N,j=!0;break;case"SERVER-CONTROL":var lt=new m.AttrList(V);E.canBlockReload=lt.bool("CAN-BLOCK-RELOAD"),E.canSkipUntil=lt.optionalFloat("CAN-SKIP-UNTIL",0),E.canSkipDateRanges=E.canSkipUntil>0&&lt.bool("CAN-SKIP-DATERANGES"),E.partHoldBack=lt.optionalFloat("PART-HOLD-BACK",0),E.holdBack=lt.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var yt=new m.AttrList(V);E.partTarget=yt.decimalFloatingPoint("PART-TARGET");break;case"PART":var it=E.partList;it||(it=E.partList=[]);var ht=F>0?it[it.length-1]:void 0,Lt=F++,mt=new C.Part(new m.AttrList(V),N,l,Lt,ht);it.push(mt),N.duration+=mt.duration;break;case"PRELOAD-HINT":var Et=new m.AttrList(V);E.preloadHint=Et;break;case"RENDITION-REPORT":var St=new m.AttrList(V);E.renditionReports=E.renditionReports||[],E.renditionReports.push(St);break;default:s.logger.warn("line parsed but not handled: "+K)}}}k&&!k.relurl?(x.pop(),B-=k.duration,E.partList&&(E.fragmentHint=k)):E.partList&&(n(N,k),N.cc=U,E.fragmentHint=N);var pt=x.length,ft=x[0],Tt=x[pt-1];if((B+=E.skippedSegments*E.targetduration)>0&&pt&&Tt){E.averagetargetduration=B/pt;var At=Tt.sn;E.endSN="initSegment"!==At?At:0,ft&&(E.startCC=ft.cc,ft.initSegment||E.fragments.every(function(xt){return xt.relurl&&function(u){var a,o;return v.test(null!=(a=null===(o=R.parseURL(u))||void 0===o?void 0:o.path)?a:"")}(xt.relurl)})&&(s.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(N=new C.Fragment(L,l)).relurl=Tt.relurl,N.level=h,N.sn="initSegment",ft.initSegment=N,E.needSidxRanges=!0))}else E.endSN=0,E.startCC=0;return E.fragmentHint&&(B+=E.fragmentHint.duration),E.totalduration=B,E.endCC=U,H>0&&function(u,a){for(var o=u[a],l=a;l--;){var h=u[l];if(!h)return;h.programDateTime=o.programDateTime-1e3*h.duration,o=h}}(x,H),E},u}();function e(u,a){["video","audio","text"].forEach(function(o){var l=u.filter(function(L){return Object(f.isCodecType)(L,o)});if(l.length){var h=l.filter(function(L){return 0===L.lastIndexOf("avc1",0)||0===L.lastIndexOf("mp4a",0)});a[o+"Codec"]=h.length>0?h[0]:l[0],u=u.filter(function(L){return-1===l.indexOf(L)})}}),a.unknownCodecs=u}function d(u,a,o){var l=a[o];l&&(u[o]=l)}function n(u,a){u.rawProgramDateTime?u.programDateTime=Date.parse(u.rawProgramDateTime):null!=a&&a.programDateTime&&(u.programDateTime=a.endProgramDateTime),Object(b.isFiniteNumber)(u.programDateTime)||(u.programDateTime=null,u.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(G,I,p){"use strict";p.r(I);var b=p("./src/polyfills/number.ts"),R=p("./src/events.ts"),S=p("./src/errors.ts"),C=p("./src/utils/logger.ts"),P=p("./src/utils/mp4-tools.ts"),A=p("./src/loader/m3u8-parser.ts"),m=p("./src/types/loader.ts"),s=p("./src/utils/attr-list.ts");function c(y,g){var v=y.url;return(void 0===v||0===v.indexOf("data:"))&&(v=g.url),v}I.default=function(){function y(v){this.hls=void 0,this.loaders=Object.create(null),this.hls=v,this.registerListeners()}var g=y.prototype;return g.registerListeners=function(){var r=this.hls;r.on(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(R.Events.LEVEL_LOADING,this.onLevelLoading,this),r.on(R.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.on(R.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},g.unregisterListeners=function(){var r=this.hls;r.off(R.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(R.Events.LEVEL_LOADING,this.onLevelLoading,this),r.off(R.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),r.off(R.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},g.createInternalLoader=function(r){var t=this.hls.config,n=new(t.pLoader||t.loader)(t);return r.loader=n,this.loaders[r.type]=n,n},g.getInternalLoader=function(r){return this.loaders[r.type]},g.resetInternalLoader=function(r){this.loaders[r]&&delete this.loaders[r]},g.destroyInternalLoaders=function(){for(var r in this.loaders){var t=this.loaders[r];t&&t.destroy(),this.resetInternalLoader(r)}},g.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},g.onManifestLoading=function(r,t){this.load({id:null,groupId:null,level:0,responseType:"text",type:m.PlaylistContextType.MANIFEST,url:t.url,deliveryDirectives:null})},g.onLevelLoading=function(r,t){this.load({id:t.id,groupId:null,level:t.level,responseType:"text",type:m.PlaylistContextType.LEVEL,url:t.url,deliveryDirectives:t.deliveryDirectives})},g.onAudioTrackLoading=function(r,t){this.load({id:t.id,groupId:t.groupId,level:null,responseType:"text",type:m.PlaylistContextType.AUDIO_TRACK,url:t.url,deliveryDirectives:t.deliveryDirectives})},g.onSubtitleTrackLoading=function(r,t){this.load({id:t.id,groupId:t.groupId,level:null,responseType:"text",type:m.PlaylistContextType.SUBTITLE_TRACK,url:t.url,deliveryDirectives:t.deliveryDirectives})},g.load=function(r){var t,n,u,a,o,l,e=this.hls.config,d=this.getInternalLoader(r);if(d){var i=d.context;if(i&&i.url===r.url)return void C.logger.trace("[playlist-loader]: playlist request ongoing");C.logger.log("[playlist-loader]: aborting previous loader for type: "+r.type),d.abort()}switch(r.type){case m.PlaylistContextType.MANIFEST:n=e.manifestLoadingMaxRetry,u=e.manifestLoadingTimeOut,a=e.manifestLoadingRetryDelay,o=e.manifestLoadingMaxRetryTimeout;break;case m.PlaylistContextType.LEVEL:case m.PlaylistContextType.AUDIO_TRACK:case m.PlaylistContextType.SUBTITLE_TRACK:n=0,u=e.levelLoadingTimeOut;break;default:n=e.levelLoadingMaxRetry,u=e.levelLoadingTimeOut,a=e.levelLoadingRetryDelay,o=e.levelLoadingMaxRetryTimeout}if(d=this.createInternalLoader(r),null!==(t=r.deliveryDirectives)&&void 0!==t&&t.part&&(r.type===m.PlaylistContextType.LEVEL&&null!==r.level?l=this.hls.levels[r.level].details:r.type===m.PlaylistContextType.AUDIO_TRACK&&null!==r.id?l=this.hls.audioTracks[r.id].details:r.type===m.PlaylistContextType.SUBTITLE_TRACK&&null!==r.id&&(l=this.hls.subtitleTracks[r.id].details),l)){var h=l.partTarget,L=l.targetduration;h&&L&&(u=Math.min(1e3*Math.max(3*h,.8*L),u))}var O={timeout:u,maxRetry:n,retryDelay:a,maxRetryDelay:o,highWaterMark:0},E={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};d.load(r,O,E)},g.loadsuccess=function(r,t,e,d){if(void 0===d&&(d=null),e.isSidxRequest)return this.handleSidxRequest(r,e),void this.handlePlaylistLoaded(r,t,e,d);this.resetInternalLoader(e.type);var i=r.data;0===i.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),i.indexOf("#EXTINF:")>0||i.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(r,t,e,d):this.handleMasterPlaylist(r,t,e,d)):this.handleManifestParsingError(r,e,"no EXTM3U delimiter",d)},g.loaderror=function(r,t,e){void 0===e&&(e=null),this.handleNetworkError(t,e,!1,r)},g.loadtimeout=function(r,t,e){void 0===e&&(e=null),this.handleNetworkError(t,e,!0)},g.handleMasterPlaylist=function(r,t,e,d){var i=this.hls,n=r.data,u=c(r,e),a=A.default.parseMasterPlaylist(n,u),o=a.levels,l=a.sessionData;if(o.length){var h=o.map(function(M){return{id:M.attrs.AUDIO,audioCodec:M.audioCodec}}),L=o.map(function(M){return{id:M.attrs.SUBTITLES,textCodec:M.textCodec}}),O=A.default.parseMasterPlaylistMedia(n,u,"AUDIO",h),E=A.default.parseMasterPlaylistMedia(n,u,"SUBTITLES",L),x=A.default.parseMasterPlaylistMedia(n,u,"CLOSED-CAPTIONS");O.length&&!O.some(function(M){return!M.url})&&o[0].audioCodec&&!o[0].attrs.AUDIO&&(C.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),O.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new s.AttrList({}),bitrate:0,url:""})),i.trigger(R.Events.MANIFEST_LOADED,{levels:o,audioTracks:O,subtitles:E,captions:x,url:u,stats:t,networkDetails:d,sessionData:l})}else this.handleManifestParsingError(r,e,"no level found in manifest",d)},g.handleTrackOrLevelPlaylist=function(r,t,e,d){var i=this.hls,n=e.id,u=e.level,a=e.type,o=c(r,e),l=Object(b.isFiniteNumber)(n)?n:0,h=Object(b.isFiniteNumber)(u)?u:l,L=function(y){switch(y.type){case m.PlaylistContextType.AUDIO_TRACK:return m.PlaylistLevelType.AUDIO;case m.PlaylistContextType.SUBTITLE_TRACK:return m.PlaylistLevelType.SUBTITLE;default:return m.PlaylistLevelType.MAIN}}(e),O=A.default.parseLevelPlaylist(r.data,o,h,L,l);if(O.fragments.length){if(a===m.PlaylistContextType.MANIFEST){var E={attrs:new s.AttrList({}),bitrate:0,details:O,name:"",url:o};i.trigger(R.Events.MANIFEST_LOADED,{levels:[E],audioTracks:[],url:o,stats:t,networkDetails:d,sessionData:null})}if(t.parsing.end=performance.now(),O.needSidxRanges){var x,D=null===(x=O.fragments[0].initSegment)||void 0===x?void 0:x.url;this.load({url:D,isSidxRequest:!0,type:a,level:u,levelDetails:O,id:n,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else e.levelDetails=O,this.handlePlaylistLoaded(r,t,e,d)}else i.trigger(R.Events.ERROR,{type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:o,reason:"no fragments found in level",level:"number"==typeof e.level?e.level:void 0})},g.handleSidxRequest=function(r,t){var e=Object(P.parseSegmentIndex)(new Uint8Array(r.data));if(e){var i=t.levelDetails;e.references.forEach(function(n,u){var a=n.info,o=i.fragments[u];0===o.byteRange.length&&o.setByteRange(String(1+a.end-a.start)+"@"+String(a.start)),o.initSegment&&o.initSegment.setByteRange(String(e.moovEndOffset)+"@0")})}},g.handleManifestParsingError=function(r,t,e,d){this.hls.trigger(R.Events.ERROR,{type:S.ErrorTypes.NETWORK_ERROR,details:S.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:t.type===m.PlaylistContextType.MANIFEST,url:r.url,reason:e,response:r,context:t,networkDetails:d})},g.handleNetworkError=function(r,t,e,d){void 0===e&&(e=!1),C.logger.warn("[playlist-loader]: A network "+(e?"timeout":"error")+" occurred while loading "+r.type+" level: "+r.level+" id: "+r.id+' group-id: "'+r.groupId+'"');var i=S.ErrorDetails.UNKNOWN,n=!1,u=this.getInternalLoader(r);switch(r.type){case m.PlaylistContextType.MANIFEST:i=e?S.ErrorDetails.MANIFEST_LOAD_TIMEOUT:S.ErrorDetails.MANIFEST_LOAD_ERROR,n=!0;break;case m.PlaylistContextType.LEVEL:i=e?S.ErrorDetails.LEVEL_LOAD_TIMEOUT:S.ErrorDetails.LEVEL_LOAD_ERROR,n=!1;break;case m.PlaylistContextType.AUDIO_TRACK:i=e?S.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:S.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,n=!1;break;case m.PlaylistContextType.SUBTITLE_TRACK:i=e?S.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:S.ErrorDetails.SUBTITLE_LOAD_ERROR,n=!1}u&&this.resetInternalLoader(r.type);var a={type:S.ErrorTypes.NETWORK_ERROR,details:i,fatal:n,url:r.url,loader:u,context:r,networkDetails:t};d&&(a.response=d),this.hls.trigger(R.Events.ERROR,a)},g.handlePlaylistLoaded=function(r,t,e,d){var i=e.type,n=e.level,u=e.id,a=e.groupId,o=e.loader,l=e.levelDetails,h=e.deliveryDirectives;if(null!=l&&l.targetduration){if(o)switch(l.live&&(o.getCacheAge&&(l.ageHeader=o.getCacheAge()||0),(!o.getCacheAge||isNaN(l.ageHeader))&&(l.ageHeader=0)),i){case m.PlaylistContextType.MANIFEST:case m.PlaylistContextType.LEVEL:this.hls.trigger(R.Events.LEVEL_LOADED,{details:l,level:n||0,id:u||0,stats:t,networkDetails:d,deliveryDirectives:h});break;case m.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(R.Events.AUDIO_TRACK_LOADED,{details:l,id:u||0,groupId:a||"",stats:t,networkDetails:d,deliveryDirectives:h});break;case m.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(R.Events.SUBTITLE_TRACK_LOADED,{details:l,id:u||0,groupId:a||"",stats:t,networkDetails:d,deliveryDirectives:h})}}else this.handleManifestParsingError(r,e,"invalid target duration",d)},y}()},"./src/polyfills/number.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"isFiniteNumber",function(){return b}),p.d(I,"MAX_SAFE_INTEGER",function(){return R});var b=Number.isFinite||function(S){return"number"==typeof S&&isFinite(S)},R=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(G,I,p){"use strict";p.r(I),I.default=function(){function R(){}return R.getSilentFrame=function(C,P){switch(C){case"mp4a.40.2":if(1===P)return new Uint8Array([0,200,0,128,35,128]);if(2===P)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===P)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===P)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===P)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===P)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===P)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===P)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===P)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},R}()},"./src/remux/mp4-generator.ts":function(G,I,p){"use strict";p.r(I);var b=Math.pow(2,32)-1,R=function(){function S(){}return S.init=function(){var P;for(P in S.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]})S.types.hasOwnProperty(P)&&(S.types[P]=[P.charCodeAt(0),P.charCodeAt(1),P.charCodeAt(2),P.charCodeAt(3)]);var A=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),m=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);S.HDLR_TYPES={video:A,audio:m};var s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),f=new Uint8Array([0,0,0,0,0,0,0,0]);S.STTS=S.STSC=S.STCO=f,S.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),S.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),S.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),S.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var c=new Uint8Array([105,115,111,109]),T=new Uint8Array([97,118,99,49]),y=new Uint8Array([0,0,0,1]);S.FTYP=S.box(S.types.ftyp,c,y,c,T),S.DINF=S.box(S.types.dinf,S.box(S.types.dref,s))},S.box=function(P){for(var A=8,m=arguments.length,s=new Array(m>1?m-1:0),f=1;f<m;f++)s[f-1]=arguments[f];for(var c=s.length,T=c;c--;)A+=s[c].byteLength;var y=new Uint8Array(A);for(y[0]=A>>24&255,y[1]=A>>16&255,y[2]=A>>8&255,y[3]=255&A,y.set(P,4),c=0,A=8;c<T;c++)y.set(s[c],A),A+=s[c].byteLength;return y},S.hdlr=function(P){return S.box(S.types.hdlr,S.HDLR_TYPES[P])},S.mdat=function(P){return S.box(S.types.mdat,P)},S.mdhd=function(P,A){A*=P;var m=Math.floor(A/(b+1)),s=Math.floor(A%(b+1));return S.box(S.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,P>>24&255,P>>16&255,P>>8&255,255&P,m>>24,m>>16&255,m>>8&255,255&m,s>>24,s>>16&255,s>>8&255,255&s,85,196,0,0]))},S.mdia=function(P){return S.box(S.types.mdia,S.mdhd(P.timescale,P.duration),S.hdlr(P.type),S.minf(P))},S.mfhd=function(P){return S.box(S.types.mfhd,new Uint8Array([0,0,0,0,P>>24,P>>16&255,P>>8&255,255&P]))},S.minf=function(P){return S.box(S.types.minf,"audio"===P.type?S.box(S.types.smhd,S.SMHD):S.box(S.types.vmhd,S.VMHD),S.DINF,S.stbl(P))},S.moof=function(P,A,m){return S.box(S.types.moof,S.mfhd(P),S.traf(m,A))},S.moov=function(P){for(var A=P.length,m=[];A--;)m[A]=S.trak(P[A]);return S.box.apply(null,[S.types.moov,S.mvhd(P[0].timescale,P[0].duration)].concat(m).concat(S.mvex(P)))},S.mvex=function(P){for(var A=P.length,m=[];A--;)m[A]=S.trex(P[A]);return S.box.apply(null,[S.types.mvex].concat(m))},S.mvhd=function(P,A){A*=P;var m=Math.floor(A/(b+1)),s=Math.floor(A%(b+1)),f=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,P>>24&255,P>>16&255,P>>8&255,255&P,m>>24,m>>16&255,m>>8&255,255&m,s>>24,s>>16&255,s>>8&255,255&s,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return S.box(S.types.mvhd,f)},S.sdtp=function(P){var s,f,A=P.samples||[],m=new Uint8Array(4+A.length);for(s=0;s<A.length;s++)m[s+4]=(f=A[s].flags).dependsOn<<4|f.isDependedOn<<2|f.hasRedundancy;return S.box(S.types.sdtp,m)},S.stbl=function(P){return S.box(S.types.stbl,S.stsd(P),S.box(S.types.stts,S.STTS),S.box(S.types.stsc,S.STSC),S.box(S.types.stsz,S.STSZ),S.box(S.types.stco,S.STCO))},S.avc1=function(P){var s,f,c,A=[],m=[];for(s=0;s<P.sps.length;s++)A.push((c=(f=P.sps[s]).byteLength)>>>8&255),A.push(255&c),A=A.concat(Array.prototype.slice.call(f));for(s=0;s<P.pps.length;s++)m.push((c=(f=P.pps[s]).byteLength)>>>8&255),m.push(255&c),m=m.concat(Array.prototype.slice.call(f));var T=S.box(S.types.avcC,new Uint8Array([1,A[3],A[4],A[5],255,224|P.sps.length].concat(A).concat([P.pps.length]).concat(m))),y=P.width,g=P.height,v=P.pixelRatio[0],r=P.pixelRatio[1];return S.box(S.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,y>>8&255,255&y,g>>8&255,255&g,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),T,S.box(S.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),S.box(S.types.pasp,new Uint8Array([v>>24,v>>16&255,v>>8&255,255&v,r>>24,r>>16&255,r>>8&255,255&r])))},S.esds=function(P){var A=P.config.length;return new Uint8Array([0,0,0,0,3,23+A,0,1,0,4,15+A,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([A]).concat(P.config).concat([6,1,2]))},S.mp4a=function(P){var A=P.samplerate;return S.box(S.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,P.channelCount,0,16,0,0,0,0,A>>8&255,255&A,0,0]),S.box(S.types.esds,S.esds(P)))},S.mp3=function(P){var A=P.samplerate;return S.box(S.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,P.channelCount,0,16,0,0,0,0,A>>8&255,255&A,0,0]))},S.stsd=function(P){return S.box(S.types.stsd,S.STSD,"audio"===P.type?P.isAAC||"mp3"!==P.codec?S.mp4a(P):S.mp3(P):S.avc1(P))},S.tkhd=function(P){var A=P.id,m=P.duration*P.timescale,s=P.width,f=P.height,c=Math.floor(m/(b+1)),T=Math.floor(m%(b+1));return S.box(S.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,A>>24&255,A>>16&255,A>>8&255,255&A,0,0,0,0,c>>24,c>>16&255,c>>8&255,255&c,T>>24,T>>16&255,T>>8&255,255&T,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,255&s,0,0,f>>8&255,255&f,0,0]))},S.traf=function(P,A){var m=S.sdtp(P),s=P.id,f=Math.floor(A/(b+1)),c=Math.floor(A%(b+1));return S.box(S.types.traf,S.box(S.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s])),S.box(S.types.tfdt,new Uint8Array([1,0,0,0,f>>24,f>>16&255,f>>8&255,255&f,c>>24,c>>16&255,c>>8&255,255&c])),S.trun(P,m.length+16+20+8+16+8+8),m)},S.trak=function(P){return P.duration=P.duration||4294967295,S.box(S.types.trak,S.tkhd(P),S.mdia(P))},S.trex=function(P){var A=P.id;return S.box(S.types.trex,new Uint8Array([0,0,0,0,A>>24,A>>16&255,A>>8&255,255&A,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},S.trun=function(P,A){var T,y,g,v,r,t,m=P.samples||[],s=m.length,f=12+16*s,c=new Uint8Array(f);for(c.set([0,0,15,1,s>>>24&255,s>>>16&255,s>>>8&255,255&s,(A+=8+f)>>>24&255,A>>>16&255,A>>>8&255,255&A],0),T=0;T<s;T++)c.set([(g=(y=m[T]).duration)>>>24&255,g>>>16&255,g>>>8&255,255&g,(v=y.size)>>>24&255,v>>>16&255,v>>>8&255,255&v,(r=y.flags).isLeading<<2|r.dependsOn,r.isDependedOn<<6|r.hasRedundancy<<4|r.paddingValue<<1|r.isNonSync,61440&r.degradPrio,15&r.degradPrio,(t=y.cts)>>>24&255,t>>>16&255,t>>>8&255,255&t],12+16*T);return S.box(S.types.trun,c)},S.initSegment=function(P){S.types||S.init();var A=S.moov(P),m=new Uint8Array(S.FTYP.byteLength+A.byteLength);return m.set(S.FTYP),m.set(A,S.FTYP.byteLength),m},S}();R.types=void 0,R.HDLR_TYPES=void 0,R.STTS=void 0,R.STSC=void 0,R.STCO=void 0,R.STSZ=void 0,R.VMHD=void 0,R.SMHD=void 0,R.STSD=void 0,R.FTYP=void 0,R.DINF=void 0,I.default=R},"./src/remux/mp4-remuxer.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"default",function(){return t}),p.d(I,"normalizePts",function(){return e});var b=p("./src/polyfills/number.ts"),R=p("./src/remux/aac-helper.ts"),S=p("./src/remux/mp4-generator.ts"),C=p("./src/events.ts"),P=p("./src/errors.ts"),A=p("./src/utils/logger.ts"),m=p("./src/types/loader.ts"),s=p("./src/utils/timescale-conversion.ts");function f(){return(f=Object.assign||function(u){for(var a=1;a<arguments.length;a++){var o=arguments[a];for(var l in o)Object.prototype.hasOwnProperty.call(o,l)&&(u[l]=o[l])}return u}).apply(this,arguments)}var g=null,v=null,r=!1,t=function(){function u(o,l,h,L){if(void 0===L&&(L=""),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=o,this.config=l,this.typeSupported=h,this.ISGenerated=!1,null===g){var E=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);g=E?parseInt(E[1]):0}if(null===v){var x=navigator.userAgent.match(/Safari\/(\d+)/i);v=x?parseInt(x[1]):0}r=!!g&&g<75||!!v&&v<600}var a=u.prototype;return a.destroy=function(){},a.resetTimeStamp=function(l){A.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=l},a.resetNextTimestamp=function(){A.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},a.resetInitSegment=function(){A.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},a.getVideoStartPts=function(l){var h=!1,L=l.reduce(function(O,E){var x=E.pts-O;return x<-4294967296?(h=!0,e(O,E.pts)):x>0?O:E.pts},l[0].pts);return h&&A.logger.debug("PTS rollover detected"),L},a.remux=function(l,h,L,O,E,x,D,M){var F,B,U,k,N,K,W=E,w=E,j=h.pid>-1,z=h.samples.length,J=l.samples.length>0,X=z>1;if((!(l.pid>-1)||J)&&(!j||X)||this.ISGenerated||D){this.ISGenerated||(U=this.generateIS(l,h,E));var V=this.isVideoContiguous,Q=-1;if(X&&(Q=function(u){for(var a=0;a<u.length;a++)if(u[a].key)return a;return-1}(h.samples),!V&&this.config.forceKeyFrameOnDiscontinuity))if(K=!0,Q>0){A.logger.warn("[mp4-remuxer]: Dropped "+Q+" out of "+z+" video samples due to a missing keyframe");var q=this.getVideoStartPts(h.samples);h.samples=h.samples.slice(Q),h.dropped+=Q,w+=(h.samples[0].pts-q)/(h.timescale||9e4)}else-1===Q&&(A.logger.warn("[mp4-remuxer]: No keyframe found out of "+z+" video samples"),K=!1);if(this.ISGenerated){if(J&&X){var $=this.getVideoStartPts(h.samples),Z=(e(l.samples[0].pts,$)-$)/h.inputTimeScale;W+=Math.max(0,Z),w+=Math.max(0,-Z)}if(J){if(l.samplerate||(A.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),U=this.generateIS(l,h,E)),B=this.remuxAudio(l,W,this.isAudioContiguous,x,j||X||M===m.PlaylistLevelType.AUDIO?w:void 0),X){var tt=B?B.endPTS-B.startPTS:0;h.inputTimeScale||(A.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),U=this.generateIS(l,h,E)),F=this.remuxVideo(h,w,V,tt)}}else X&&(F=this.remuxVideo(h,w,V,0));F&&(F.firstKeyFrame=Q,F.independent=-1!==Q)}}return this.ISGenerated&&(L.samples.length&&(N=this.remuxID3(L,E)),O.samples.length&&(k=this.remuxText(O,E))),{audio:B,video:F,initSegment:U,independent:K,text:k,id3:N}},a.generateIS=function(l,h,L){var B,U,k,O=l.samples,E=h.samples,x=this.typeSupported,D={},M=!Object(b.isFiniteNumber)(this._initPTS),F="audio/mp4";if(M&&(B=U=1/0),l.config&&O.length&&(l.timescale=l.samplerate,l.isAAC||(x.mpeg?(F="audio/mpeg",l.codec=""):x.mp3&&(l.codec="mp3")),D.audio={id:"audio",container:F,codec:l.codec,initSegment:!l.isAAC&&x.mpeg?new Uint8Array(0):S.default.initSegment([l]),metadata:{channelCount:l.channelCount}},M&&(k=l.inputTimeScale,B=U=O[0].pts-Math.round(k*L))),h.sps&&h.pps&&E.length&&(h.timescale=h.inputTimeScale,D.video={id:"main",container:"video/mp4",codec:h.codec,initSegment:S.default.initSegment([h]),metadata:{width:h.width,height:h.height}},M)){k=h.inputTimeScale;var N=this.getVideoStartPts(E),K=Math.round(k*L);U=Math.min(U,e(E[0].dts,N)-K),B=Math.min(B,N-K)}if(Object.keys(D).length)return this.ISGenerated=!0,M&&(this._initPTS=B,this._initDTS=U),{tracks:D,initPTS:B,timescale:k}},a.remuxVideo=function(l,h,L,O){var k,N,K,E=l.inputTimeScale,x=l.samples,D=[],M=x.length,F=this._initPTS,B=this.nextAvcDts,U=8,W=Number.POSITIVE_INFINITY,w=Number.NEGATIVE_INFINITY,H=0,j=!1;L&&null!==B||(B=h*E-(x[0].pts-e(x[0].dts,x[0].pts)));for(var X=0;X<M;X++){var Y=x[X];if(Y.pts=e(Y.pts-F,B),Y.dts=e(Y.dts-F,B),Y.dts>Y.pts){H=Math.max(Math.min(H,Y.pts-Y.dts),-18e3)}Y.dts<x[X>0?X-1:X].dts&&(j=!0)}j&&x.sort(function(Rt,It){return Rt.dts-It.dts||Rt.pts-It.pts}),N=x[0].dts,K=x[x.length-1].dts;var Q=Math.round((K-N)/(M-1));if(H<0){if(H<-2*Q){A.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(s.toMsFromMpegTsClock)(-Q,!0)+" ms");for(var q=H,$=0;$<M;$++)x[$].dts=q=Math.max(q,x[$].pts-Q),x[$].pts=Math.max(q,x[$].pts)}else{A.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(s.toMsFromMpegTsClock)(H,!0)+" ms to overcome this issue");for(var et=0;et<M;et++)x[et].dts=x[et].dts+H}N=x[0].dts}if(L){var Z=N-B,tt=Z>Q;if(tt||Z<-1){A.logger.warn(tt?"AVC: "+Object(s.toMsFromMpegTsClock)(Z,!0)+" ms ("+Z+"dts) hole between fragments detected, filling it":"AVC: "+Object(s.toMsFromMpegTsClock)(-Z,!0)+" ms ("+Z+"dts) overlapping between fragments detected");var at=x[0].pts-Z;x[0].dts=N=B,x[0].pts=at,A.logger.log("Video: First PTS/DTS adjusted: "+Object(s.toMsFromMpegTsClock)(at,!0)+"/"+Object(s.toMsFromMpegTsClock)(N,!0)+", delta: "+Object(s.toMsFromMpegTsClock)(Z,!0)+" ms")}}r&&(N=Math.max(0,N));for(var nt=0,st=0,ut=0;ut<M;ut++){for(var _=x[ut],ot=_.units,vt=ot.length,gt=0,dt=0;dt<vt;dt++)gt+=ot[dt].data.length;st+=gt,nt+=vt,_.length=gt,_.dts=Math.max(_.dts,N),_.pts=Math.max(_.pts,_.dts,0),W=Math.min(_.pts,W),w=Math.max(_.pts,w)}K=x[M-1].dts;var lt,ct=st+4*nt+8;try{lt=new Uint8Array(ct)}catch(Rt){return void this.observer.emit(C.Events.ERROR,C.Events.ERROR,{type:P.ErrorTypes.MUX_ERROR,details:P.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:ct,reason:"fail allocating video mdat "+ct})}var yt=new DataView(lt.buffer);yt.setUint32(0,ct),lt.set(S.default.types.mdat,4);for(var it=0;it<M;it++){for(var ht=x[it],Lt=ht.units,mt=0,Et=0,St=Lt.length;Et<St;Et++){var pt=Lt[Et],ft=pt.data,Tt=pt.data.byteLength;yt.setUint32(U,Tt),lt.set(ft,U+=4),U+=Tt,mt+=4+Tt}if(it<M-1)k=x[it+1].dts-ht.dts;else{var At=this.config,xt=ht.dts-x[it>0?it-1:it].dts;if(At.stretchShortVideoTrack&&null!==this.nextAudioPts){var Ct=Math.floor(At.maxBufferHole*E),Dt=(O?W+O*E:this.nextAudioPts)-ht.pts;Dt>Ct?((k=Dt-xt)<0&&(k=xt),A.logger.log("[mp4-remuxer]: It is approximately "+Dt/90+" ms to the next segment; using duration "+k/90+" ms for the last video frame.")):k=xt}else k=xt}var Mt=Math.round(ht.pts-ht.dts);D.push(new i(ht.key,k,mt,Mt))}if(D.length&&g&&g<70){var Pt=D[0].flags;Pt.dependsOn=2,Pt.isNonSync=0}console.assert(void 0!==k,"mp4SampleDuration must be computed"),this.nextAvcDts=B=K+k,this.isVideoContiguous=!0;var Ft={data1:S.default.moof(l.sequenceNumber++,N,f({},l,{samples:D})),data2:lt,startPTS:W/E,endPTS:(w+k)/E,startDTS:N/E,endDTS:B/E,type:"video",hasAudio:!1,hasVideo:!0,nb:D.length,dropped:l.dropped};return l.samples=[],l.dropped=0,console.assert(lt.length,"MDAT length must not be zero"),Ft},a.remuxAudio=function(l,h,L,O,E){var x=l.inputTimeScale,M=x/(l.samplerate?l.samplerate:x),F=l.isAAC?1024:1152,B=F*M,U=this._initPTS,k=!l.isAAC&&this.typeSupported.mpeg,N=[],K=l.samples,W=k?0:8,w=this.nextAudioPts||-1,H=h*x;if(this.isAudioContiguous=L=L||K.length&&w>0&&(O&&Math.abs(H-w)<9e3||Math.abs(e(K[0].pts-U,H)-w)<20*B),K.forEach(function(ft){ft.pts=e(ft.pts-U,H)}),!L||w<0){if(!(K=K.filter(function(ft){return ft.pts>=0})).length)return;w=0===E?0:O?Math.max(0,H):K[0].pts}if(l.isAAC)for(var j=void 0!==E,z=this.config.maxAudioFramesDrift,J=0,X=w;J<K.length;J++){var Y=K[J],V=Y.pts,Q=V-X,q=Math.abs(1e3*Q/x);if(Q<=-z*B&&j)0===J&&(A.logger.warn("Audio frame @ "+(V/x).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*Q/x)+" ms."),this.nextAudioPts=w=X=V);else if(Q>=z*B&&q<1e4&&j){var $=Math.round(Q/B);(X=V-$*B)<0&&($--,X+=B),0===J&&(this.nextAudioPts=w=X),A.logger.warn("[mp4-remuxer]: Injecting "+$+" audio frame @ "+(X/x).toFixed(3)+"s due to "+Math.round(1e3*Q/x)+" ms gap.");for(var et=0;et<$;et++){var Z=Math.max(X,0),tt=R.default.getSilentFrame(l.manifestCodec||l.codec,l.channelCount);tt||(A.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),tt=Y.unit.subarray()),K.splice(J,0,{unit:tt,pts:Z}),X+=B,J++}}Y.pts=X,X+=B}for(var nt,rt=null,at=null,st=0,ut=K.length;ut--;)st+=K[ut].unit.byteLength;for(var _=0,ot=K.length;_<ot;_++){var vt=K[_],gt=vt.unit,dt=vt.pts;if(null!==at)N[_-1].duration=Math.round((dt-at)/M);else{if(L&&l.isAAC&&(dt=w),rt=dt,!(st>0))return;st+=W;try{nt=new Uint8Array(st)}catch(ft){return void this.observer.emit(C.Events.ERROR,C.Events.ERROR,{type:P.ErrorTypes.MUX_ERROR,details:P.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:st,reason:"fail allocating audio mdat "+st})}k||(new DataView(nt.buffer).setUint32(0,st),nt.set(S.default.types.mdat,4))}nt.set(gt,W);var yt=gt.byteLength;W+=yt,N.push(new i(!0,F,yt,0)),at=dt}var it=N.length;if(it){this.nextAudioPts=w=at+M*N[N.length-1].duration;var Lt=k?new Uint8Array(0):S.default.moof(l.sequenceNumber++,rt/M,f({},l,{samples:N}));l.samples=[];var mt=rt/x,Et=w/x,pt={data1:Lt,data2:nt,startPTS:mt,endPTS:Et,startDTS:mt,endDTS:Et,type:"audio",hasAudio:!0,hasVideo:!1,nb:it};return this.isAudioContiguous=!0,console.assert(nt.length,"MDAT length must not be zero"),pt}},a.remuxEmptyAudio=function(l,h,L,O){var E=l.inputTimeScale,M=this.nextAudioPts,F=(null!==M?M:O.startDTS*E)+this._initDTS,U=E/(l.samplerate?l.samplerate:E)*1024,k=Math.ceil((O.endDTS*E+this._initDTS-F)/U),N=R.default.getSilentFrame(l.manifestCodec||l.codec,l.channelCount);if(A.logger.warn("[mp4-remuxer]: remux empty Audio"),N){for(var K=[],W=0;W<k;W++){var w=F+W*U;K.push({unit:N,pts:w,dts:w})}return l.samples=K,this.remuxAudio(l,h,L,!1)}A.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},a.remuxID3=function(l,h){var L=l.samples.length;if(L){for(var O=l.inputTimeScale,E=this._initPTS,x=this._initDTS,D=0;D<L;D++){var M=l.samples[D];M.pts=e(M.pts-E,h*O)/O,M.dts=e(M.dts-x,h*O)/O}var F=l.samples;return l.samples=[],{samples:F}}},a.remuxText=function(l,h){var L=l.samples.length;if(L){for(var O=l.inputTimeScale,E=this._initPTS,x=0;x<L;x++){var D=l.samples[x];D.pts=e(D.pts-E,h*O)/O}l.samples.sort(function(F,B){return F.pts-B.pts});var M=l.samples;return l.samples=[],{samples:M}}},u}();function e(u,a){var o;if(null===a)return u;for(o=a<u?-8589934592:8589934592;Math.abs(u-a)>4294967296;)u+=o;return u}var i=function(a,o,l,h){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=o,this.size=l,this.cts=h,this.flags=new n(a)},n=function(a){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=a?2:1,this.isNonSync=a?0:1}},"./src/remux/passthrough-remuxer.ts":function(G,I,p){"use strict";p.r(I);var b=p("./src/polyfills/number.ts"),R=p("./src/utils/mp4-tools.ts"),S=p("./src/loader/fragment.ts"),C=p("./src/utils/logger.ts"),P=function(){function s(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var f=s.prototype;return f.destroy=function(){},f.resetTimeStamp=function(T){this.initPTS=T,this.lastEndDTS=null},f.resetNextTimestamp=function(){this.lastEndDTS=null},f.resetInitSegment=function(T,y,g){this.audioCodec=y,this.videoCodec=g,this.generateInitSegment(T),this.emitInitSegment=!0},f.generateInitSegment=function(T){var y=this.audioCodec,g=this.videoCodec;if(!T||!T.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var v=this.initData=Object(R.parseInitSegment)(T);y||(y=m(v.audio,S.ElementaryStreamTypes.AUDIO)),g||(g=m(v.video,S.ElementaryStreamTypes.VIDEO));var r={};v.audio&&v.video?r.audiovideo={container:"video/mp4",codec:y+","+g,initSegment:T,id:"main"}:v.audio?r.audio={container:"audio/mp4",codec:y,initSegment:T,id:"audio"}:v.video?r.video={container:"video/mp4",codec:g,initSegment:T,id:"main"}:C.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=r},f.remux=function(T,y,g,v,r){var t=this.initPTS,e=this.lastEndDTS,d={audio:void 0,video:void 0,text:v,id3:g,initSegment:void 0};Object(b.isFiniteNumber)(e)||(e=this.lastEndDTS=r||0);var i=y.samples;if(!i||!i.length)return d;var n={initPTS:void 0,timescale:1},u=this.initData;if((!u||!u.length)&&(this.generateInitSegment(i),u=this.initData),!u||!u.length)return C.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),d;this.emitInitSegment&&(n.tracks=this.initTracks,this.emitInitSegment=!1),Object(b.isFiniteNumber)(t)||(this.initPTS=n.initPTS=t=A(u,i,e));var a=Object(R.getDuration)(i,u),o=e,l=a+o;Object(R.offsetStartDTS)(u,i,t),a>0?this.lastEndDTS=l:(C.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var h=!!u.audio,L=!!u.video,O="";h&&(O+="audio"),L&&(O+="video");var E={data1:i,startPTS:o,startDTS:o,endPTS:l,endDTS:l,type:O,hasAudio:h,hasVideo:L,nb:1,dropped:0};return d.audio="audio"===E.type?E:void 0,d.video="audio"!==E.type?E:void 0,d.text=v,d.id3=g,d.initSegment=n,d},s}(),A=function(f,c,T){return Object(R.getStartDTS)(f,c)-T};function m(s,f){var c=null==s?void 0:s.codec;return c&&c.length>4?c:"hvc1"===c?"hvc1.1.c.L120.90":"av01"===c?"av01.0.04M.08":"avc1"===c||f===S.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}I.default=P},"./src/task-loop.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"default",function(){return b});var b=function(){function R(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var S=R.prototype;return S.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},S.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},S.onHandlerDestroyed=function(){},S.hasInterval=function(){return!!this._tickInterval},S.hasNextTick=function(){return!!this._tickTimer},S.setInterval=function(P){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,P),!0)},S.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},S.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},S.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},S.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},S.doTick=function(){},R}()},"./src/types/level.ts":function(G,I,p){"use strict";function b(m,s){for(var f=0;f<s.length;f++){var c=s[f];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(m,c.key,c)}}p.r(I),p.d(I,"HlsSkip",function(){return S}),p.d(I,"getSkipValue",function(){return C}),p.d(I,"HlsUrlParameters",function(){return P}),p.d(I,"Level",function(){return A});var S=(()=>{return(m=S||(S={})).No="",m.Yes="YES",m.v2="v2",S;var m})();function C(m,s){var f=m.canSkipUntil;return f&&(void 0!==s?s-m.endSN:0)<f?m.canSkipDateRanges?S.v2:S.Yes:S.No}var P=function(){function m(f,c,T){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=f,this.part=c,this.skip=T}return m.prototype.addDirectives=function(c){var T=new self.URL(c);return void 0!==this.msn&&T.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&T.searchParams.set("_HLS_part",this.part.toString()),this.skip&&T.searchParams.set("_HLS_skip",this.skip),T.toString()},m}(),A=function(){function m(s){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[s.url],this.attrs=s.attrs,this.bitrate=s.bitrate,s.details&&(this.details=s.details),this.id=s.id||0,this.name=s.name,this.width=s.width||0,this.height=s.height||0,this.audioCodec=s.audioCodec,this.videoCodec=s.videoCodec,this.unknownCodecs=s.unknownCodecs,this.codecSet=[s.videoCodec,s.audioCodec].filter(function(f){return f}).join(",").replace(/\.[^.,]+/g,"")}return function(m,s,f){s&&b(m.prototype,s),f&&b(m,f)}(m,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(f){var c=f%this.url.length;this._urlId!==c&&(this.details=void 0,this._urlId=c)}}]),m}()},"./src/types/loader.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"PlaylistContextType",function(){return b}),p.d(I,"PlaylistLevelType",function(){return R});var b=(()=>{return(S=b||(b={})).MANIFEST="manifest",S.LEVEL="level",S.AUDIO_TRACK="audioTrack",S.SUBTITLE_TRACK="subtitleTrack",b;var S})(),R=(()=>{return(S=R||(R={})).MAIN="main",S.AUDIO="audio",S.SUBTITLE="subtitle",R;var S})()},"./src/types/transmuxer.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"ChunkMetadata",function(){return b});var b=function(C,P,A,m,s,f){void 0===m&&(m=0),void 0===s&&(s=-1),void 0===f&&(f=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=C,this.sn=P,this.id=A,this.size=m,this.part=s,this.partial=f}},"./src/utils/attr-list.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"AttrList",function(){return S});var b=/^(\d+)x(\d+)$/,R=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,S=function(){function C(A){for(var m in"string"==typeof A&&(A=C.parseAttrList(A)),A)A.hasOwnProperty(m)&&(this[m]=A[m])}var P=C.prototype;return P.decimalInteger=function(m){var s=parseInt(this[m],10);return s>Number.MAX_SAFE_INTEGER?1/0:s},P.hexadecimalInteger=function(m){if(this[m]){var s=(this[m]||"0x").slice(2);s=(1&s.length?"0":"")+s;for(var f=new Uint8Array(s.length/2),c=0;c<s.length/2;c++)f[c]=parseInt(s.slice(2*c,2*c+2),16);return f}return null},P.hexadecimalIntegerAsNumber=function(m){var s=parseInt(this[m],16);return s>Number.MAX_SAFE_INTEGER?1/0:s},P.decimalFloatingPoint=function(m){return parseFloat(this[m])},P.optionalFloat=function(m,s){var f=this[m];return f?parseFloat(f):s},P.enumeratedString=function(m){return this[m]},P.bool=function(m){return"YES"===this[m]},P.decimalResolution=function(m){var s=b.exec(this[m]);if(null!==s)return{width:parseInt(s[1],10),height:parseInt(s[2],10)}},C.parseAttrList=function(m){var s,f={};for(R.lastIndex=0;null!==(s=R.exec(m));){var T=s[2];0===T.indexOf('"')&&T.lastIndexOf('"')===T.length-1&&(T=T.slice(1,-1)),f[s[1]]=T}return f},C}()},"./src/utils/binary-search.ts":function(G,I,p){"use strict";p.r(I),I.default={search:function(S,C){for(var P=0,A=S.length-1,m=null,s=null;P<=A;){var f=C(s=S[m=(P+A)/2|0]);if(f>0)P=m+1;else{if(!(f<0))return s;A=m-1}}return null}}},"./src/utils/buffer-helper.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"BufferHelper",function(){return S});var b=p("./src/utils/logger.ts"),R={length:0,start:function(){return 0},end:function(){return 0}},S=function(){function C(){}return C.isBuffered=function(A,m){try{if(A)for(var s=C.getBuffered(A),f=0;f<s.length;f++)if(m>=s.start(f)&&m<=s.end(f))return!0}catch(c){}return!1},C.bufferInfo=function(A,m,s){try{if(A){var T,f=C.getBuffered(A),c=[];for(T=0;T<f.length;T++)c.push({start:f.start(T),end:f.end(T)});return this.bufferedInfo(c,m,s)}}catch(y){}return{len:0,start:m,end:m,nextStart:void 0}},C.bufferedInfo=function(A,m,s){m=Math.max(0,m),A.sort(function(n,u){return n.start-u.start||u.end-n.end});var f=[];if(s)for(var c=0;c<A.length;c++){var T=f.length;if(T){var y=f[T-1].end;A[c].start-y<s?A[c].end>y&&(f[T-1].end=A[c].end):f.push(A[c])}else f.push(A[c])}else f=A;for(var v,g=0,r=m,t=m,e=0;e<f.length;e++){var d=f[e].start,i=f[e].end;if(m+s>=d&&m<i)r=d,g=(t=i)-m;else if(m+s<d){v=d;break}}return{len:g,start:r||0,end:t||0,nextStart:v}},C.getBuffered=function(A){try{return A.buffered}catch(m){return b.logger.log("failed to get media.buffered",m),R}},C}()},"./src/utils/codecs.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"isCodecType",function(){return R}),p.d(I,"isCodecSupportedInMp4",function(){return S});var b={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function R(C,P){var A=b[P];return!!A&&!0===A[C.slice(0,4)]}function S(C,P){return MediaSource.isTypeSupported((P||"video")+'/mp4;codecs="'+C+'"')}},"./src/utils/discontinuities.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"findFirstFragWithCC",function(){return C}),p.d(I,"shouldAlignOnDiscontinuities",function(){return P}),p.d(I,"findDiscontinuousReferenceFrag",function(){return A}),p.d(I,"adjustSlidingStart",function(){return s}),p.d(I,"alignStream",function(){return f}),p.d(I,"alignPDT",function(){return T});var b=p("./src/polyfills/number.ts"),R=p("./src/utils/logger.ts"),S=p("./src/controller/level-helper.ts");function C(y,g){for(var v=null,r=0,t=y.length;r<t;r++){var e=y[r];if(e&&e.cc===g){v=e;break}}return v}function P(y,g,v){return!(!g.details||!(v.endCC>v.startCC||y&&y.cc<v.startCC))}function A(y,g){var v=y.fragments,r=g.fragments;if(r.length&&v.length){var t=C(v,r[0].cc);if(t&&(!t||t.startPTS))return t;R.logger.log("No frag in previous level to align on")}else R.logger.log("No fragments to align")}function m(y,g){if(y){var v=y.start+g;y.start=y.startPTS=v,y.endPTS=v+y.duration}}function s(y,g){for(var v=g.fragments,r=0,t=v.length;r<t;r++)m(v[r],y);g.fragmentHint&&m(g.fragmentHint,y),g.alignedSliding=!0}function f(y,g,v){!g||(function(y,g,v){if(P(y,v,g)){var r=A(v.details,g);r&&Object(b.isFiniteNumber)(r.start)&&(R.logger.log("Adjusting PTS using last level due to CC increase within current level "+g.url),s(r.start,g))}}(y,v,g),!v.alignedSliding&&g.details&&T(v,g.details),!v.alignedSliding&&g.details&&!v.skippedSegments&&Object(S.adjustSliding)(g.details,v))}function T(y,g){if(g.fragments.length&&y.hasProgramDateTime&&g.hasProgramDateTime){var v=g.fragments[0].programDateTime,r=y.fragments[0].programDateTime,t=(r-v)/1e3+g.fragments[0].start;t&&Object(b.isFiniteNumber)(t)&&(R.logger.log("Adjusting PTS using programDateTime delta "+(r-v)+"ms, sliding:"+t.toFixed(3)+" "+y.url+" "),s(t,y))}}},"./src/utils/ewma-bandwidth-estimator.ts":function(G,I,p){"use strict";p.r(I);var b=p("./src/utils/ewma.ts");I.default=function(){function S(P,A,m){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=m,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new b.default(P),this.fast_=new b.default(A)}var C=S.prototype;return C.update=function(A,m){var s=this.slow_,f=this.fast_;this.slow_.halfLife!==A&&(this.slow_=new b.default(A,s.getEstimate(),s.getTotalWeight())),this.fast_.halfLife!==m&&(this.fast_=new b.default(m,f.getEstimate(),f.getTotalWeight()))},C.sample=function(A,m){var f=(A=Math.max(A,this.minDelayMs_))/1e3,c=8*m/f;this.fast_.sample(f,c),this.slow_.sample(f,c)},C.canEstimate=function(){var A=this.fast_;return A&&A.getTotalWeight()>=this.minWeight_},C.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},C.destroy=function(){},S}()},"./src/utils/ewma.ts":function(G,I,p){"use strict";p.r(I),I.default=function(){function R(C,P,A){void 0===P&&(P=0),void 0===A&&(A=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=C,this.alpha_=C?Math.exp(Math.log(.5)/C):0,this.estimate_=P,this.totalWeight_=A}var S=R.prototype;return S.sample=function(P,A){var m=Math.pow(this.alpha_,P);this.estimate_=A*(1-m)+m*this.estimate_,this.totalWeight_+=P},S.getTotalWeight=function(){return this.totalWeight_},S.getEstimate=function(){if(this.alpha_){var P=1-Math.pow(this.alpha_,this.totalWeight_);if(P)return this.estimate_/P}return this.estimate_},R}()},"./src/utils/fetch-loader.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"fetchSupported",function(){return T});var b=p("./src/polyfills/number.ts"),R=p("./src/loader/load-stats.ts"),S=p("./src/demux/chunk-cache.ts");function P(t){var e="function"==typeof Map?new Map:void 0;return(P=function(i){if(null===i||!function(t){return-1!==Function.toString.call(t).indexOf("[native code]")}(i))return i;if("function"!=typeof i)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(i))return e.get(i);e.set(i,n)}function n(){return A(i,arguments,c(this).constructor)}return n.prototype=Object.create(i.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),f(n,i)})(t)}function A(t,e,d){return(A=m()?Reflect.construct:function(n,u,a){var o=[null];o.push.apply(o,u);var h=new(Function.bind.apply(n,o));return a&&f(h,a.prototype),h}).apply(null,arguments)}function m(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function f(t,e){return(f=Object.setPrototypeOf||function(i,n){return i.__proto__=n,i})(t,e)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(d){return d.__proto__||Object.getPrototypeOf(d)})(t)}function T(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(t){}return!1}var y=function(){function t(d){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=d.fetchSetup||v,this.controller=new self.AbortController,this.stats=new R.LoadStats}var e=t.prototype;return e.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},e.abortInternal=function(){var i=this.response;(!i||!i.ok)&&(this.stats.aborted=!0,this.controller.abort())},e.abort=function(){var i;this.abortInternal(),null!==(i=this.callbacks)&&void 0!==i&&i.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},e.load=function(i,n,u){var a=this,o=this.stats;if(o.loading.start)throw new Error("Loader can only be used once.");o.loading.start=self.performance.now();var l=function(t,e){var d={method:"GET",mode:"cors",credentials:"same-origin",signal:e};return t.rangeEnd&&(d.headers=new self.Headers({Range:"bytes="+t.rangeStart+"-"+String(t.rangeEnd-1)})),d}(i,this.controller.signal),h=u.onProgress,L="arraybuffer"===i.responseType,O=L?"byteLength":"length";this.context=i,this.config=n,this.callbacks=u,this.request=this.fetchSetup(i,l),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){a.abortInternal(),u.onTimeout(o,i,a.response)},n.timeout),self.fetch(this.request).then(function(E){if(a.response=a.loader=E,!E.ok)throw new r(E.statusText||"fetch, bad network response",E.status,E);return o.loading.first=Math.max(self.performance.now(),o.loading.start),o.total=parseInt(E.headers.get("Content-Length")||"0"),h&&Object(b.isFiniteNumber)(n.highWaterMark)?a.loadProgressively(E,o,i,n.highWaterMark,h):L?E.arrayBuffer():E.text()}).then(function(E){var x=a.response;self.clearTimeout(a.requestTimeout),o.loading.end=Math.max(self.performance.now(),o.loading.first),o.loaded=o.total=E[O];var D={url:x.url,data:E};h&&!Object(b.isFiniteNumber)(n.highWaterMark)&&h(o,i,E,x),u.onSuccess(D,o,i,x)}).catch(function(E){self.clearTimeout(a.requestTimeout),o.aborted||u.onError({code:E.code||0,text:E.message},i,E.details)})},e.getCacheAge=function(){var i=null;if(this.response){var n=this.response.headers.get("age");i=n?parseFloat(n):null}return i},e.loadProgressively=function(i,n,u,a,o){void 0===a&&(a=0);var l=new S.default,h=i.body.getReader();return function O(){return h.read().then(function(E){if(E.done)return l.dataLength&&o(n,u,l.flush(),i),Promise.resolve(new ArrayBuffer(0));var x=E.value,D=x.length;return n.loaded+=D,D<a||l.dataLength?(l.push(x),l.dataLength>=a&&o(n,u,l.flush(),i)):o(n,u,x,i),O()}).catch(function(){return Promise.reject()})}()},t}();function v(t,e){return new self.Request(t.url,e)}var r=function(t){function e(d,i,n){var u;return(u=t.call(this,d)||this).code=void 0,u.details=void 0,u.code=i,u.details=n,u}return function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,f(t,e)}(e,t),e}(P(Error));I.default=y},"./src/utils/logger.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"enableLogs",function(){return A}),p.d(I,"logger",function(){return m});var b=function(){},R={trace:b,debug:b,log:b,warn:b,info:b,error:b},S=R;function C(s){var f=self.console[s];return f?f.bind(self.console,"["+s+"] >"):b}function A(s){if(self.console&&!0===s||"object"==typeof s){!function(s){for(var f=arguments.length,c=new Array(f>1?f-1:0),T=1;T<f;T++)c[T-1]=arguments[T];c.forEach(function(y){S[y]=s[y]?s[y].bind(s):C(y)})}(s,"debug","log","info","warn","error");try{S.log()}catch(f){S=R}}else S=R}var m=R},"./src/utils/mediakeys-helper.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"KeySystems",function(){return b}),p.d(I,"requestMediaKeySystemAccess",function(){return R});var b=(()=>{return(S=b||(b={})).WIDEVINE="com.widevine.alpha",S.PLAYREADY="com.microsoft.playready",b;var S})(),R="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function(G,I,p){"use strict";function b(){return self.MediaSource||self.WebKitMediaSource}p.r(I),p.d(I,"getMediaSource",function(){return b})},"./src/utils/mp4-tools.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"bin2str",function(){return P}),p.d(I,"readUint16",function(){return A}),p.d(I,"readUint32",function(){return m}),p.d(I,"writeUint32",function(){return s}),p.d(I,"findBox",function(){return f}),p.d(I,"parseSegmentIndex",function(){return c}),p.d(I,"parseInitSegment",function(){return T}),p.d(I,"getStartDTS",function(){return y}),p.d(I,"getDuration",function(){return g}),p.d(I,"computeRawDurationFromSamples",function(){return v}),p.d(I,"offsetStartDTS",function(){return r}),p.d(I,"segmentValidRange",function(){return t}),p.d(I,"appendUint8Array",function(){return e});var b=p("./src/utils/typed-array.ts"),R=p("./src/loader/fragment.ts"),S=Math.pow(2,32)-1,C=[].push;function P(d){return String.fromCharCode.apply(null,d)}function A(d,i){"data"in d&&(i+=d.start,d=d.data);var n=d[i]<<8|d[i+1];return n<0?65536+n:n}function m(d,i){"data"in d&&(i+=d.start,d=d.data);var n=d[i]<<24|d[i+1]<<16|d[i+2]<<8|d[i+3];return n<0?4294967296+n:n}function s(d,i,n){"data"in d&&(i+=d.start,d=d.data),d[i]=n>>24,d[i+1]=n>>16&255,d[i+2]=n>>8&255,d[i+3]=255&n}function f(d,i){var u,a,o,n=[];if(!i.length)return n;"data"in d?(u=d.data,a=d.start,o=d.end):(a=0,o=(u=d).byteLength);for(var l=a;l<o;){var h=m(u,l),O=h>1?l+h:o;if(P(u.subarray(l+4,l+8))===i[0])if(1===i.length)n.push({data:u,start:l+8,end:O});else{var E=f({data:u,start:l+8,end:O},i.slice(1));E.length&&C.apply(n,E)}l=O}return n}function c(d){var n=f(d,["moov"])[0],u=n?n.end:null,a=f(d,["sidx"]);if(!a||!a[0])return null;var o=[],l=a[0],h=l.data[0],L=0===h?8:16,O=m(l,L);L+=4;L+=0===h?8:16;var D=l.end+0,M=A(l,L+=2);L+=2;for(var F=0;F<M;F++){var B=L,U=m(l,B);B+=4;var k=2147483647&U;if(1==(2147483648&U)>>>31)return console.warn("SIDX has hierarchical references (not supported)"),null;var K=m(l,B);B+=4,o.push({referenceSize:k,subsegmentDuration:K,info:{duration:K/O,start:D,end:D+k-1}}),D+=k,L=B+=4}return{earliestPresentationTime:0,timescale:O,version:h,referencesCount:M,references:o,moovEndOffset:u}}function T(d){for(var i=[],n=f(d,["moov","trak"]),u=0;u<n.length;u++){var a=n[u],o=f(a,["tkhd"])[0];if(o){var l=o.data[o.start],h=0===l?12:20,L=m(o,h),O=f(a,["mdia","mdhd"])[0];if(O){var E=m(O,h=0===(l=O.data[O.start])?12:20),x=f(a,["mdia","hdlr"])[0];if(x){var D=P(x.data.subarray(x.start+8,x.start+12)),M={soun:R.ElementaryStreamTypes.AUDIO,vide:R.ElementaryStreamTypes.VIDEO}[D];if(M){var F=f(a,["mdia","minf","stbl","stsd"])[0],B=void 0;F&&(B=P(F.data.subarray(F.start+12,F.start+16))),i[L]={timescale:E,type:M},i[M]={timescale:E,id:L,codec:B}}}}}}return f(d,["moov","mvex","trex"]).forEach(function(k){var N=m(k,4),K=i[N];K&&(K.default={duration:m(k,12),flags:m(k,20)})}),i}function y(d,i){return f(i,["moof","traf"]).reduce(function(n,u){var a=f(u,["tfdt"])[0],o=a.data[a.start],l=f(u,["tfhd"]).reduce(function(h,L){var O=m(L,4),E=d[O];if(E){var x=m(a,4);1===o&&(x*=Math.pow(2,32),x+=m(a,8));var M=x/(E.timescale||9e4);if(isFinite(M)&&(null===h||M<h))return M}return h},null);return null!==l&&isFinite(l)&&(null===n||l<n)?l:n},null)||0}function g(d,i){for(var n=0,u=0,a=0,o=f(d,["moof","traf"]),l=0;l<o.length;l++){var h=o[l],L=f(h,["tfhd"])[0],E=i[m(L,4)];if(E){var x=E.default,D=m(L,0)|(null==x?void 0:x.flags),M=null==x?void 0:x.duration;8&D&&(M=m(L,2&D?12:8));for(var F=E.timescale||9e4,B=f(h,["trun"]),U=0;U<B.length;U++)n=M?M*m(B[U],4):v(B[U]),E.type===R.ElementaryStreamTypes.VIDEO?u+=n/F:E.type===R.ElementaryStreamTypes.AUDIO&&(a+=n/F)}}if(0===u&&0===a){var N=c(d);if(null!=N&&N.references)return N.references.reduce(function(K,W){return K+W.info.duration||0},0)}return u||a}function v(d){var i=m(d,0),n=8;1&i&&(n+=4),4&i&&(n+=4);for(var u=0,a=m(d,4),o=0;o<a;o++)256&i&&(u+=m(d,n),n+=4),512&i&&(n+=4),1024&i&&(n+=4),2048&i&&(n+=4);return u}function r(d,i,n){f(i,["moof","traf"]).forEach(function(u){f(u,["tfhd"]).forEach(function(a){var o=m(a,4),l=d[o];if(l){var h=l.timescale||9e4;f(u,["tfdt"]).forEach(function(L){var O=L.data[L.start],E=m(L,4);if(0===O)s(L,4,E-n*h);else{E*=Math.pow(2,32),E+=m(L,8),E-=n*h,E=Math.max(E,0);var x=Math.floor(E/(S+1)),D=Math.floor(E%(S+1));s(L,4,x),s(L,8,D)}})}})})}function t(d){var i={valid:null,remainder:null},n=f(d,["moof"]);if(!n)return i;if(n.length<2)return i.remainder=d,i;var u=n[n.length-1];return i.valid=Object(b.sliceUint8)(d,0,u.start-8),i.remainder=Object(b.sliceUint8)(d,u.start-8),i}function e(d,i){var n=new Uint8Array(d.length+i.length);return n.set(d),n.set(i,d.length),n}},"./src/utils/texttrack-utils.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"sendAddTrackEvent",function(){return R}),p.d(I,"addCueToTrack",function(){return S}),p.d(I,"clearCurrentCues",function(){return C}),p.d(I,"removeCuesInRange",function(){return P}),p.d(I,"getCuesInRange",function(){return m});var b=p("./src/utils/logger.ts");function R(s,f){var c;try{c=new Event("addtrack")}catch(T){(c=document.createEvent("Event")).initEvent("addtrack",!1,!1)}c.track=s,f.dispatchEvent(c)}function S(s,f){var c=s.mode;if("disabled"===c&&(s.mode="hidden"),s.cues&&!s.cues.getCueById(f.id))try{if(s.addCue(f),!s.cues.getCueById(f.id))throw new Error("addCue is failed for: "+f)}catch(y){b.logger.debug("[texttrack-utils]: "+y);var T=new self.TextTrackCue(f.startTime,f.endTime,f.text);T.id=f.id,s.addCue(T)}"disabled"===c&&(s.mode=c)}function C(s){var f=s.mode;if("disabled"===f&&(s.mode="hidden"),s.cues)for(var c=s.cues.length;c--;)s.removeCue(s.cues[c]);"disabled"===f&&(s.mode=f)}function P(s,f,c){var T=s.mode;if("disabled"===T&&(s.mode="hidden"),s.cues&&s.cues.length>0)for(var y=m(s.cues,f,c),g=0;g<y.length;g++)s.removeCue(y[g]);"disabled"===T&&(s.mode=T)}function m(s,f,c){var T=[],y=function(s,f){if(f<s[0].startTime)return 0;var c=s.length-1;if(f>s[c].endTime)return-1;for(var T=0,y=c;T<=y;){var g=Math.floor((y+T)/2);if(f<s[g].startTime)y=g-1;else{if(!(f>s[g].startTime&&T<c))return g;T=g+1}}return s[T].startTime-f<f-s[y].startTime?T:y}(s,f);if(y>-1)for(var g=y,v=s.length;g<v;g++){var r=s[g];if(r.startTime>=f&&r.endTime<=c)T.push(r);else if(r.startTime>c)return T}return T}},"./src/utils/time-ranges.ts":function(G,I,p){"use strict";p.r(I),I.default={toString:function(S){for(var C="",P=S.length,A=0;A<P;A++)C+="["+S.start(A).toFixed(3)+","+S.end(A).toFixed(3)+"]";return C}}},"./src/utils/timescale-conversion.ts":function(G,I,p){"use strict";p.r(I),p.d(I,"toTimescaleFromBase",function(){return R}),p.d(I,"toTimescaleFromScale",function(){return S}),p.d(I,"toMsFromMpegTsClock",function(){return C}),p.d(I,"toMpegTsClockFromTimescale",function(){return P});function R(A,m,s,f){void 0===s&&(s=1),void 0===f&&(f=!1);var c=A*m*s;return f?Math.round(c):c}function S(A,m,s,f){return void 0===s&&(s=1),void 0===f&&(f=!1),R(A,m,1/s,f)}function C(A,m){return void 0===m&&(m=!1),R(A,1e3,1/9e4,m)}function P(A,m){return void 0===m&&(m=1),R(A,9e4,1/m)}},"./src/utils/typed-array.ts":function(G,I,p){"use strict";function b(R,S,C){return Uint8Array.prototype.slice?R.slice(S,C):new Uint8Array(Array.prototype.slice.call(R,S,C))}p.r(I),p.d(I,"sliceUint8",function(){return b})},"./src/utils/xhr-loader.ts":function(G,I,p){"use strict";p.r(I);var b=p("./src/utils/logger.ts"),R=p("./src/loader/load-stats.ts"),S=/^age:\s*[\d.]+\s*$/m;I.default=function(){function P(m){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=m?m.xhrSetup:null,this.stats=new R.LoadStats,this.retryDelay=0}var A=P.prototype;return A.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},A.abortInternal=function(){var s=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),s&&(s.onreadystatechange=null,s.onprogress=null,4!==s.readyState&&(this.stats.aborted=!0,s.abort()))},A.abort=function(){var s;this.abortInternal(),null!==(s=this.callbacks)&&void 0!==s&&s.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},A.load=function(s,f,c){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=s,this.config=f,this.callbacks=c,this.retryDelay=f.retryDelay,this.loadInternal()},A.loadInternal=function(){var s=this.config,f=this.context;if(s){var c=this.loader=new self.XMLHttpRequest,T=this.stats;T.loading.first=0,T.loaded=0;var y=this.xhrSetup;try{if(y)try{y(c,f.url)}catch(g){c.open("GET",f.url,!0),y(c,f.url)}c.readyState||c.open("GET",f.url,!0)}catch(g){return void this.callbacks.onError({code:c.status,text:g.message},f,c)}f.rangeEnd&&c.setRequestHeader("Range","bytes="+f.rangeStart+"-"+(f.rangeEnd-1)),c.onreadystatechange=this.readystatechange.bind(this),c.onprogress=this.loadprogress.bind(this),c.responseType=f.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),c.send()}},A.readystatechange=function(){var s=this.context,f=this.loader,c=this.stats;if(s&&f){var T=f.readyState,y=this.config;if(!c.aborted&&T>=2)if(self.clearTimeout(this.requestTimeout),0===c.loading.first&&(c.loading.first=Math.max(self.performance.now(),c.loading.start)),4===T){f.onreadystatechange=null,f.onprogress=null;var g=f.status;if(g>=200&&g<300){var v,r;if(c.loading.end=Math.max(self.performance.now(),c.loading.first),r="arraybuffer"===s.responseType?(v=f.response).byteLength:(v=f.responseText).length,c.loaded=c.total=r,!this.callbacks)return;var t=this.callbacks.onProgress;if(t&&t(c,s,v,f),!this.callbacks)return;this.callbacks.onSuccess({url:f.responseURL,data:v},c,s,f)}else c.retry>=y.maxRetry||g>=400&&g<499?(b.logger.error(g+" while loading "+s.url),this.callbacks.onError({code:g,text:f.statusText},s,f)):(b.logger.warn(g+" while loading "+s.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,y.maxRetryDelay),c.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),y.timeout)}},A.loadtimeout=function(){b.logger.warn("timeout while loading "+this.context.url);var s=this.callbacks;s&&(this.abortInternal(),s.onTimeout(this.stats,this.context,this.loader))},A.loadprogress=function(s){var f=this.stats;f.loaded=s.loaded,s.lengthComputable&&(f.total=s.total)},A.getCacheAge=function(){var s=null;if(this.loader&&S.test(this.loader.getAllResponseHeaders())){var f=this.loader.getResponseHeader("age");s=f?parseFloat(f):null}return s},P}()}}).default)},17342:(Ot,G,I)=>{"use strict";I.r(G),I.d(G,{P2pMediaLoaderPlugin:()=>y});var p=I(20593),b=I.n(p),R=I(22511),S=I.n(R),C=I(12546),P=I(58571),A=I(54175);let c=(()=>{class g{constructor(r,t,e){this.errorCounts={},this.hlsjsConfig=null,this._duration=null,this.metadata=null,this.isLive=null,this.dvrDuration=null,this.edgeMargin=null,this.handlers={play:null,playing:null,textTracksChange:null,audioTracksChange:null},this.uiTextTrackHandled=!1,this.vjs=r,this.source=t,this.tech=e,this.tech.name_="Hlsjs",this.videoElement=e.el(),this.player=r(e.options_.playerId),this.videoElement.addEventListener("error",d=>{let i;const n=(d.currentTarget||d.target).error;if(n){switch(console.log(n),n.code){case n.MEDIA_ERR_ABORTED:i="You aborted the video playback";break;case n.MEDIA_ERR_DECODE:i="The video playback was aborted due to a corruption problem or because the video used features your browser did not support",this._handleMediaError(n);break;case n.MEDIA_ERR_NETWORK:i="A network error caused the video download to fail part-way";break;case n.MEDIA_ERR_SRC_NOT_SUPPORTED:i="The video could not be loaded, either because the server or network failed or because the format is not supported";break;default:i=n.message}console.error("MEDIA_ERROR: ",i)}}),this.initialize()}duration(){return this._duration||this.videoElement.duration||0}seekable(){if(this.hls.media){if(!this.isLive)return this.vjs.createTimeRanges(0,this.hls.media.duration);const r=Math.round(this.hls.media.duration-this.dvrDuration),t=Math.round(this.hls.media.duration-this.edgeMargin);return this.vjs.createTimeRanges(r,t)}return this.vjs.createTimeRanges()}dispose(){this.videoElement.removeEventListener("play",this.handlers.play),this.videoElement.removeEventListener("playing",this.handlers.playing),this.player.textTracks().removeEventListener("change",this.handlers.textTracksChange),this.uiTextTrackHandled=!1,this.hls.destroy()}static addHook(r,t){g.hooks[r]=this.hooks[r]||[],g.hooks[r].push(t)}static removeHook(r,t){if(void 0===g.hooks[r])return!1;const e=g.hooks[r].indexOf(t);return-1!==e&&(g.hooks[r].splice(e,1),!0)}_executeHooksFor(r){if(void 0!==g.hooks[r])for(let t=0;t<g.hooks[r].length;t++)g.hooks[r][t](this.player,this.hls)}_handleMediaError(r){return 1===this.errorCounts[b().ErrorTypes.MEDIA_ERROR]?(console.info("trying to recover media error"),void this.hls.recoverMediaError()):2===this.errorCounts[b().ErrorTypes.MEDIA_ERROR]?(console.info("2nd try to recover media error (by swapping audio codec"),this.hls.swapAudioCodec(),void this.hls.recoverMediaError()):void(this.errorCounts[b().ErrorTypes.MEDIA_ERROR]>2&&(console.info("bubbling media error up to VIDEOJS"),this.hls.destroy(),this.tech.error=()=>r,this.tech.trigger("error")))}_handleNetworkError(r){if(this.errorCounts[b().ErrorTypes.NETWORK_ERROR]<=5)return console.info("trying to recover network error"),setTimeout(()=>this.hls.startLoad(),1e3),void this.hls.once(b().Events.FRAG_LOADED,()=>{this.errorCounts[b().ErrorTypes.NETWORK_ERROR]=0});console.info("bubbling network error up to VIDEOJS"),this.hls.destroy(),this.tech.error=()=>r,this.tech.trigger("error")}_onError(r,t){const e={message:`HLS.js error: ${t.type} - fatal: ${t.fatal} - ${t.details}`};this.errorCounts[t.type]?this.errorCounts[t.type]+=1:this.errorCounts[t.type]=1,t.fatal?console.warn(e.message):console.error(e.message,t),t.type===b().ErrorTypes.NETWORK_ERROR?(e.code=2,this._handleNetworkError(e)):t.fatal&&t.type===b().ErrorTypes.MEDIA_ERROR&&"manifestIncompatibleCodecsError"!==t.details?(e.code=3,this._handleMediaError(e)):t.fatal&&(this.hls.destroy(),console.info("bubbling error up to VIDEOJS"),this.tech.error=()=>e,this.tech.trigger("error"))}switchQuality(r){this.hls.currentLevel=r}_levelLabel(r){return this.player.srOptions_.levelLabelHandler?this.player.srOptions_.levelLabelHandler(r):r.height?r.height+"p":r.width?Math.round(9*r.width/16)+"p":r.bitrate?r.bitrate/1e3+"kbps":0}_relayQualityChange(r){let e,t=!0;for(let d=0;d<r.length;d++)if(!r[d]._enabled){t=!1;break}if(t)this.hls.currentLevel=-1;else{for(e=r.length-1;e>=0&&!r[e]._enabled;e--);this.hls.currentLevel=e}}_handleQualityLevels(){var r,t;if(!this.metadata)return;const e=null===(t=(r=this.player).qualityLevels)||void 0===t?void 0:t.call(r);if(e)for(let d=0;d<this.metadata.levels.length;d++){const i=this.metadata.levels[d],n={id:d,width:i.width,height:i.height,bandwidth:i.bitrate,bitrate:i.bitrate,_enabled:!0},u=this;n.enabled=function(a,o){return"boolean"==typeof o&&(this[a]._enabled=o,u._relayQualityChange(this)),this[a]._enabled},e.addQualityLevel(n)}}_notifyVideoQualities(){if(!this.metadata)return;const r=[];this.metadata.levels.length>1&&r.push({id:-1,label:"auto",selected:-1===this.hls.manualLevel}),this.metadata.levels.forEach((e,d)=>{const i={id:d,selected:d===this.hls.manualLevel,label:this._levelLabel(e)};r.push(i)});const t={qualityData:{video:r},qualitySwitchCallback:this.switchQuality.bind(this)};this.tech.trigger("loadedqualitydata",t),this.videoElement.removeEventListener("playing",this.handlers.playing)}_updateSelectedAudioTrack(){const r=this.tech.audioTracks();for(let t=0;t<r.length;t++)if(r[t].enabled){this.hls.audioTrack=t;break}}_onAudioTracks(){const r=this.hls.audioTracks,t=this.tech.audioTracks();if(r.length>1&&0===t.length){for(let e=0;e<r.length;e++)t.addTrack(new this.vjs.AudioTrack({id:e.toString(),kind:"alternative",label:r[e].name||r[e].lang,language:r[e].lang,enabled:e===this.hls.audioTrack}));this.handlers.audioTracksChange=this._updateSelectedAudioTrack.bind(this),t.addEventListener("change",this.handlers.audioTracksChange)}}_getTextTrackLabel(r){return r.label?r.label:r.language}_isSameTextTrack(r,t){return this._getTextTrackLabel(r)===this._getTextTrackLabel(t)&&r.kind===t.kind}_updateSelectedTextTrack(){const r=this.player.textTracks();let t=null;for(let d=0;d<r.length;d++)if("showing"===r[d].mode){t=r[d];break}const e=this.videoElement.textTracks;for(let d=0;d<e.length;d++)("subtitles"===e[d].kind||"captions"===e[d].kind)&&(e[d].mode=t&&this._isSameTextTrack(e[d],t)?"showing":"disabled")}_startLoad(){this.hls.startLoad(-1),this.videoElement.removeEventListener("play",this.handlers.play)}_oneLevelObjClone(r){const t={},e=Object.keys(r);for(let d=0;d<e.length;d++)t[e[d]]=r[e[d]];return t}_filterDisplayableTextTracks(r){const t=[];for(let e=0;e<r.length;e++)("subtitles"===r[e].kind||"captions"===r[e].kind)&&t.push(r[e]);return t}_updateTextTrackList(){const r=this._filterDisplayableTextTracks(this.videoElement.textTracks),t=this.player.textTracks();for(let e=0;e<r.length;e++){let d=!1;for(let i=0;i<t.length;i++)if(this._isSameTextTrack(r[e],t[i])){d=!0;break}if(!d){const i=r[e];this.player.addRemoteTextTrack({kind:i.kind,label:this._getTextTrackLabel(i),language:i.language,srclang:i.language},!1)}}this._updateSelectedTextTrack(),this.uiTextTrackHandled||(this.handlers.textTracksChange=this._updateSelectedTextTrack.bind(this),t.addEventListener("change",this.handlers.textTracksChange),this.uiTextTrackHandled=!0)}_onMetaData(r,t){this.metadata=t,this._handleQualityLevels()}_createCueHandler(r){return{newCue:(t,e,d,i)=>{let n,u,a;const o=window.VTTCue||window.TextTrackCue;for(let l=0;l<i.rows.length;l++)if(n=i.rows[l],a="",!n.isEmpty()){for(let h=0;h<n.chars.length;h++)a+=n.chars[h].ucharj;if(u=new o(e,d,a.trim()),null!=r&&"object"==typeof r){const h=Object.keys(r);for(let L=0;L<h.length;L++)u[h[L]]=r[h[L]]}t.addCue(u),d===e&&t.addCue(new o(d+5,""))}}}}_initHlsjs(){const r=this.tech.options_,t=this.player.srOptions_,e=(null==t?void 0:t.hlsjsConfig)||r.hlsjsConfig;this.hlsjsConfig=e?this._oneLevelObjClone(e):{},["","auto"].includes(this.videoElement.preload)&&!this.videoElement.autoplay&&void 0===this.hlsjsConfig.autoStartLoad&&(this.hlsjsConfig.autoStartLoad=!1);const d=(null==t?void 0:t.captionConfig)||r.captionConfig;d&&(this.hlsjsConfig.cueHandler=this._createCueHandler(d)),!1===this.hlsjsConfig.autoStartLoad&&(this.handlers.play=this._startLoad.bind(this),this.videoElement.addEventListener("play",this.handlers.play)),this.handlers.playing=this._notifyVideoQualities.bind(this),this.videoElement.addEventListener("playing",this.handlers.playing),this.hls=new(b())(this.hlsjsConfig),this._executeHooksFor("beforeinitialize"),this.hls.on(b().Events.ERROR,(i,n)=>this._onError(i,n)),this.hls.on(b().Events.AUDIO_TRACKS_UPDATED,()=>this._onAudioTracks()),this.hls.on(b().Events.MANIFEST_PARSED,(i,n)=>this._onMetaData(i,n)),this.hls.on(b().Events.LEVEL_LOADED,(i,n)=>{this.hlsjsConfig.liveSyncDuration?this.edgeMargin=this.hlsjsConfig.liveSyncDuration:this.hlsjsConfig.liveSyncDurationCount&&(this.edgeMargin=this.hlsjsConfig.liveSyncDurationCount*n.details.targetduration),this.isLive=n.details.live,this.dvrDuration=n.details.totalduration,this._duration=this.isLive?1/0:n.details.totalduration}),this.hls.once(b().Events.FRAG_LOADED,()=>{this.tech.trigger("loadedmetadata")}),this.hls.attachMedia(this.videoElement),this.hls.loadSource(this.source.src)}initialize(){this._initHlsjs()}}return g.hooks={},g})();var g;((g=S()).registerPlugin||g.plugin)("hlsjs",function(g){const v=this;!g||(v.srOptions_||(v.srOptions_={}),v.srOptions_.hlsjsConfig||(v.srOptions_.hlsjsConfig=g.hlsjsConfig),v.srOptions_.captionConfig||(v.srOptions_.captionConfig=g.captionConfig),g.levelLabelHandler&&!v.srOptions_.levelLabelHandler&&(v.srOptions_.levelLabelHandler=g.levelLabelHandler))}),function(g){if(!b().isSupported())return void console.warn("Hls.js is not supported in this browser!");const v=g.getTech("Html5");v?(v.registerSourceHandler({canHandleSource:function(r){return/^application\/x-mpegURL|application\/vnd\.apple\.mpegurl$/i.test(r.type)?"probably":/\.m3u8/i.test(r.src)?"maybe":""},handleSource:function(r,t){return t.hlsProvider&&t.hlsProvider.dispose(),t.hlsProvider=new c(g,r,t),t.hlsProvider}},0),g.Html5Hlsjs=c):console.error("Not supported version if video.js")}(S());const T=S().getPlugin("plugin");class y extends T{constructor(v,r){if(super(v),this.CONSTANTS={INFO_SCHEDULER:1e3},this.statsP2PBytes={pendingDownload:[],pendingUpload:[],numPeers:0,totalDownload:0,totalUpload:0},this.statsHTTPBytes={pendingDownload:[],pendingUpload:[],totalDownload:0,totalUpload:0},this.options=r,S().Html5Hlsjs)S().Html5Hlsjs.addHook("beforeinitialize",(t,e)=>{this.hlsjs=e}),(0,P.initVideoJsContribHlsJsPlayer)(v);else if(console.warn("HLS.js does not seem to be supported. Try to fallback to built in HLS."),!v.canPlayType("application/vnd.apple.mpegurl")){const t="Cannot fallback to built-in HLS";return console.warn(t),void v.ready(()=>v.trigger("error",new Error(t)))}this.startTime=(0,A.h8)(r.startTime),v.src({type:r.type,src:r.src}),v.ready(()=>{this.initializeCore(),S().Html5Hlsjs&&this.initializePlugin()})}dispose(){this.hlsjs&&this.hlsjs.destroy(),this.p2pEngine&&this.p2pEngine.destroy(),clearInterval(this.networkInfoInterval)}getCurrentLevel(){return this.hlsjs.levels[this.hlsjs.currentLevel]}getLiveLatency(){return Math.round(this.hlsjs.latency)}getHLSJS(){return this.hlsjs}initializeCore(){this.player.one("play",()=>{this.player.addClass("vjs-has-big-play-button-clicked")}),this.player.one("canplay",()=>{this.startTime&&this.player.currentTime(this.startTime)})}initializePlugin(){(0,P.initHlsJsPlayer)(this.hlsjs);const v=this.player.tech(!0).options_;this.p2pEngine=v.hlsjsConfig.loader.getEngine(),this.hlsjs.on(b().Events.LEVEL_SWITCHING,(r,t)=>{this.trigger("resolutionChange",{auto:this.hlsjs.autoLevelEnabled,resolutionId:t.height})}),this.hlsjs.on(b().Events.MANIFEST_LOADED,(r,t)=>{this.trigger("resolutionsLoaded")}),this.p2pEngine.on(C.Events.SegmentError,(r,t)=>{console.error("Segment error.",r,t),this.options.redundancyUrlManager.removeBySegmentUrl(r.requestUrl)}),this.statsP2PBytes.numPeers=1+this.options.redundancyUrlManager.countBaseUrls(),this.runStats()}runStats(){this.p2pEngine.on(C.Events.PieceBytesDownloaded,(v,r,t)=>{const e="p2p"===v?this.statsP2PBytes:this.statsHTTPBytes;e.pendingDownload.push(t),e.totalDownload+=t}),this.p2pEngine.on(C.Events.PieceBytesUploaded,(v,r,t)=>{const e="p2p"===v?this.statsP2PBytes:this.statsHTTPBytes;e.pendingUpload.push(t),e.totalUpload+=t}),this.p2pEngine.on(C.Events.PeerConnect,()=>this.statsP2PBytes.numPeers++),this.p2pEngine.on(C.Events.PeerClose,()=>this.statsP2PBytes.numPeers--),this.networkInfoInterval=setInterval(()=>{const v=this.arraySum(this.statsP2PBytes.pendingDownload),r=this.arraySum(this.statsP2PBytes.pendingUpload),t=this.arraySum(this.statsHTTPBytes.pendingDownload),e=this.arraySum(this.statsHTTPBytes.pendingUpload);return this.statsP2PBytes.pendingDownload=[],this.statsP2PBytes.pendingUpload=[],this.statsHTTPBytes.pendingDownload=[],this.statsHTTPBytes.pendingUpload=[],this.player.trigger("p2pInfo",{source:"p2p-media-loader",http:{downloadSpeed:t,uploadSpeed:e,downloaded:this.statsHTTPBytes.totalDownload,uploaded:this.statsHTTPBytes.totalUpload},p2p:{downloadSpeed:v,uploadSpeed:r,numPeers:this.statsP2PBytes.numPeers,downloaded:this.statsP2PBytes.totalDownload,uploaded:this.statsP2PBytes.totalUpload},bandwidthEstimate:this.hlsjs.bandwidthEstimate/8})},this.CONSTANTS.INFO_SCHEDULER)}arraySum(v){return v.reduce((r,t)=>r+t,0)}}S().registerPlugin("p2pMediaLoader",y)}}]);